var lv=Object.defineProperty;var cv=(ut,It,Nt)=>It in ut?lv(ut,It,{enumerable:!0,configurable:!0,writable:!0,value:Nt}):ut[It]=Nt;var de=(ut,It,Nt)=>(cv(ut,typeof It!="symbol"?It+"":It,Nt),Nt);import{w as P,b as ne,A as Ua,q as Hu,z as hv,i as yr,n as Vu,k as ye,f as ys,M as ja,C as bs,F as Bn,E as uv,G as dv,h as tn,K as pv,I as Ut,J as nn,L as qn,v as oi,N as br,O as $u,Q as rt,R as Gu,S as Ye,U as vs,V as Wa,W as Ha,X as mn,Y as Va,Z as _n,a0 as Yu,t as m,B as je,$ as $a,a1 as Ku,a2 as Qu,d as ze,a3 as fv,p as ai,x as Et,a4 as li,_ as ci,T as mv,a5 as Ju,__tla as _v}from"./index-8e29a41c.js";import{S as Pe,u as gv,M as yv,G as bv}from"./GenericHeader-b6f3410d.js";import{F as vv,T as Ga,D as Xu,C as wv,t as Cv,f as Zu,a as Sv}from"./roomConfig-0e0bf8eb.js";import{I as ed}from"./InfiniteScroll-8d0fe7e7.js";import{C as Ya}from"./Collapsible-beba5fc1.js";let td,Ka,kv=Promise.all([(()=>{try{return _v}catch{}})()]).then(async()=>{var iv,sv,ov;var ut=10,It=function(n,e,t,r){var i=(r-90)*Math.PI/180;return{x:n+t*Math.cos(i),y:e+t*Math.sin(i)}},Nt=function(n,e,t,r,i){var s=i;i>r&&i-r>=360&&(s=r+359.99);var o=It(n,e,t,s),a=It(n,e,t,r),l=s-r<=180?"0":"1",c=["M",o.x.toFixed(ut),o.y.toFixed(ut),"A",t.toFixed(ut),t.toFixed(ut),0,l,0,a.x.toFixed(ut),a.y.toFixed(ut)].join(" ");return c},nd=function(n,e,t){return Math.max(0,n+e*t)%360};function rd(n){if(n==null)throw new TypeError("Cannot destructure "+n)}function hi(){return hi=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},hi.apply(this,arguments)}var id=function(n){var e=hi({},(rd(n),n));return P.createElement(ne,hi({as:"footer",align:"center",direction:"row",flex:!1,gap:"medium",justify:"between"},e))};function sd(n){if(n==null)throw new TypeError("Cannot destructure "+n)}function ui(){return ui=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},ui.apply(this,arguments)}var od=function(n){var e=ui({},(sd(n),n));return P.createElement(ne,ui({as:"nav",flex:!1,gap:"medium"},e))},ad=Ua(["border-radius:",";"],function(n){return n.theme.global.edgeSize[n.round.size]}),di=Hu.svg.withConfig({displayName:"StyledMeter",componentId:"sc-nsxarx-0"})(["max-width:100%;overflow:hidden;"," "," "," path{transition:stroke 0.3s,stroke-width 0.3s;}",";"],function(n){return n.reverse&&Ua(["transform:scale(-1,1);"])},hv,function(n){return n.round&&ad},function(n){return n.theme.meter&&n.theme.meter.extend});di.defaultProps={},Object.setPrototypeOf(di.defaultProps,yr);var vr=function(n,e){var t={};return n&&(typeof n=="object"?(t.stroke=Vu(n.color,e),n.opacity&&(t.strokeOpacity=""+(n.opacity===!0?e.global.opacity.medium:e.global.opacity[n.opacity]||n.opacity))):t.stroke=Vu(n,e)),t},ld=/^neutral-\d+/,Qa=function(n,e,t){if(n===t-1&&e.meter.color)return e.meter.color;var r=t-n-1;if(e.meter&&e.meter.colors){var i=e.meter.colors[e.dark?"dark":"light"]||e.meter.colors;return i[r%i.length]}var s=Object.keys(e.global.colors).filter(function(a){return a.match(/^graph-[0-9]$/)});if(s.length>0)return s[r%s.length];var o=Object.keys(e.global.colors).filter(function(a){return ld.test(a)});return o[r%o.length]},cd=["background","max","round","size","thickness","direction","values","reverse"],hd=["color","highlight","label","onHover","value"];function wr(){return wr=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},wr.apply(this,arguments)}function Ja(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}var pi=ye(function(n,e){var t=n.background,r=n.max,i=n.round,s=n.size,o=n.thickness,a=n.direction,l=n.values,c=n.reverse,h=Ja(n,cd),u=ys(ja)||yr.theme,d=s==="full"?288:bs(u.global.size[s]||s),f=bs(u.global.edgeSize[o]||o),g=i?f/2:0,y=f/2,v=(l||[]).some(function(N){return N.highlight}),C=a==="horizontal"?g:r*(d-2*g)/r,I=(l||[]).reduce(function(N,A,T){if(A.value>0){var Y=A.color,B=A.highlight;A.label;var O=A.onHover,_=A.value,le=Ja(A,hd),xe="p-"+T,ce=_*(d-2*g)/r,se=a==="horizontal"?"M "+C+","+y+" L "+(C+ce)+","+y:"M "+y+","+C+" L "+y+","+(C-ce),X=Y||Qa(T,u,l?l.length:0),D;O&&(D={onMouseOver:function(){return O(!0)},onMouseLeave:function(){return O(!1)}}),a==="horizontal"?C+=ce:C-=ce;var fe=P.createElement("path",wr({key:xe,d:se,fill:"none"},vr(v&&!B?t:X,u),{strokeWidth:a==="horizontal"?f:d,strokeLinecap:i?"round":"butt"},D,le));N.push(fe)}return N},[]).reverse(),k;a==="horizontal"?k=s==="full"?"100%":d:k=s==="full"?"100%":f;var w=a==="horizontal"?"M "+g+","+y+" L "+(d-g)+","+y:"M "+y+","+g+" L "+y+","+(d-g);return P.createElement(di,wr({ref:e,viewBox:a==="horizontal"?"0 0 "+d+" "+f:"0 0 "+f+" "+d,preserveAspectRatio:"none",width:k,height:a==="horizontal"?f:d,round:i?{size:o}:void 0},h,{reverse:c}),P.createElement("path",wr({d:w,fill:"none"},vr(t,u),{strokeWidth:f,strokeLinecap:i?"round":"square"})),I)});pi.displayName="Bar",pi.defaultProps={background:"light-1"},Object.setPrototypeOf(pi.defaultProps,yr);var ud=["background","max","round","size","thickness","type","values"],dd=["color","highlight","label","onHover","value"];function rn(){return rn=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},rn.apply(this,arguments)}function Xa(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}var fi=ye(function(n,e){var t=n.background,r=n.max,i=n.round,s=n.size,o=n.thickness,a=n.type,l=n.values,c=Xa(n,ud),h=ys(ja),u=s==="full"?288:bs(h.global.size[s]||s),d=a==="pie"?u/2:bs(h.global.edgeSize[o]||o),f=u/2,g=u/2,y=u/2-d/2,v=Math.max(5,Math.ceil(Math.log10(r))+3),C=Math.pow(10,v),I=Math.floor((a==="semicircle"?180:360)/r*C)/C,k=(l||[]).some(function(_){return _.highlight}),w=0,N=a==="semicircle"?270:0,A=[],T=[];(l||[]).filter(function(_){return _.value>0}).forEach(function(_,le){var xe=_.color,ce=_.highlight;_.label;var se=_.onHover,X=_.value,D=Xa(_,dd),fe="p-"+le,L=xe||Qa(le,h,l?l.length:0),Se;w+X>=r?Se=a==="semicircle"?90:360:Se=nd(N,I,X);var z;se&&(z={onMouseOver:function(){return se(!0)},onMouseLeave:function(){return se(!1)}});var Q=vr(k&&!ce?t:L,h);if(i){var re=Nt(f,g,y,N,Se);A.unshift(P.createElement("path",rn({key:fe,d:re,fill:"none"},Q,{strokeWidth:d,strokeLinecap:"round"},z,D)));var Z=Nt(f,g,y,Se-.5,Se),he=P.createElement("path",rn({key:fe+"-",d:Z,fill:"none"},Q,{strokeWidth:d,strokeLinecap:"round"},z,D));Se-N>2*I&&(T=[]),T.unshift(he)}else{var K=Nt(f,g,y,N,Se);A.push(P.createElement("path",rn({key:fe,d:K,fill:"none"},Q,{strokeWidth:d,strokeLinecap:"butt"},z,D)))}w+=X,N=Se});var Y;if(a==="semicircle"){var B=Nt(f,g,y,270,90);Y=P.createElement("path",rn({d:B,strokeWidth:d,fill:"none"},vr(t,h),{strokeLinecap:i?"round":"square"}))}else Y=P.createElement("circle",rn({cx:f,cy:g,r:y},vr(t,h),{strokeWidth:d,strokeLinecap:i?"round":"square",fill:"none"}));var O=a==="semicircle"?u/2:u;return P.createElement(di,rn({ref:e,viewBox:"0 0 "+u+" "+O,width:s==="full"?"100%":u,height:s==="full"?"100%":O},c),Y,A,T)});fi.displayName="Circle",fi.defaultProps={},Object.setPrototypeOf(fi.defaultProps,yr);var pd={},fd=pd,md=["background","color","direction","size","thickness","type","reverse","value","values"];function mi(){return mi=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},mi.apply(this,arguments)}function _d(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}var gd=function(n){var e=100;return n&&n.length>1&&(e=0,n.forEach(function(t){e+=t.value})),e},ws=ye(function(n,e){var t=n.background,r=t===void 0?{color:"light-2",opacity:"medium"}:t,i=n.color,s=n.direction,o=s===void 0?"horizontal":s,a=n.size,l=a===void 0?"medium":a,c=n.thickness,h=c===void 0?"medium":c,u=n.type,d=u===void 0?"bar":u,f=n.reverse,g=n.value,y=n.values,v=_d(n,md),C=ys(ja)||yr.theme,I=Bn(function(){return y||(g?[{color:i,value:g}]:[])},[i,g,y]),k=o==="horizontal"&&(C.dir==="rtl"||f)&&!(C.dir==="rtl"&&f),w=Bn(function(){return gd(I)},[I]),N;return d==="bar"?N=P.createElement(pi,mi({ref:e,max:w,values:I,size:l,thickness:h,background:r,direction:o,reverse:k},v)):(d==="circle"||d==="pie"||d==="semicircle")&&(N=P.createElement(fi,mi({ref:e,max:w,values:I,size:l,thickness:h,type:d,background:r,reverse:k},v))),N});ws.displayName="Meter",ws.prototype=fd;var yd={},bd=yd,vd=["children","footer","header"];function Cs(){return Cs=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Cs.apply(this,arguments)}function wd(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}var Ss=function(n){var e=n.children,t=n.footer,r=n.header,i=wd(n,vd);return P.createElement(ne,Cs({pad:"small",gap:"large",height:{min:"100%"}},i),r,P.createElement(ne,{flex:!0},e),t)};Ss.propTypes=bd,Ss.defaultProps={children:void 0,footer:void 0,header:void 0};var Cd=Ua(["outline:none;border:none;width:100%;-webkit-appearance:none;"]),Sd=function(n){return n==="horizontal"?"resize: horizontal;":n==="vertical"?"resize: vertical;":n?"resize: both;":"resize: none;"},ks=Hu.textarea.withConfig({displayName:"StyledTextArea",componentId:"sc-17i3mwp-0"})([""," "," "," "," "," ",";max-width:100%;"],uv,function(n){return n.resize!==void 0&&Sd(n.resize)},function(n){return n.fillArg&&"height: 100%;"},function(n){return n.plain&&Cd},function(n){return n.disabled&&dv(n.theme.textArea.disabled&&n.theme.textArea.disabled.opacity)},function(n){return n.theme.textArea&&n.theme.textArea.extend});ks.defaultProps={},Object.setPrototypeOf(ks.defaultProps,yr);var kd={},Td=kd,Ed=["a11yTitle","fill","focusIndicator","name","onBlur","onChange","onFocus","onKeyDown","value"];function Ts(){return Ts=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Ts.apply(this,arguments)}function Id(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}var Es=ye(function(n,e){var t=n.a11yTitle,r=n.fill,i=n.focusIndicator,s=i===void 0?!0:i,o=n.name,a=n.onBlur,l=n.onChange,c=n.onFocus,h=n.onKeyDown,u=n.value,d=Id(n,Ed),f=ys(vv),g=f.useFormInput({name:o,value:u}),y=g[0],v=g[1],C=tn(),I=C[0],k=C[1];return P.createElement(pv,{onEsc:function(w){w.stopPropagation(),w.nativeEvent.stopImmediatePropagation()},onKeyDown:h},P.createElement(ks,Ts({"aria-label":t,ref:e,name:o,fillArg:r,focus:I,value:y,focusIndicator:s},d,{onFocus:function(w){k(!0),c&&c(w)},onBlur:function(w){k(!1),a&&a(w)},onChange:function(w){v(w.target.value),l&&l(w)}})))});Es.displayName="TextArea",Es.propTypes=Td;function Is(){return Is=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Is.apply(this,arguments)}var Za=ye(function(n,e){return P.createElement(Pe,Is({ref:e,viewBox:"0 0 24 24",a11yTitle:"Camera"},n),P.createElement("path",{fill:"none",stroke:"#000",strokeWidth:"2",d:"M1 21V7h5l2-4h8l2 4h5v14H1zm11-3a5 5 0 1 0 0-10 5 5 0 0 0 0 10z"}))});Za.displayName="Camera";function Ns(){return Ns=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Ns.apply(this,arguments)}var xs=ye(function(n,e){return P.createElement(Pe,Ns({ref:e,viewBox:"0 0 24 24",a11yTitle:"CaretLeftFill"},n),P.createElement("path",{d:"M15 18V6l-6 6z",fill:"#000"}))});xs.displayName="CaretLeftFill";function Ps(){return Ps=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Ps.apply(this,arguments)}var el=ye(function(n,e){return P.createElement(Pe,Ps({ref:e,viewBox:"0 0 24 24",a11yTitle:"Chat"},n),P.createElement("path",{fill:"none",stroke:"#000",strokeWidth:"2",d:"M19 1H5a4 4 0 0 0-4 4v8a4 4 0 0 0 4 4h12l6 5V5a4 4 0 0 0-4-4zm0 6H6m13 4h-9"}))});el.displayName="Chat";function _i(){return _i=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_i.apply(this,arguments)}var tl=ye(function(n,e){var t=gv(n);return P.createElement(Pe,_i({ref:e,viewBox:"0 0 24 24",a11yTitle:"Close"},n),P.createElement("path",_i({fill:"none",stroke:"#000",strokeWidth:"2",d:"m3 3 18 18M3 21 21 3"},t)))});tl.displayName="Close";function As(){return As=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},As.apply(this,arguments)}var nl=ye(function(n,e){return P.createElement(Pe,As({ref:e,viewBox:"0 0 24 24",a11yTitle:"Copy"},n),P.createElement("path",{fill:"none",stroke:"#000",strokeWidth:"2",d:"M9 15h8-8zm0-4h10H9zm0-4h4-4zm7-6v6h6M6 5H2v18h16v-4m4 0H6V1h11l5 5v13z"}))});nl.displayName="Copy";function Rs(){return Rs=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Rs.apply(this,arguments)}var Os=ye(function(n,e){return P.createElement(Pe,Rs({ref:e,viewBox:"0 0 24 24",a11yTitle:"FormClose"},n),P.createElement("path",{fill:"none",stroke:"#000",strokeWidth:"2",d:"m7 7 10 10M7 17 17 7"}))});Os.displayName="FormClose";function Ds(){return Ds=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Ds.apply(this,arguments)}var rl=ye(function(n,e){return P.createElement(Pe,Ds({ref:e,viewBox:"0 0 24 24",a11yTitle:"FormDown"},n),P.createElement("path",{fill:"none",stroke:"#000",strokeWidth:"2",d:"m18 9-6 6-6-6"}))});rl.displayName="FormDown";function Ms(){return Ms=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Ms.apply(this,arguments)}var il=ye(function(n,e){return P.createElement(Pe,Ms({ref:e,viewBox:"0 0 24 24",a11yTitle:"FormNext"},n),P.createElement("path",{fill:"none",stroke:"#000",strokeWidth:"2",d:"m9 6 6 6-6 6"}))});il.displayName="FormNext";function Ls(){return Ls=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Ls.apply(this,arguments)}var sl=ye(function(n,e){return P.createElement(Pe,Ls({ref:e,viewBox:"0 0 24 24",a11yTitle:"FormPrevious"},n),P.createElement("path",{fill:"none",stroke:"#000",strokeWidth:"2",d:"m15 6-6 6 6 6"}))});sl.displayName="FormPrevious";function Fs(){return Fs=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Fs.apply(this,arguments)}var ol=ye(function(n,e){return P.createElement(Pe,Fs({ref:e,viewBox:"0 0 24 24",a11yTitle:"FormUp"},n),P.createElement("path",{fill:"none",stroke:"#000",strokeWidth:"2",d:"m18 15-6-6-6 6"}))});ol.displayName="FormUp";function Bs(){return Bs=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Bs.apply(this,arguments)}var al=ye(function(n,e){return P.createElement(Pe,Bs({ref:e,viewBox:"0 0 24 24",a11yTitle:"FormViewHide"},n),P.createElement("path",{fill:"none",stroke:"#000",strokeWidth:"2",d:"M3 12h3c.5 2.5 3.273 5 6 5s5.5-2.5 6-5h3m-9 5v3m-4.5-4.5-2 2m11-2 2 2"}))});al.displayName="FormViewHide";function qs(){return qs=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},qs.apply(this,arguments)}var ll=ye(function(n,e){return P.createElement(Pe,qs({ref:e,viewBox:"0 0 24 24",a11yTitle:"FormView"},n),P.createElement("path",{fill:"none",stroke:"#000",strokeWidth:"2",d:"M12 17c-2.727 0-6-2.778-6-5s3.273-5 6-5 6 2.778 6 5-3.273 5-6 5zm-1-5a1 1 0 1 0 2 0 1 1 0 0 0-2 0z"}))});ll.displayName="FormView";function zs(){return zs=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},zs.apply(this,arguments)}var cl=ye(function(n,e){return P.createElement(Pe,zs({ref:e,viewBox:"0 0 24 24",a11yTitle:"Key"},n),P.createElement("path",{fill:"none",stroke:"#000",strokeWidth:"2",d:"M10 13v3h3v3h3v2l2 2h5v-4L12.74 8.74C12.91 8.19 13 7.6 13 7c0-3.31-2.69-6-6-6S1 3.69 1 7a6.005 6.005 0 0 0 8.47 5.47L10 13zM6 7a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"}))});cl.displayName="Key";function Us(){return Us=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Us.apply(this,arguments)}var hl=ye(function(n,e){return P.createElement(Pe,Us({ref:e,viewBox:"0 0 24 24",a11yTitle:"Monitor"},n),P.createElement("path",{fill:"none",stroke:"#000",strokeWidth:"2",d:"M1 16h22V2H1v14zm4 6h14H5zm4 0h6v-6H9v6z"}))});hl.displayName="Monitor";function js(){return js=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},js.apply(this,arguments)}var Ws=ye(function(n,e){return P.createElement(Pe,js({ref:e,viewBox:"0 0 24 24",a11yTitle:"Phone"},n),P.createElement("path",{fill:"none",stroke:"#000",strokeWidth:"2",d:"M6.375 2C5 2 3 3.5 2.5 4.5c-.715 1.43-.597 1.99-.125 3.5.625 2 2.457 5.545 5 8 3.625 3.5 7 5 8.5 5.5s3.125 0 4.125-1 2-2 .875-3.5c-.797-1.063-1.959-2.292-3.375-3-1.288-.644-2.056-.41-2.5.5-.246.503-.322 1.466-.5 2-.225.674-1.125.5-2.125 0C11.418 16.021 9 14 7 11c-1.24-1.859.742-1.87 2-2.5 1-.5 1.31-1.65.5-3C8 3 7.5 2 6.375 2z"}))});Ws.displayName="Phone";function Hs(){return Hs=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Hs.apply(this,arguments)}var ul=ye(function(n,e){return P.createElement(Pe,Hs({ref:e,viewBox:"0 0 24 24",a11yTitle:"RadialSelected"},n),P.createElement("path",{fill:"none",stroke:"#000",strokeWidth:"2",d:"M12 23c6.075 0 11-4.925 11-11S18.075 1 12 1 1 5.925 1 12s4.925 11 11 11zm0-10a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 2a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 2a5 5 0 1 0 0-10 5 5 0 0 0 0 10z"}))});ul.displayName="RadialSelected";function Vs(){return Vs=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Vs.apply(this,arguments)}var dl=ye(function(n,e){return P.createElement(Pe,Vs({ref:e,viewBox:"0 0 24 24",a11yTitle:"Radial"},n),P.createElement("circle",{cx:"12",cy:"12",r:"11",fill:"none",stroke:"#000",strokeWidth:"2"}))});dl.displayName="Radial";function $s(){return $s=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},$s.apply(this,arguments)}var pl=ye(function(n,e){return P.createElement(Pe,$s({ref:e,viewBox:"0 0 24 24",a11yTitle:"Refresh"},n),P.createElement("path",{fill:"none",stroke:"#000",strokeWidth:"2",d:"M20 8c-1.403-2.96-4.463-5-8-5a9 9 0 1 0 0 18 9 9 0 0 0 9-9m0-9v6h-6"}))});pl.displayName="Refresh";function Gs(){return Gs=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Gs.apply(this,arguments)}var fl=ye(function(n,e){return P.createElement(Pe,Gs({ref:e,viewBox:"0 0 24 24",a11yTitle:"Return"},n),P.createElement("path",{fill:"none",stroke:"#000",strokeWidth:"2",d:"m9 19-5-5 5-5m9-5v10H5"}))});fl.displayName="Return";function Ys(){return Ys=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Ys.apply(this,arguments)}var ml=ye(function(n,e){return P.createElement(Pe,Ys({ref:e,viewBox:"0 0 24 24",a11yTitle:"Send"},n),P.createElement("path",{fill:"none",stroke:"#000",strokeWidth:"2",d:"M22 3 2 11l18.5 8L22 3zM10 20.5l3-4.5m2.5-6.5L9 14l.859 6.012c.078.546.216.537.306-.003L11 15l4.5-5.5z"}))});ml.displayName="Send";function Ks(){return Ks=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Ks.apply(this,arguments)}var _l=ye(function(n,e){return P.createElement(Pe,Ks({ref:e,viewBox:"0 0 24 24",a11yTitle:"SettingsOption"},n),P.createElement("path",{fill:"none",stroke:"#000",strokeWidth:"2",d:"M12 9V0m3 12h9M0 12h9m3 12v-9m0 6a9 9 0 1 0 0-18 9 9 0 0 0 0 18zM3.5 8.5 1 7.5m19.5 8 2.5 1M3 3l2.5 2.5M3 3l2.5 2.5M18 18l2.5 2.5m0-17.5L18 5.5M5.5 18 3 20.5m9-5.5a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm8.5-6.5 2.5-1m-7.5-4 1-2.5m-1 19.5 1 2.5m-8-2.5-1 2.5m-4-7.5-2.5 1m7.5-13L7.5 1"}))});_l.displayName="SettingsOption";function Qs(){return Qs=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Qs.apply(this,arguments)}var Js=ye(function(n,e){return P.createElement(Pe,Qs({ref:e,viewBox:"0 0 24 24",a11yTitle:"View"},n),P.createElement("path",{fill:"none",stroke:"#000",strokeWidth:"2",d:"M12 21c-5 0-11-5-11-9s6-9 11-9 11 5 11 9-6 9-11 9zm0-14a5 5 0 1 0 0 10 5 5 0 0 0 0-10z"}))});Js.displayName="View";function Xs(){return Xs=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Xs.apply(this,arguments)}var gl=ye(function(n,e){return P.createElement(Pe,Xs({ref:e,viewBox:"0 0 24 24",a11yTitle:"VolumeMute"},n),P.createElement("path",{fill:"none",stroke:"#000",strokeWidth:"2",d:"M1 8v8h5.099L12 21V3L6 8H1zm14 1 6 6m0-6-6 6"}))});gl.displayName="VolumeMute";function Zs(){return Zs=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Zs.apply(this,arguments)}var yl=ye(function(n,e){return P.createElement(Pe,Zs({ref:e,viewBox:"0 0 24 24",a11yTitle:"Volume"},n),P.createElement("path",{fill:"none",stroke:"#000",strokeWidth:"2",d:"M15 16a4 4 0 0 0 0-8m0 12c5 0 8-3.589 8-8s-3.589-8-8-8M1 12V8h5l6-5v18l-6-5H1v-4"}))});yl.displayName="Volume";const bl={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},S=function(n,e){if(!n)throw zn(e)},zn=function(n){return new Error("Firebase Database ("+bl.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)},vl=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Nd=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=n[t++],o=n[t++],a=n[t++],l=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const s=n[t++],o=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},eo={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const s=n[i],o=i+1<n.length,a=o?n[i+1]:0,l=i+2<n.length,c=l?n[i+2]:0,h=s>>2,u=(s&3)<<4|a>>4;let d=(a&15)<<2|c>>6,f=c&63;l||(f=64,o||(d=64)),r.push(t[h],t[u],t[d],t[f])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(vl(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Nd(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const s=t[n.charAt(i++)],o=i<n.length?t[n.charAt(i)]:0;++i;const a=i<n.length?t[n.charAt(i)]:64;++i;const l=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||o==null||a==null||l==null)throw new xd;const c=s<<2|o>>4;if(r.push(c),a!==64){const h=o<<4&240|a>>2;if(r.push(h),l!==64){const u=a<<6&192|l;r.push(u)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class xd extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const wl=function(n){const e=vl(n);return eo.encodeByteArray(e,!0)},gi=function(n){return wl(n).replace(/\./g,"")},to=function(n){try{return eo.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Pd(n){return Cl(void 0,n)}function Cl(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!Ad(t)||(n[t]=Cl(n[t],e[t]));return n}function Ad(n){return n!=="__proto__"}function Rd(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Od=()=>Rd().__FIREBASE_DEFAULTS__,Dd=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Md=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&to(n[1]);return e&&JSON.parse(e)},Sl=()=>{try{return Od()||Dd()||Md()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Ld=n=>{var e,t;return(t=(e=Sl())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},Fd=n=>{const e=Ld(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},kl=()=>{var n;return(n=Sl())===null||n===void 0?void 0:n.config};class jt{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function Bd(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[gi(JSON.stringify(t)),gi(JSON.stringify(o)),a].join(".")}function qd(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Tl(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(qd())}function zd(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function El(){return bl.NODE_ADMIN===!0}function Ud(){try{return typeof indexedDB=="object"}catch{return!1}}function jd(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}const Wd="FirebaseError";class Cr extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Wd,Object.setPrototypeOf(this,Cr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Il.prototype.create)}}class Il{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?Hd(s,r):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new Cr(i,a,r)}}function Hd(n,e){return n.replace(Vd,(t,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const Vd=/\{\$([^}]+)}/g;function Sr(n){return JSON.parse(n)}function We(n){return JSON.stringify(n)}const Nl=function(n){let e={},t={},r={},i="";try{const s=n.split(".");e=Sr(to(s[0])||""),t=Sr(to(s[1])||""),i=s[2],r=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:r,signature:i}},$d=function(n){const e=Nl(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},Gd=function(n){const e=Nl(n).claims;return typeof e=="object"&&e.admin===!0};function xt(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Un(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function no(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function yi(n,e,t){const r={};for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=e.call(t,n[i],i,n));return r}function ro(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const s=n[i],o=e[i];if(xl(s)&&xl(o)){if(!ro(s,o))return!1}else if(s!==o)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function xl(n){return n!==null&&typeof n=="object"}function Yd(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}class Kd{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const r=this.W_;if(typeof e=="string")for(let u=0;u<16;u++)r[u]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let u=0;u<16;u++)r[u]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let u=16;u<80;u++){const d=r[u-3]^r[u-8]^r[u-14]^r[u-16];r[u]=(d<<1|d>>>31)&4294967295}let i=this.chain_[0],s=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],c,h;for(let u=0;u<80;u++){u<40?u<20?(c=a^s&(o^a),h=1518500249):(c=s^o^a,h=1859775393):u<60?(c=s&o|a&(s|o),h=2400959708):(c=s^o^a,h=3395469782);const d=(i<<5|i>>>27)+c+l+h+r[u]&4294967295;l=a,a=o,o=(s<<30|s>>>2)&4294967295,s=i,i=d}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const r=t-this.blockSize;let i=0;const s=this.buf_;let o=this.inbuf_;for(;i<t;){if(o===0)for(;i<=r;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<t;)if(s[o]=e.charCodeAt(i),++o,++i,o===this.blockSize){this.compress_(s),o=0;break}}else for(;i<t;)if(s[o]=e[i],++o,++i,o===this.blockSize){this.compress_(s),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=t&255,t/=256;this.compress_(this.buf_);let r=0;for(let i=0;i<5;i++)for(let s=24;s>=0;s-=8)e[r]=this.chain_[i]>>s&255,++r;return e}}function jn(n,e){return`${n} failed: ${e} argument `}const Qd=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);if(i>=55296&&i<=56319){const s=i-55296;r++,S(r<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(r)-56320;i=65536+(s<<10)+o}i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):i<65536?(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},bi=function(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,t++):e+=3}return e};function gn(n){return n&&n._delegate?n._delegate:n}class kr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const yn="[DEFAULT]";class Jd{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new jt;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Zd(e))try{this.getOrInitializeService({instanceIdentifier:yn})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=yn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=yn){return this.instances.has(e)}getOptions(e=yn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);r===a&&o.resolve(i)}return i}onInit(e,t){var r;const i=this.normalizeInstanceIdentifier(t),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);const o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Xd(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=yn){return this.component?this.component.multipleInstances?e:yn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Xd(n){return n===yn?void 0:n}function Zd(n){return n.instantiationMode==="EAGER"}class ep{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Jd(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var we;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(we||(we={}));const tp={debug:we.DEBUG,verbose:we.VERBOSE,info:we.INFO,warn:we.WARN,error:we.ERROR,silent:we.SILENT},np=we.INFO,rp={[we.DEBUG]:"log",[we.VERBOSE]:"log",[we.INFO]:"info",[we.WARN]:"warn",[we.ERROR]:"error"},ip=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),i=rp[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Pl{constructor(e){this.name=e,this._logLevel=np,this._logHandler=ip,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in we))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?tp[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,we.DEBUG,...e),this._logHandler(this,we.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,we.VERBOSE,...e),this._logHandler(this,we.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,we.INFO,...e),this._logHandler(this,we.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,we.WARN,...e),this._logHandler(this,we.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,we.ERROR,...e),this._logHandler(this,we.ERROR,...e)}}const sp=(n,e)=>e.some(t=>n instanceof t);let Al,Rl;function op(){return Al||(Al=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ap(){return Rl||(Rl=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Ol=new WeakMap,io=new WeakMap,Dl=new WeakMap,so=new WeakMap,oo=new WeakMap;function lp(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(sn(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Ol.set(t,n)}).catch(()=>{}),oo.set(e,n),e}function cp(n){if(io.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});io.set(n,e)}let ao={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return io.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Dl.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return sn(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function hp(n){ao=n(ao)}function up(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(lo(this),e,...t);return Dl.set(r,e.sort?e.sort():[e]),sn(r)}:ap().includes(n)?function(...e){return n.apply(lo(this),e),sn(Ol.get(this))}:function(...e){return sn(n.apply(lo(this),e))}}function dp(n){return typeof n=="function"?up(n):(n instanceof IDBTransaction&&cp(n),sp(n,op())?new Proxy(n,ao):n)}function sn(n){if(n instanceof IDBRequest)return lp(n);if(so.has(n))return so.get(n);const e=dp(n);return e!==n&&(so.set(n,e),oo.set(e,n)),e}const lo=n=>oo.get(n);function pp(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(n,e),a=sn(o);return r&&o.addEventListener("upgradeneeded",l=>{r(sn(o.result),l.oldVersion,l.newVersion,sn(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const fp=["get","getKey","getAll","getAllKeys","count"],mp=["put","add","delete","clear"],co=new Map;function Ml(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(co.get(e))return co.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=mp.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||fp.includes(t)))return;const s=async function(o,...a){const l=this.transaction(o,i?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),i&&l.done]))[0]};return co.set(e,s),s}hp(n=>({...n,get:(e,t,r)=>Ml(e,t)||n.get(e,t,r),has:(e,t)=>!!Ml(e,t)||n.has(e,t)}));class _p{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(gp(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}else return null}).filter(e=>e).join(" ")}}function gp(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const ho="@firebase/app",Ll="0.9.20",bn=new Pl("@firebase/app"),yp="@firebase/app-compat",bp="@firebase/analytics-compat",vp="@firebase/analytics",wp="@firebase/app-check-compat",Cp="@firebase/app-check",Sp="@firebase/auth",kp="@firebase/auth-compat",Tp="@firebase/database",Ep="@firebase/database-compat",Ip="@firebase/functions",Np="@firebase/functions-compat",xp="@firebase/installations",Pp="@firebase/installations-compat",Ap="@firebase/messaging",Rp="@firebase/messaging-compat",Op="@firebase/performance",Dp="@firebase/performance-compat",Mp="@firebase/remote-config",Lp="@firebase/remote-config-compat",Fp="@firebase/storage",Bp="@firebase/storage-compat",qp="@firebase/firestore",zp="@firebase/firestore-compat",Up="firebase",jp="10.5.0",uo="[DEFAULT]",Wp={[ho]:"fire-core",[yp]:"fire-core-compat",[vp]:"fire-analytics",[bp]:"fire-analytics-compat",[Cp]:"fire-app-check",[wp]:"fire-app-check-compat",[Sp]:"fire-auth",[kp]:"fire-auth-compat",[Tp]:"fire-rtdb",[Ep]:"fire-rtdb-compat",[Ip]:"fire-fn",[Np]:"fire-fn-compat",[xp]:"fire-iid",[Pp]:"fire-iid-compat",[Ap]:"fire-fcm",[Rp]:"fire-fcm-compat",[Op]:"fire-perf",[Dp]:"fire-perf-compat",[Mp]:"fire-rc",[Lp]:"fire-rc-compat",[Fp]:"fire-gcs",[Bp]:"fire-gcs-compat",[qp]:"fire-fst",[zp]:"fire-fst-compat","fire-js":"fire-js",[Up]:"fire-js-all"},vi=new Map,po=new Map;function Hp(n,e){try{n.container.addComponent(e)}catch(t){bn.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function wi(n){const e=n.name;if(po.has(e))return bn.debug(`There were multiple attempts to register component ${e}.`),!1;po.set(e,n);for(const t of vi.values())Hp(t,n);return!0}function Vp(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}const $p={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},on=new Il("app","Firebase",$p);class Gp{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new kr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw on.create("app-deleted",{appName:this._name})}}const Yp=jp;function Fl(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:uo,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw on.create("bad-app-name",{appName:String(i)});if(t||(t=kl()),!t)throw on.create("no-options");const s=vi.get(i);if(s){if(ro(t,s.options)&&ro(r,s.config))return s;throw on.create("duplicate-app",{appName:i})}const o=new ep(i);for(const l of po.values())o.addComponent(l);const a=new Gp(t,r,o);return vi.set(i,a),a}function Kp(n=uo){const e=vi.get(n);if(!e&&n===uo&&kl())return Fl();if(!e)throw on.create("no-app",{appName:n});return e}function Wn(n,e,t){var r;let i=(r=Wp[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${i}" with version "${e}":`];s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),bn.warn(a.join(" "));return}wi(new kr(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}const Qp="firebase-heartbeat-database",Jp=1,Tr="firebase-heartbeat-store";let fo=null;function Bl(){return fo||(fo=pp(Qp,Jp,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Tr)}}}).catch(n=>{throw on.create("idb-open",{originalErrorMessage:n.message})})),fo}async function Xp(n){try{return await(await Bl()).transaction(Tr).objectStore(Tr).get(zl(n))}catch(e){if(e instanceof Cr)bn.warn(e.message);else{const t=on.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});bn.warn(t.message)}}}async function ql(n,e){try{const t=(await Bl()).transaction(Tr,"readwrite");await t.objectStore(Tr).put(e,zl(n)),await t.done}catch(t){if(t instanceof Cr)bn.warn(t.message);else{const r=on.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});bn.warn(r.message)}}}function zl(n){return`${n.name}!${n.options.appId}`}const Zp=1024,ef=30*24*60*60*1e3;class tf{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new rf(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=Ul();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(r=>r.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(r=>{const i=new Date(r.date).valueOf();return Date.now()-i<=ef}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Ul(),{heartbeatsToSend:t,unsentEntries:r}=nf(this._heartbeatsCache.heartbeats),i=gi(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function Ul(){return new Date().toISOString().substring(0,10)}function nf(n,e=Zp){const t=[];let r=n.slice();for(const i of n){const s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),jl(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),jl(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class rf{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ud()?jd().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await Xp(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return ql(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return ql(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function jl(n){return gi(JSON.stringify({version:2,heartbeats:n})).length}function sf(n){wi(new kr("platform-logger",e=>new _p(e),"PRIVATE")),wi(new kr("heartbeat",e=>new tf(e),"PRIVATE")),Wn(ho,Ll,n),Wn(ho,Ll,"esm2017"),Wn("fire-js","")}sf("");var of="firebase",af="10.5.0";Wn(of,af,"app");const Wl="@firebase/database",Hl="1.0.1";let Vl="";function lf(n){Vl=n}class cf{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),We(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Sr(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class hf{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return xt(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const $l=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new cf(e)}}catch{}return new hf},vn=$l("localStorage"),mo=$l("sessionStorage"),Hn=new Pl("@firebase/database"),uf=function(){let n=1;return function(){return n++}}(),Gl=function(n){const e=Qd(n),t=new Kd;t.update(e);const r=t.digest();return eo.encodeByteArray(r)},Er=function(...n){let e="";for(let t=0;t<n.length;t++){const r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Er.apply(null,r):typeof r=="object"?e+=We(r):e+=r,e+=" "}return e};let wn=null,Yl=!0;const df=function(n,e){S(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Hn.logLevel=we.VERBOSE,wn=Hn.log.bind(Hn),e&&mo.set("logging_enabled",!0)):typeof n=="function"?wn=n:(wn=null,mo.remove("logging_enabled"))},Ke=function(...n){if(Yl===!0&&(Yl=!1,wn===null&&mo.get("logging_enabled")===!0&&df(!0)),wn){const e=Er.apply(null,n);wn(e)}},Ir=function(n){return function(...e){Ke(n,...e)}},_o=function(...n){const e="FIREBASE INTERNAL ERROR: "+Er(...n);Hn.error(e)},Wt=function(...n){const e=`FIREBASE FATAL ERROR: ${Er(...n)}`;throw Hn.error(e),new Error(e)},it=function(...n){const e="FIREBASE WARNING: "+Er(...n);Hn.warn(e)},pf=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&it("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Ci=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},ff=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Vn="[MIN_NAME]",Cn="[MAX_NAME]",Sn=function(n,e){if(n===e)return 0;if(n===Vn||e===Cn)return-1;if(e===Vn||n===Cn)return 1;{const t=Jl(n),r=Jl(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},mf=function(n,e){return n===e?0:n<e?-1:1},Nr=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+We(e))},go=function(n){if(typeof n!="object"||n===null)return We(n);const e=[];for(const r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=We(e[r]),t+=":",t+=go(n[e[r]]);return t+="}",t},Kl=function(n,e){const t=n.length;if(t<=e)return[n];const r=[];for(let i=0;i<t;i+=e)i+e>t?r.push(n.substring(i,t)):r.push(n.substring(i,i+e));return r};function Ze(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const Ql=function(n){S(!Ci(n),"Invalid JSON number");const e=11,t=52,r=(1<<e-1)-1;let i,s,o,a,l;n===0?(s=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),s=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-r-t))));const c=[];for(l=t;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(s%2?1:0),s=Math.floor(s/2);c.push(i?1:0),c.reverse();const h=c.join("");let u="";for(l=0;l<64;l+=8){let d=parseInt(h.substr(l,8),2).toString(16);d.length===1&&(d="0"+d),u=u+d}return u.toLowerCase()},_f=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},gf=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function yf(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}const bf=new RegExp("^-?(0*)\\d{1,10}$"),vf=-2147483648,wf=2147483647,Jl=function(n){if(bf.test(n)){const e=Number(n);if(e>=vf&&e<=wf)return e}return null},$n=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw it("Exception was thrown by user callback.",t),e},Math.floor(0))}},Cf=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},xr=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};class Sf{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||(t==null||t.get().then(r=>this.appCheck=r))}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){it(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class kf{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Ke("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',it(e)}}class Gn{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Gn.OWNER="owner";const yo="5",Xl="v",Zl="s",ec="r",tc="f",nc=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,rc="ls",ic="p",bo="ac",sc="websocket",oc="long_polling";class ac{constructor(e,t,r,i,s=!1,o="",a=!1,l=!1){this.secure=t,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=vn.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&vn.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Tf(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function lc(n,e,t){S(typeof e=="string","typeof type must == string"),S(typeof t=="object","typeof params must == object");let r;if(e===sc)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===oc)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Tf(n)&&(t.ns=n.namespace);const i=[];return Ze(t,(s,o)=>{i.push(s+"="+o)}),r+i.join("&")}class Ef{constructor(){this.counters_={}}incrementCounter(e,t=1){xt(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Pd(this.counters_)}}const vo={},wo={};function Co(n){const e=n.toString();return vo[e]||(vo[e]=new Ef),vo[e]}function If(n,e){const t=n.toString();return wo[t]||(wo[t]=e()),wo[t]}class Nf{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&$n(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const cc="start",xf="close",Pf="pLPCommand",Af="pRTLPCB",hc="id",uc="pw",dc="ser",Rf="cb",Of="seg",Df="ts",Mf="d",Lf="dframe",pc=1870,fc=30,Ff=pc-fc,Bf=25e3,qf=3e4;class Yn{constructor(e,t,r,i,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Ir(e),this.stats_=Co(t),this.urlFn=l=>(this.appCheckToken&&(l[bo]=this.appCheckToken),lc(t,oc,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Nf(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(qf)),ff(()=>{if(this.isClosed_)return;this.scriptTagHolder=new So((...s)=>{const[o,a,l,c,h]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===cc)this.id=a,this.password=l;else if(o===xf)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{const[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const r={};r[cc]="t",r[dc]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[Rf]=this.scriptTagHolder.uniqueCallbackIdentifier),r[Xl]=yo,this.transportSessionId&&(r[Zl]=this.transportSessionId),this.lastSessionId&&(r[rc]=this.lastSessionId),this.applicationId&&(r[ic]=this.applicationId),this.appCheckToken&&(r[bo]=this.appCheckToken),typeof location<"u"&&location.hostname&&nc.test(location.hostname)&&(r[ec]=tc);const i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Yn.forceAllow_=!0}static forceDisallow(){Yn.forceDisallow_=!0}static isAvailable(){return Yn.forceAllow_?!0:!Yn.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!_f()&&!gf()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=We(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=wl(t),i=Kl(r,Ff);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const r={};r[Lf]="t",r[hc]=e,r[uc]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=We(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class So{constructor(e,t,r,i){this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=uf(),window[Pf+this.uniqueCallbackIdentifier]=e,window[Af+this.uniqueCallbackIdentifier]=t,this.myIFrame=So.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Ke("frame writing exception"),a.stack&&Ke(a.stack),Ke(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Ke("No IE domain setting required")}catch{const t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[hc]=this.myID,e[uc]=this.myPW,e[dc]=this.currentSerial;let t=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+fc+r.length<=pc;){const s=this.pendingSegs.shift();r=r+"&"+Of+i+"="+s.seg+"&"+Df+i+"="+s.ts+"&"+Mf+i+"="+s.d,i++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(r,Math.floor(Bf)),s=()=>{clearTimeout(i),r()};this.addTag(e,s)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{Ke("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}const zf=16384,Uf=45e3;let Si=null;typeof MozWebSocket<"u"?Si=MozWebSocket:typeof WebSocket<"u"&&(Si=WebSocket);class vt{constructor(e,t,r,i,s,o,a){this.connId=e,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Ir(this.connId),this.stats_=Co(t),this.connURL=vt.connectionURL_(t,o,a,i,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,i,s){const o={};return o[Xl]=yo,typeof location<"u"&&location.hostname&&nc.test(location.hostname)&&(o[ec]=tc),t&&(o[Zl]=t),r&&(o[rc]=r),i&&(o[bo]=i),s&&(o[ic]=s),lc(e,sc,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,vn.set("previous_websocket_failure",!0);try{let r;El(),this.mySock=new Si(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){vt.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(t);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&Si!==null&&!vt.forceDisallow_}static previouslyFailed(){return vn.isInMemoryStorage||vn.get("previous_websocket_failure")===!0}markConnectionHealthy(){vn.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const r=Sr(t);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(S(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const r=this.extractFrameCount_(t);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const t=We(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=Kl(t,zf);r.length>1&&this.sendString_(String(r.length));for(let i=0;i<r.length;i++)this.sendString_(r[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Uf))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}vt.responsesRequiredToBeHealthy=2,vt.healthyTimeout=3e4;class Pr{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Yn,vt]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=vt&&vt.isAvailable();let r=t&&!vt.previouslyFailed();if(e.webSocketOnly&&(t||it("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[vt];else{const i=this.transports_=[];for(const s of Pr.ALL_TRANSPORTS)s&&s.isAvailable()&&i.push(s);Pr.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Pr.globalTransportInitialized_=!1;const jf=6e4,Wf=5e3,Hf=10*1024,Vf=100*1024,ko="t",mc="d",$f="s",_c="r",Gf="e",gc="o",yc="a",bc="n",vc="p",Yf="h";class Kf{constructor(e,t,r,i,s,o,a,l,c,h){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Ir("c:"+this.id+":"),this.transportManager_=new Pr(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=xr(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Vf?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Hf?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(ko in e){const t=e[ko];t===yc?this.upgradeIfSecondaryHealthy_():t===_c?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===gc&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Nr("t",e),r=Nr("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:vc,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:yc,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:bc,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Nr("t",e),r=Nr("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Nr(ko,e);if(mc in e){const r=e[mc];if(t===Yf){const i=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===bc){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===$f?this.onConnectionShutdown_(r):t===_c?this.onReset_(r):t===Gf?_o("Server Error: "+r):t===gc?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):_o("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),yo!==r&&it("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),xr(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(jf))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):xr(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Wf))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:vc,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(vn.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class wc{put(e,t,r,i){}merge(e,t,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}class Cc{constructor(e){this.allowedEvents_=e,this.listeners_={},S(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});const i=this.getInitialEvent(e);i&&t.apply(r,i)}off(e,t,r){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let s=0;s<i.length;s++)if(i[s].callback===t&&(!r||r===i[s].context)){i.splice(s,1);return}}validateEventType_(e){S(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class ki extends Cc{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Tl()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new ki}getInitialEvent(e){return S(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const Sc=32,kc=768;class me{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function pe(){return new me("")}function H(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function an(n){return n.pieces_.length-n.pieceNum_}function be(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new me(n.pieces_,e)}function To(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function Qf(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Ar(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function Tc(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new me(e,0)}function Fe(n,e){const t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof me)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{const r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&t.push(r[i])}return new me(t,0)}function $(n){return n.pieceNum_>=n.pieces_.length}function st(n,e){const t=H(n),r=H(e);if(t===null)return e;if(t===r)return st(be(n),be(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function Jf(n,e){const t=Ar(n,0),r=Ar(e,0);for(let i=0;i<t.length&&i<r.length;i++){const s=Sn(t[i],r[i]);if(s!==0)return s}return t.length===r.length?0:t.length<r.length?-1:1}function Eo(n,e){if(an(n)!==an(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function dt(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(an(n)>an(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}class Xf{constructor(e,t){this.errorPrefix_=t,this.parts_=Ar(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=bi(this.parts_[r]);Ec(this)}}function Zf(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=bi(e),Ec(n)}function em(n){const e=n.parts_.pop();n.byteLength_-=bi(e),n.parts_.length>0&&(n.byteLength_-=1)}function Ec(n){if(n.byteLength_>kc)throw new Error(n.errorPrefix_+"has a key path longer than "+kc+" bytes ("+n.byteLength_+").");if(n.parts_.length>Sc)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Sc+") or object contains a cycle "+kn(n))}function kn(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}class Io extends Cc{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}static getInstance(){return new Io}getInitialEvent(e){return S(e==="visible","Unknown event type: "+e),[this.visible_]}}const Rr=1e3,tm=60*5*1e3,Ic=30*1e3,nm=1.3,rm=3e4,im="server_kill",Nc=3;class Ht extends wc{constructor(e,t,r,i,s,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=i,this.onServerInfoUpdate_=s,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=Ht.nextPersistentConnectionId_++,this.log_=Ir("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Rr,this.maxReconnectDelay_=tm,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!El())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Io.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&ki.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){const i=++this.requestNumber_,s={r:i,a:e,b:t};this.log_(We(s)),S(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),r&&(this.requestCBHash_[i]=r)}get(e){this.initConnection_();const t=new jt,r={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:s=>{const o=s.d;s.s==="ok"?t.resolve(o):t.reject(o)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,r,i){this.initConnection_();const s=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+s),this.listens.has(o)||this.listens.set(o,new Map),S(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),S(!this.listens.get(o).has(s),"listen() called twice for same path/queryId.");const a={onComplete:i,hashFn:t,query:e,tag:r};this.listens.get(o).set(s,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(r)})}sendListen_(e){const t=e.query,r=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+r+" for "+i);const s={p:r},o="q";e.tag&&(s.q=t._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest(o,s,a=>{const l=a.d,c=a.s;Ht.warnOnListenWarnings_(l,t),(this.listens.get(r)&&this.listens.get(r).get(i))===e&&(this.log_("listen response",a),c!=="ok"&&this.removeListen_(r,i),e.onComplete&&e.onComplete(c,l))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&xt(e,"w")){const r=Un(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const i='".indexOn": "'+t._queryParams.getIndex().toString()+'"',s=t._path.toString();it(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${s} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||Gd(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Ic)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=$d(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(t,r,i=>{const s=i.s,o=i.d||"error";this.authToken_===e&&(s==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(s,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,r=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){const r=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+i),S(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,i)&&this.connected_&&this.sendUnlisten_(r,i,e._queryObject,t)}sendUnlisten_(e,t,r,i){this.log_("Unlisten on "+e+" for "+t);const s={p:e},o="n";i&&(s.q=r,s.t=i),this.sendRequest(o,s)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,i){const s={p:t,d:r};this.log_("onDisconnect "+e,s),this.sendRequest(e,s,o=>{i&&setTimeout(()=>{i(o.s,o.d)},Math.floor(0))})}put(e,t,r,i){this.putInternal("p",e,t,r,i)}merge(e,t,r,i){this.putInternal("m",e,t,r,i)}putInternal(e,t,r,i,s){this.initConnection_();const o={p:t,d:r};s!==void 0&&(o.h=s),this.outstandingPuts_.push({action:e,request:o,onComplete:i}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,r,s=>{this.log_(t+" response",s),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(s.s,s.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+We(e));const t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):_o("Unrecognized action received from server: "+We(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){S(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Rr,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Rr,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>rm&&(this.reconnectDelay_=Rr),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*nm)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Ht.nextConnectionId_++,s=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,r())},c=function(u){S(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(u)};this.realtime_={close:l,sendRequest:c};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[u,d]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?Ke("getToken() completed but was canceled"):(Ke("getToken() completed. Creating connection."),this.authToken_=u&&u.accessToken,this.appCheckToken_=d&&d.token,a=new Kf(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,f=>{it(f+" ("+this.repoInfo_.toString()+")"),this.interrupt(im)},s))}catch(u){this.log_("Failed to get token: "+u),o||(this.repoInfo_.nodeAdmin&&it(u),l())}}}interrupt(e){Ke("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Ke("Resuming connection for reason: "+e),delete this.interruptReasons_[e],no(this.interruptReasons_)&&(this.reconnectDelay_=Rr,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;t?r=t.map(s=>go(s)).join("$"):r="default";const i=this.removeListen_(e,r);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const r=new me(e).toString();let i;if(this.listens.has(r)){const s=this.listens.get(r);i=s.get(t),s.delete(t),s.size===0&&this.listens.delete(r)}else i=void 0;return i}onAuthRevoked_(e,t){Ke("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Nc&&(this.reconnectDelay_=Ic,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Ke("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Nc&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+Vl.replace(/\./g,"-")]=1,Tl()?e["framework.cordova"]=1:zd()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=ki.getInstance().currentlyOnline();return no(this.interruptReasons_)&&e}}Ht.nextPersistentConnectionId_=0,Ht.nextConnectionId_=0;class G{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new G(e,t)}}class Ti{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const r=new G(Vn,e),i=new G(Vn,t);return this.compare(r,i)!==0}minPost(){return G.MIN}}let Ei;class xc extends Ti{static get __EMPTY_NODE(){return Ei}static set __EMPTY_NODE(e){Ei=e}compare(e,t){return Sn(e.name,t.name)}isDefinedOn(e){throw zn("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return G.MIN}maxPost(){return new G(Cn,Ei)}makePost(e,t){return S(typeof e=="string","KeyIndex indexValue must always be a string."),new G(e,Ei)}toString(){return".key"}}const Kn=new xc;class Ii{constructor(e,t,r,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class He{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??He.RED,this.left=i??ot.EMPTY_NODE,this.right=s??ot.EMPTY_NODE}copy(e,t,r,i,s){return new He(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return s<0?i=i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i=i.copy(null,t,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return ot.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let r,i;if(r=this,t(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),t(e,r.key)===0){if(r.right.isEmpty())return ot.EMPTY_NODE;i=r.right.min_(),r=r.copy(i.key,i.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,He.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,He.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}He.RED=!0,He.BLACK=!1;class sm{copy(e,t,r,i,s){return this}insert(e,t,r){return new He(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class ot{constructor(e,t=ot.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new ot(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,He.BLACK,null,null))}remove(e){return new ot(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,He.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,i=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Ii(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Ii(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Ii(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Ii(this.root_,null,this.comparator_,!0,e)}}ot.EMPTY_NODE=new sm;function om(n,e){return Sn(n.name,e.name)}function No(n,e){return Sn(n,e)}let xo;function am(n){xo=n}const Pc=function(n){return typeof n=="number"?"number:"+Ql(n):"string:"+n},Ac=function(n){if(n.isLeafNode()){const e=n.val();S(typeof e=="string"||typeof e=="number"||typeof e=="object"&&xt(e,".sv"),"Priority must be a string or number.")}else S(n===xo||n.isEmpty(),"priority of unexpected type.");S(n===xo||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Rc;class Ve{constructor(e,t=Ve.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,S(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Ac(this.priorityNode_)}static set __childrenNodeConstructor(e){Rc=e}static get __childrenNodeConstructor(){return Rc}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Ve(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Ve.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return $(e)?this:H(e)===".priority"?this.priorityNode_:Ve.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:Ve.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const r=H(e);return r===null?t:t.isEmpty()&&r!==".priority"?this:(S(r!==".priority"||an(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,Ve.__childrenNodeConstructor.EMPTY_NODE.updateChild(be(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Pc(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=Ql(this.value_):e+=this.value_,this.lazyHash_=Gl(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Ve.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Ve.__childrenNodeConstructor?-1:(S(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,r=typeof this.value_,i=Ve.VALUE_TYPE_ORDER.indexOf(t),s=Ve.VALUE_TYPE_ORDER.indexOf(r);return S(i>=0,"Unknown leaf type: "+t),S(s>=0,"Unknown leaf type: "+r),i===s?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}Ve.VALUE_TYPE_ORDER=["object","boolean","number","string"];let Oc,Dc;function lm(n){Oc=n}function cm(n){Dc=n}class hm extends Ti{compare(e,t){const r=e.node.getPriority(),i=t.node.getPriority(),s=r.compareTo(i);return s===0?Sn(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return G.MIN}maxPost(){return new G(Cn,new Ve("[PRIORITY-POST]",Dc))}makePost(e,t){const r=Oc(e);return new G(t,new Ve("[PRIORITY-POST]",r))}toString(){return".priority"}}const Ae=new hm,um=Math.log(2);class dm{constructor(e){const t=s=>parseInt(Math.log(s)/um,10),r=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Ni=function(n,e,t,r){n.sort(e);const i=function(l,c){const h=c-l;let u,d;if(h===0)return null;if(h===1)return u=n[l],d=t?t(u):u,new He(d,u.node,He.BLACK,null,null);{const f=parseInt(h/2,10)+l,g=i(l,f),y=i(f+1,c);return u=n[f],d=t?t(u):u,new He(d,u.node,He.BLACK,g,y)}},s=function(l){let c=null,h=null,u=n.length;const d=function(g,y){const v=u-g,C=u;u-=g;const I=i(v+1,C),k=n[v],w=t?t(k):k;f(new He(w,k.node,y,null,I))},f=function(g){c?(c.left=g,c=g):(h=g,c=g)};for(let g=0;g<l.count;++g){const y=l.nextBitIsOne(),v=Math.pow(2,l.count-(g+1));y?d(v,He.BLACK):(d(v,He.BLACK),d(v,He.RED))}return h},o=new dm(n.length),a=s(o);return new ot(r||e,a)};let Po;const Qn={};class Vt{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return S(Qn&&Ae,"ChildrenNode.ts has not been loaded"),Po=Po||new Vt({".priority":Qn},{".priority":Ae}),Po}get(e){const t=Un(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof ot?t:null}hasIndex(e){return xt(this.indexSet_,e.toString())}addIndex(e,t){S(e!==Kn,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let i=!1;const s=t.getIterator(G.Wrap);let o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();let a;i?a=Ni(r,e.getCompare()):a=Qn;const l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;const h=Object.assign({},this.indexes_);return h[l]=a,new Vt(h,c)}addToIndexes(e,t){const r=yi(this.indexes_,(i,s)=>{const o=Un(this.indexSet_,s);if(S(o,"Missing index implementation for "+s),i===Qn)if(o.isDefinedOn(e.node)){const a=[],l=t.getIterator(G.Wrap);let c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),Ni(a,o.getCompare())}else return Qn;else{const a=t.get(e.name);let l=i;return a&&(l=l.remove(new G(e.name,a))),l.insert(e,e.node)}});return new Vt(r,this.indexSet_)}removeFromIndexes(e,t){const r=yi(this.indexes_,i=>{if(i===Qn)return i;{const s=t.get(e.name);return s?i.remove(new G(e.name,s)):i}});return new Vt(r,this.indexSet_)}}let Or;class M{constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&Ac(this.priorityNode_),this.children_.isEmpty()&&S(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Or||(Or=new M(new ot(No),null,Vt.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Or}updatePriority(e){return this.children_.isEmpty()?this:new M(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?Or:t}}getChild(e){const t=H(e);return t===null?this:this.getImmediateChild(t).getChild(be(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(S(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const r=new G(e,t);let i,s;t.isEmpty()?(i=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(e,t),s=this.indexMap_.addToIndexes(r,this.children_));const o=i.isEmpty()?Or:this.priorityNode_;return new M(i,o,s)}}updateChild(e,t){const r=H(e);if(r===null)return t;{S(H(e)!==".priority"||an(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(r).updateChild(be(e),t);return this.updateImmediateChild(r,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let r=0,i=0,s=!0;if(this.forEachChild(Ae,(o,a)=>{t[o]=a.val(e),r++,s&&M.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):s=!1}),!e&&s&&i<2*r){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Pc(this.getPriority().val())+":"),this.forEachChild(Ae,(t,r)=>{const i=r.hash();i!==""&&(e+=":"+t+":"+i)}),this.lazyHash_=e===""?"":Gl(e)}return this.lazyHash_}getPredecessorChildName(e,t,r){const i=this.resolveIndex_(r);if(i){const s=i.getPredecessorKey(new G(e,t));return s?s.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new G(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new G(t,this.children_.get(t)):null}forEachChild(e,t){const r=this.resolveIndex_(e);return r?r.inorderTraversal(i=>t(i.name,i.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,G.Wrap);let s=i.peek();for(;s!=null&&t.compare(s,e)<0;)i.getNext(),s=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,G.Wrap);let s=i.peek();for(;s!=null&&t.compare(s,e)>0;)i.getNext(),s=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Dr?-1:0}withIndex(e){if(e===Kn||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new M(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Kn||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const r=this.getIterator(Ae),i=t.getIterator(Ae);let s=r.getNext(),o=i.getNext();for(;s&&o;){if(s.name!==o.name||!s.node.equals(o.node))return!1;s=r.getNext(),o=i.getNext()}return s===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Kn?null:this.indexMap_.get(e.toString())}}M.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class pm extends M{constructor(){super(new ot(No),M.EMPTY_NODE,Vt.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return M.EMPTY_NODE}isEmpty(){return!1}}const Dr=new pm;Object.defineProperties(G,{MIN:{value:new G(Vn,M.EMPTY_NODE)},MAX:{value:new G(Cn,Dr)}}),xc.__EMPTY_NODE=M.EMPTY_NODE,Ve.__childrenNodeConstructor=M,am(Dr),cm(Dr);const fm=!0;function Be(n,e=null){if(n===null)return M.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),S(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new Ve(t,Be(e))}if(!(n instanceof Array)&&fm){const t=[];let r=!1;if(Ze(n,(s,o)=>{if(s.substring(0,1)!=="."){const a=Be(o);a.isEmpty()||(r=r||!a.getPriority().isEmpty(),t.push(new G(s,a)))}}),t.length===0)return M.EMPTY_NODE;const i=Ni(t,om,s=>s.name,No);if(r){const s=Ni(t,Ae.getCompare());return new M(i,Be(e),new Vt({".priority":s},{".priority":Ae}))}else return new M(i,Be(e),Vt.Default)}else{let t=M.EMPTY_NODE;return Ze(n,(r,i)=>{if(xt(n,r)&&r.substring(0,1)!=="."){const s=Be(i);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(r,s))}}),t.updatePriority(Be(e))}}lm(Be);class mm extends Ti{constructor(e){super(),this.indexPath_=e,S(!$(e)&&H(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const r=this.extractChild(e.node),i=this.extractChild(t.node),s=r.compareTo(i);return s===0?Sn(e.name,t.name):s}makePost(e,t){const r=Be(e),i=M.EMPTY_NODE.updateChild(this.indexPath_,r);return new G(t,i)}maxPost(){const e=M.EMPTY_NODE.updateChild(this.indexPath_,Dr);return new G(Cn,e)}toString(){return Ar(this.indexPath_,0).join("/")}}class _m extends Ti{compare(e,t){const r=e.node.compareTo(t.node);return r===0?Sn(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return G.MIN}maxPost(){return G.MAX}makePost(e,t){const r=Be(e);return new G(t,r)}toString(){return".value"}}const gm=new _m;function Mc(n){return{type:"value",snapshotNode:n}}function Jn(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Mr(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Lr(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function ym(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}class Ao{constructor(e){this.index_=e}updateChild(e,t,r,i,s,o){S(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(i).equals(r.getChild(i))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(Mr(t,a)):S(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Jn(t,r)):o.trackChildChange(Lr(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(Ae,(i,s)=>{t.hasChild(i)||r.trackChildChange(Mr(i,s))}),t.isLeafNode()||t.forEachChild(Ae,(i,s)=>{if(e.hasChild(i)){const o=e.getImmediateChild(i);o.equals(s)||r.trackChildChange(Lr(i,s,o))}else r.trackChildChange(Jn(i,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?M.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Fr{constructor(e){this.indexedFilter_=new Ao(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Fr.getStartPost_(e),this.endPost_=Fr.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,i,s,o){return this.matches(new G(t,r))||(r=M.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,i,s,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=M.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(M.EMPTY_NODE);const s=this;return t.forEachChild(Ae,(o,a)=>{s.matches(new G(o,a))||(i=i.updateImmediateChild(o,M.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}class bm{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{const r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Fr(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,i,s,o){return this.rangedFilter_.matches(new G(t,r))||(r=M.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,i,s,o):this.fullLimitUpdateChild_(e,t,r,s,o)}updateFullNode(e,t,r){let i;if(t.isLeafNode()||t.isEmpty())i=M.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=M.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){const a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(M.EMPTY_NODE);let s;this.reverse_?s=i.getReverseIterator(this.index_):s=i.getIterator(this.index_);let o=0;for(;s.hasNext();){const a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,M.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,i,s){let o;if(this.reverse_){const u=this.index_.getCompare();o=(d,f)=>u(f,d)}else o=this.index_.getCompare();const a=e;S(a.numChildren()===this.limit_,"");const l=new G(t,r),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(t)){const u=a.getImmediateChild(t);let d=i.getChildAfterChild(this.index_,c,this.reverse_);for(;d!=null&&(d.name===t||a.hasChild(d.name));)d=i.getChildAfterChild(this.index_,d,this.reverse_);const f=d==null?1:o(d,l);if(h&&!r.isEmpty()&&f>=0)return s==null||s.trackChildChange(Lr(t,r,u)),a.updateImmediateChild(t,r);{s==null||s.trackChildChange(Mr(t,u));const g=a.updateImmediateChild(t,M.EMPTY_NODE);return d!=null&&this.rangedFilter_.matches(d)?(s==null||s.trackChildChange(Jn(d.name,d.node)),g.updateImmediateChild(d.name,d.node)):g}}else return r.isEmpty()?e:h&&o(c,l)>=0?(s!=null&&(s.trackChildChange(Mr(c.name,c.node)),s.trackChildChange(Jn(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(c.name,M.EMPTY_NODE)):e}}class Ro{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ae}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return S(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return S(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Vn}hasEnd(){return this.endSet_}getIndexEndValue(){return S(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return S(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Cn}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return S(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Ae}copy(){const e=new Ro;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function vm(n){return n.loadsAllData()?new Ao(n.getIndex()):n.hasLimit()?new bm(n):new Fr(n)}function Lc(n){const e={};if(n.isDefault())return e;let t;if(n.index_===Ae?t="$priority":n.index_===gm?t="$value":n.index_===Kn?t="$key":(S(n.index_ instanceof mm,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=We(t),n.startSet_){const r=n.startAfterSet_?"startAfter":"startAt";e[r]=We(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+We(n.indexStartName_))}if(n.endSet_){const r=n.endBeforeSet_?"endBefore":"endAt";e[r]=We(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+We(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function Fc(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==Ae&&(e.i=n.index_.toString()),e}class xi extends wc{constructor(e,t,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=Ir("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(S(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const o=xi.getListenId_(e,r),a={};this.listens_[o]=a;const l=Lc(e._queryParams);this.restRequest_(s+".json",l,(c,h)=>{let u=h;if(c===404&&(u=null,c=null),c===null&&this.onDataUpdate_(s,u,!1,r),Un(this.listens_,o)===a){let d;c?c===401?d="permission_denied":d="rest_error:"+c:d="ok",i(d,null)}})}unlisten(e,t){const r=xi.getListenId_(e,t);delete this.listens_[r]}get(e){const t=Lc(e._queryParams),r=e._path.toString(),i=new jt;return this.restRequest_(r+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(r,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,s])=>{i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Yd(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Sr(a.responseText)}catch{it("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,l)}else a.status!==401&&a.status!==404&&it("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}}class wm{constructor(){this.rootNode_=M.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Pi(){return{value:null,children:new Map}}function Xn(n,e,t){if($(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const r=H(e);n.children.has(r)||n.children.set(r,Pi());const i=n.children.get(r);e=be(e),Xn(i,e,t)}}function Oo(n,e){if($(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(Ae,(r,i)=>{Xn(n,new me(r),i)}),Oo(n,e)}}else if(n.children.size>0){const t=H(e);return e=be(e),n.children.has(t)&&Oo(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function Do(n,e,t){n.value!==null?t(e,n.value):Cm(n,(r,i)=>{const s=new me(e.toString()+"/"+r);Do(i,s,t)})}function Cm(n,e){n.children.forEach((t,r)=>{e(r,t)})}class Sm{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Ze(this.last_,(r,i)=>{t[r]=t[r]-i}),this.last_=e,t}}const Bc=10*1e3,km=30*1e3,Tm=5*60*1e3;class Em{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Sm(e);const r=Bc+(km-Bc)*Math.random();xr(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),t={};let r=!1;Ze(e,(i,s)=>{s>0&&xt(this.statsToReport_,i)&&(t[i]=s,r=!0)}),r&&this.server_.reportStats(t),xr(this.reportStats_.bind(this),Math.floor(Math.random()*2*Tm))}}var wt;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(wt||(wt={}));function qc(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Mo(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Lo(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class Ai{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=wt.ACK_USER_WRITE,this.source=qc()}operationForChild(e){if($(this.path)){if(this.affectedTree.value!=null)return S(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new me(e));return new Ai(pe(),t,this.revert)}}else return S(H(this.path)===e,"operationForChild called for unrelated child."),new Ai(be(this.path),this.affectedTree,this.revert)}}class Br{constructor(e,t){this.source=e,this.path=t,this.type=wt.LISTEN_COMPLETE}operationForChild(e){return $(this.path)?new Br(this.source,pe()):new Br(this.source,be(this.path))}}class Tn{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=wt.OVERWRITE}operationForChild(e){return $(this.path)?new Tn(this.source,pe(),this.snap.getImmediateChild(e)):new Tn(this.source,be(this.path),this.snap)}}class qr{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=wt.MERGE}operationForChild(e){if($(this.path)){const t=this.children.subtree(new me(e));return t.isEmpty()?null:t.value?new Tn(this.source,pe(),t.value):new qr(this.source,pe(),t)}else return S(H(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new qr(this.source,be(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class En{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if($(e))return this.isFullyInitialized()&&!this.filtered_;const t=H(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Im{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Nm(n,e,t,r){const i=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(ym(o.childName,o.snapshotNode))}),zr(n,i,"child_removed",e,r,t),zr(n,i,"child_added",e,r,t),zr(n,i,"child_moved",s,r,t),zr(n,i,"child_changed",e,r,t),zr(n,i,"value",e,r,t),i}function zr(n,e,t,r,i,s){const o=r.filter(a=>a.type===t);o.sort((a,l)=>Pm(n,a,l)),o.forEach(a=>{const l=xm(n,a,s);i.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,n.query_))})})}function xm(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function Pm(n,e,t){if(e.childName==null||t.childName==null)throw zn("Should only compare child_ events.");const r=new G(e.childName,e.snapshotNode),i=new G(t.childName,t.snapshotNode);return n.index_.compare(r,i)}function Ri(n,e){return{eventCache:n,serverCache:e}}function Ur(n,e,t,r){return Ri(new En(e,t,r),n.serverCache)}function zc(n,e,t,r){return Ri(n.eventCache,new En(e,t,r))}function Fo(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function In(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let Bo;const Am=()=>(Bo||(Bo=new ot(mf)),Bo);class ke{constructor(e,t=Am()){this.value=e,this.children=t}static fromObject(e){let t=new ke(null);return Ze(e,(r,i)=>{t=t.set(new me(r),i)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:pe(),value:this.value};if($(e))return null;{const r=H(e),i=this.children.get(r);if(i!==null){const s=i.findRootMostMatchingPathAndValue(be(e),t);return s!=null?{path:Fe(new me(r),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if($(e))return this;{const t=H(e),r=this.children.get(t);return r!==null?r.subtree(be(e)):new ke(null)}}set(e,t){if($(e))return new ke(t,this.children);{const r=H(e),i=(this.children.get(r)||new ke(null)).set(be(e),t),s=this.children.insert(r,i);return new ke(this.value,s)}}remove(e){if($(e))return this.children.isEmpty()?new ke(null):new ke(null,this.children);{const t=H(e),r=this.children.get(t);if(r){const i=r.remove(be(e));let s;return i.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,i),this.value===null&&s.isEmpty()?new ke(null):new ke(this.value,s)}else return this}}get(e){if($(e))return this.value;{const t=H(e),r=this.children.get(t);return r?r.get(be(e)):null}}setTree(e,t){if($(e))return t;{const r=H(e),i=(this.children.get(r)||new ke(null)).setTree(be(e),t);let s;return i.isEmpty()?s=this.children.remove(r):s=this.children.insert(r,i),new ke(this.value,s)}}fold(e){return this.fold_(pe(),e)}fold_(e,t){const r={};return this.children.inorderTraversal((i,s)=>{r[i]=s.fold_(Fe(e,i),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,pe(),t)}findOnPath_(e,t,r){const i=this.value?r(t,this.value):!1;if(i)return i;if($(e))return null;{const s=H(e),o=this.children.get(s);return o?o.findOnPath_(be(e),Fe(t,s),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,pe(),t)}foreachOnPath_(e,t,r){if($(e))return this;{this.value&&r(t,this.value);const i=H(e),s=this.children.get(i);return s?s.foreachOnPath_(be(e),Fe(t,i),r):new ke(null)}}foreach(e){this.foreach_(pe(),e)}foreach_(e,t){this.children.inorderTraversal((r,i)=>{i.foreach_(Fe(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}class Ct{constructor(e){this.writeTree_=e}static empty(){return new Ct(new ke(null))}}function jr(n,e,t){if($(e))return new Ct(new ke(t));{const r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){const i=r.path;let s=r.value;const o=st(i,e);return s=s.updateChild(o,t),new Ct(n.writeTree_.set(i,s))}else{const i=new ke(t),s=n.writeTree_.setTree(e,i);return new Ct(s)}}}function Uc(n,e,t){let r=n;return Ze(t,(i,s)=>{r=jr(r,Fe(e,i),s)}),r}function jc(n,e){if($(e))return Ct.empty();{const t=n.writeTree_.setTree(e,new ke(null));return new Ct(t)}}function qo(n,e){return Nn(n,e)!=null}function Nn(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(st(t.path,e)):null}function Wc(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Ae,(r,i)=>{e.push(new G(r,i))}):n.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new G(r,i.value))}),e}function ln(n,e){if($(e))return n;{const t=Nn(n,e);return t!=null?new Ct(new ke(t)):new Ct(n.writeTree_.subtree(e))}}function zo(n){return n.writeTree_.isEmpty()}function Zn(n,e){return Hc(pe(),n.writeTree_,e)}function Hc(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((i,s)=>{i===".priority"?(S(s.value!==null,"Priority writes must always be leaf nodes"),r=s.value):t=Hc(Fe(n,i),s,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(Fe(n,".priority"),r)),t}}function Uo(n,e){return Kc(e,n)}function Rm(n,e,t,r,i){S(r>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:i}),i&&(n.visibleWrites=jr(n.visibleWrites,e,t)),n.lastWriteId=r}function Om(n,e){for(let t=0;t<n.allWrites.length;t++){const r=n.allWrites[t];if(r.writeId===e)return r}return null}function Dm(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);S(t>=0,"removeWrite called with nonexistent writeId.");const r=n.allWrites[t];n.allWrites.splice(t,1);let i=r.visible,s=!1,o=n.allWrites.length-1;for(;i&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&Mm(a,r.path)?i=!1:dt(r.path,a.path)&&(s=!0)),o--}if(i){if(s)return Lm(n),!0;if(r.snap)n.visibleWrites=jc(n.visibleWrites,r.path);else{const a=r.children;Ze(a,l=>{n.visibleWrites=jc(n.visibleWrites,Fe(r.path,l))})}return!0}else return!1}function Mm(n,e){if(n.snap)return dt(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&dt(Fe(n.path,t),e))return!0;return!1}function Lm(n){n.visibleWrites=Vc(n.allWrites,Fm,pe()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function Fm(n){return n.visible}function Vc(n,e,t){let r=Ct.empty();for(let i=0;i<n.length;++i){const s=n[i];if(e(s)){const o=s.path;let a;if(s.snap)dt(t,o)?(a=st(t,o),r=jr(r,a,s.snap)):dt(o,t)&&(a=st(o,t),r=jr(r,pe(),s.snap.getChild(a)));else if(s.children){if(dt(t,o))a=st(t,o),r=Uc(r,a,s.children);else if(dt(o,t))if(a=st(o,t),$(a))r=Uc(r,pe(),s.children);else{const l=Un(s.children,H(a));if(l){const c=l.getChild(be(a));r=jr(r,pe(),c)}}}else throw zn("WriteRecord should have .snap or .children")}}return r}function $c(n,e,t,r,i){if(!r&&!i){const s=Nn(n.visibleWrites,e);if(s!=null)return s;{const o=ln(n.visibleWrites,e);if(zo(o))return t;if(t==null&&!qo(o,pe()))return null;{const a=t||M.EMPTY_NODE;return Zn(o,a)}}}else{const s=ln(n.visibleWrites,e);if(!i&&zo(s))return t;if(!i&&t==null&&!qo(s,pe()))return null;{const o=function(c){return(c.visible||i)&&(!r||!~r.indexOf(c.writeId))&&(dt(c.path,e)||dt(e,c.path))},a=Vc(n.allWrites,o,e),l=t||M.EMPTY_NODE;return Zn(a,l)}}}function Bm(n,e,t){let r=M.EMPTY_NODE;const i=Nn(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(Ae,(s,o)=>{r=r.updateImmediateChild(s,o)}),r;if(t){const s=ln(n.visibleWrites,e);return t.forEachChild(Ae,(o,a)=>{const l=Zn(ln(s,new me(o)),a);r=r.updateImmediateChild(o,l)}),Wc(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const s=ln(n.visibleWrites,e);return Wc(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function qm(n,e,t,r,i){S(r||i,"Either existingEventSnap or existingServerSnap must exist");const s=Fe(e,t);if(qo(n.visibleWrites,s))return null;{const o=ln(n.visibleWrites,s);return zo(o)?i.getChild(t):Zn(o,i.getChild(t))}}function zm(n,e,t,r){const i=Fe(e,t),s=Nn(n.visibleWrites,i);if(s!=null)return s;if(r.isCompleteForChild(t)){const o=ln(n.visibleWrites,i);return Zn(o,r.getNode().getImmediateChild(t))}else return null}function Um(n,e){return Nn(n.visibleWrites,e)}function jm(n,e,t,r,i,s,o){let a;const l=ln(n.visibleWrites,e),c=Nn(l,pe());if(c!=null)a=c;else if(t!=null)a=Zn(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],u=o.getCompare(),d=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let f=d.getNext();for(;f&&h.length<i;)u(f,r)!==0&&h.push(f),f=d.getNext();return h}else return[]}function Wm(){return{visibleWrites:Ct.empty(),allWrites:[],lastWriteId:-1}}function Oi(n,e,t,r){return $c(n.writeTree,n.treePath,e,t,r)}function jo(n,e){return Bm(n.writeTree,n.treePath,e)}function Gc(n,e,t,r){return qm(n.writeTree,n.treePath,e,t,r)}function Di(n,e){return Um(n.writeTree,Fe(n.treePath,e))}function Hm(n,e,t,r,i,s){return jm(n.writeTree,n.treePath,e,t,r,i,s)}function Wo(n,e,t){return zm(n.writeTree,n.treePath,e,t)}function Yc(n,e){return Kc(Fe(n.treePath,e),n.writeTree)}function Kc(n,e){return{treePath:n,writeTree:e}}class Vm{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,r=e.childName;S(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),S(r!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(r);if(i){const s=i.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(r,Lr(r,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(r,Mr(r,i.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(r,Jn(r,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(r,Lr(r,e.snapshotNode,i.oldSnap));else throw zn("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}class $m{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}}const Qc=new $m;class Ho{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new En(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Wo(this.writes_,e,r)}}getChildAfterChild(e,t,r){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:In(this.viewCache_),s=Hm(this.writes_,i,t,1,r,e);return s.length===0?null:s[0]}}function Gm(n){return{filter:n}}function Ym(n,e){S(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),S(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function Km(n,e,t,r,i){const s=new Vm;let o,a;if(t.type===wt.OVERWRITE){const c=t;c.source.fromUser?o=Vo(n,e,c.path,c.snap,r,i,s):(S(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!$(c.path),o=Mi(n,e,c.path,c.snap,r,i,a,s))}else if(t.type===wt.MERGE){const c=t;c.source.fromUser?o=Jm(n,e,c.path,c.children,r,i,s):(S(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=$o(n,e,c.path,c.children,r,i,a,s))}else if(t.type===wt.ACK_USER_WRITE){const c=t;c.revert?o=e_(n,e,c.path,r,i,s):o=Xm(n,e,c.path,c.affectedTree,r,i,s)}else if(t.type===wt.LISTEN_COMPLETE)o=Zm(n,e,t.path,r,s);else throw zn("Unknown operation type: "+t.type);const l=s.getChanges();return Qm(e,o,l),{viewCache:o,changes:l}}function Qm(n,e,t){const r=e.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=Fo(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&t.push(Mc(Fo(e)))}}function Jc(n,e,t,r,i,s){const o=e.eventCache;if(Di(r,t)!=null)return e;{let a,l;if($(t))if(S(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const c=In(e),h=c instanceof M?c:M.EMPTY_NODE,u=jo(r,h);a=n.filter.updateFullNode(e.eventCache.getNode(),u,s)}else{const c=Oi(r,In(e));a=n.filter.updateFullNode(e.eventCache.getNode(),c,s)}else{const c=H(t);if(c===".priority"){S(an(t)===1,"Can't have a priority with additional path components");const h=o.getNode();l=e.serverCache.getNode();const u=Gc(r,t,h,l);u!=null?a=n.filter.updatePriority(h,u):a=o.getNode()}else{const h=be(t);let u;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();const d=Gc(r,t,o.getNode(),l);d!=null?u=o.getNode().getImmediateChild(c).updateChild(h,d):u=o.getNode().getImmediateChild(c)}else u=Wo(r,c,e.serverCache);u!=null?a=n.filter.updateChild(o.getNode(),c,u,h,i,s):a=o.getNode()}}return Ur(e,a,o.isFullyInitialized()||$(t),n.filter.filtersNodes())}}function Mi(n,e,t,r,i,s,o,a){const l=e.serverCache;let c;const h=o?n.filter:n.filter.getIndexedFilter();if($(t))c=h.updateFullNode(l.getNode(),r,null);else if(h.filtersNodes()&&!l.isFiltered()){const f=l.getNode().updateChild(t,r);c=h.updateFullNode(l.getNode(),f,null)}else{const f=H(t);if(!l.isCompleteForPath(t)&&an(t)>1)return e;const g=be(t),y=l.getNode().getImmediateChild(f).updateChild(g,r);f===".priority"?c=h.updatePriority(l.getNode(),y):c=h.updateChild(l.getNode(),f,y,g,Qc,null)}const u=zc(e,c,l.isFullyInitialized()||$(t),h.filtersNodes()),d=new Ho(i,u,s);return Jc(n,u,t,i,d,a)}function Vo(n,e,t,r,i,s,o){const a=e.eventCache;let l,c;const h=new Ho(i,e,s);if($(t))c=n.filter.updateFullNode(e.eventCache.getNode(),r,o),l=Ur(e,c,!0,n.filter.filtersNodes());else{const u=H(t);if(u===".priority")c=n.filter.updatePriority(e.eventCache.getNode(),r),l=Ur(e,c,a.isFullyInitialized(),a.isFiltered());else{const d=be(t),f=a.getNode().getImmediateChild(u);let g;if($(d))g=r;else{const y=h.getCompleteChild(u);y!=null?To(d)===".priority"&&y.getChild(Tc(d)).isEmpty()?g=y:g=y.updateChild(d,r):g=M.EMPTY_NODE}if(f.equals(g))l=e;else{const y=n.filter.updateChild(a.getNode(),u,g,d,h,o);l=Ur(e,y,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function Xc(n,e){return n.eventCache.isCompleteForChild(e)}function Jm(n,e,t,r,i,s,o){let a=e;return r.foreach((l,c)=>{const h=Fe(t,l);Xc(e,H(h))&&(a=Vo(n,a,h,c,i,s,o))}),r.foreach((l,c)=>{const h=Fe(t,l);Xc(e,H(h))||(a=Vo(n,a,h,c,i,s,o))}),a}function Zc(n,e,t){return t.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function $o(n,e,t,r,i,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;$(t)?c=r:c=new ke(null).setTree(t,r);const h=e.serverCache.getNode();return c.children.inorderTraversal((u,d)=>{if(h.hasChild(u)){const f=e.serverCache.getNode().getImmediateChild(u),g=Zc(n,f,d);l=Mi(n,l,new me(u),g,i,s,o,a)}}),c.children.inorderTraversal((u,d)=>{const f=!e.serverCache.isCompleteForChild(u)&&d.value===null;if(!h.hasChild(u)&&!f){const g=e.serverCache.getNode().getImmediateChild(u),y=Zc(n,g,d);l=Mi(n,l,new me(u),y,i,s,o,a)}}),l}function Xm(n,e,t,r,i,s,o){if(Di(i,t)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(r.value!=null){if($(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return Mi(n,e,t,l.getNode().getChild(t),i,s,a,o);if($(t)){let c=new ke(null);return l.getNode().forEachChild(Kn,(h,u)=>{c=c.set(new me(h),u)}),$o(n,e,t,c,i,s,a,o)}else return e}else{let c=new ke(null);return r.foreach((h,u)=>{const d=Fe(t,h);l.isCompleteForPath(d)&&(c=c.set(h,l.getNode().getChild(d)))}),$o(n,e,t,c,i,s,a,o)}}function Zm(n,e,t,r,i){const s=e.serverCache,o=zc(e,s.getNode(),s.isFullyInitialized()||$(t),s.isFiltered());return Jc(n,o,t,r,Qc,i)}function e_(n,e,t,r,i,s){let o;if(Di(r,t)!=null)return e;{const a=new Ho(r,e,i),l=e.eventCache.getNode();let c;if($(t)||H(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=Oi(r,In(e));else{const u=e.serverCache.getNode();S(u instanceof M,"serverChildren would be complete if leaf node"),h=jo(r,u)}h=h,c=n.filter.updateFullNode(l,h,s)}else{const h=H(t);let u=Wo(r,h,e.serverCache);u==null&&e.serverCache.isCompleteForChild(h)&&(u=l.getImmediateChild(h)),u!=null?c=n.filter.updateChild(l,h,u,be(t),a,s):e.eventCache.getNode().hasChild(h)?c=n.filter.updateChild(l,h,M.EMPTY_NODE,be(t),a,s):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Oi(r,In(e)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,s)))}return o=e.serverCache.isFullyInitialized()||Di(r,pe())!=null,Ur(e,c,o,n.filter.filtersNodes())}}class t_{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,i=new Ao(r.getIndex()),s=vm(r);this.processor_=Gm(s);const o=t.serverCache,a=t.eventCache,l=i.updateFullNode(M.EMPTY_NODE,o.getNode(),null),c=s.updateFullNode(M.EMPTY_NODE,a.getNode(),null),h=new En(l,o.isFullyInitialized(),i.filtersNodes()),u=new En(c,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=Ri(u,h),this.eventGenerator_=new Im(this.query_)}get query(){return this.query_}}function n_(n){return n.viewCache_.serverCache.getNode()}function r_(n,e){const t=In(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!$(e)&&!t.getImmediateChild(H(e)).isEmpty())?t.getChild(e):null}function eh(n){return n.eventRegistrations_.length===0}function i_(n,e){n.eventRegistrations_.push(e)}function th(n,e,t){const r=[];if(t){S(e==null,"A cancel should cancel all event registrations.");const i=n.query._path;n.eventRegistrations_.forEach(s=>{const o=s.createCancelEvent(t,i);o&&r.push(o)})}if(e){let i=[];for(let s=0;s<n.eventRegistrations_.length;++s){const o=n.eventRegistrations_[s];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return r}function nh(n,e,t,r){e.type===wt.MERGE&&e.source.queryId!==null&&(S(In(n.viewCache_),"We should always have a full cache before handling merges"),S(Fo(n.viewCache_),"Missing event cache, even though we have a server cache"));const i=n.viewCache_,s=Km(n.processor_,i,e,t,r);return Ym(n.processor_,s.viewCache),S(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,rh(n,s.changes,s.viewCache.eventCache.getNode(),null)}function s_(n,e){const t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(Ae,(i,s)=>{r.push(Jn(i,s))}),t.isFullyInitialized()&&r.push(Mc(t.getNode())),rh(n,r,t.getNode(),e)}function rh(n,e,t,r){const i=r?[r]:n.eventRegistrations_;return Nm(n.eventGenerator_,e,t,i)}let Li;class o_{constructor(){this.views=new Map}}function a_(n){S(!Li,"__referenceConstructor has already been defined"),Li=n}function l_(){return S(Li,"Reference.ts has not been loaded"),Li}function c_(n){return n.views.size===0}function Go(n,e,t,r){const i=e.source.queryId;if(i!==null){const s=n.views.get(i);return S(s!=null,"SyncTree gave us an op for an invalid query."),nh(s,e,t,r)}else{let s=[];for(const o of n.views.values())s=s.concat(nh(o,e,t,r));return s}}function h_(n,e,t,r,i){const s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=Oi(t,i?r:null),l=!1;a?l=!0:r instanceof M?(a=jo(t,r),l=!1):(a=M.EMPTY_NODE,l=!1);const c=Ri(new En(a,l,!1),new En(r,i,!1));return new t_(e,c)}return o}function u_(n,e,t,r,i,s){const o=h_(n,e,r,i,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),i_(o,t),s_(o,t)}function d_(n,e,t,r){const i=e._queryIdentifier,s=[];let o=[];const a=cn(n);if(i==="default")for(const[l,c]of n.views.entries())o=o.concat(th(c,t,r)),eh(c)&&(n.views.delete(l),c.query._queryParams.loadsAllData()||s.push(c.query));else{const l=n.views.get(i);l&&(o=o.concat(th(l,t,r)),eh(l)&&(n.views.delete(i),l.query._queryParams.loadsAllData()||s.push(l.query)))}return a&&!cn(n)&&s.push(new(l_())(e._repo,e._path)),{removed:s,events:o}}function ih(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function er(n,e){let t=null;for(const r of n.views.values())t=t||r_(r,e);return t}function sh(n,e){if(e._queryParams.loadsAllData())return Fi(n);{const t=e._queryIdentifier;return n.views.get(t)}}function oh(n,e){return sh(n,e)!=null}function cn(n){return Fi(n)!=null}function Fi(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let Bi;function p_(n){S(!Bi,"__referenceConstructor has already been defined"),Bi=n}function f_(){return S(Bi,"Reference.ts has not been loaded"),Bi}let m_=1;class ah{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ke(null),this.pendingWriteTree_=Wm(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function lh(n,e,t,r,i){return Rm(n.pendingWriteTree_,e,t,r,i),i?Wr(n,new Tn(qc(),e,t)):[]}function xn(n,e,t=!1){const r=Om(n.pendingWriteTree_,e);if(Dm(n.pendingWriteTree_,e)){let i=new ke(null);return r.snap!=null?i=i.set(pe(),!0):Ze(r.children,s=>{i=i.set(new me(s),!0)}),Wr(n,new Ai(r.path,i,t))}else return[]}function qi(n,e,t){return Wr(n,new Tn(Mo(),e,t))}function __(n,e,t){const r=ke.fromObject(t);return Wr(n,new qr(Mo(),e,r))}function g_(n,e){return Wr(n,new Br(Mo(),e))}function y_(n,e,t){const r=Qo(n,t);if(r){const i=Jo(r),s=i.path,o=i.queryId,a=st(s,e),l=new Br(Lo(o),a);return Xo(n,s,l)}else return[]}function Yo(n,e,t,r,i=!1){const s=e._path,o=n.syncPointTree_.get(s);let a=[];if(o&&(e._queryIdentifier==="default"||oh(o,e))){const l=d_(o,e,t,r);c_(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));const c=l.removed;if(a=l.events,!i){const h=c.findIndex(d=>d._queryParams.loadsAllData())!==-1,u=n.syncPointTree_.findOnPath(s,(d,f)=>cn(f));if(h&&!u){const d=n.syncPointTree_.subtree(s);if(!d.isEmpty()){const f=w_(d);for(let g=0;g<f.length;++g){const y=f[g],v=y.query,C=dh(n,y);n.listenProvider_.startListening(Hr(v),zi(n,v),C.hashFn,C.onComplete)}}}!u&&c.length>0&&!r&&(h?n.listenProvider_.stopListening(Hr(e),null):c.forEach(d=>{const f=n.queryToTagMap.get(Ui(d));n.listenProvider_.stopListening(Hr(d),f)}))}C_(n,c)}return a}function b_(n,e,t,r){const i=Qo(n,r);if(i!=null){const s=Jo(i),o=s.path,a=s.queryId,l=st(o,e),c=new Tn(Lo(a),l,t);return Xo(n,o,c)}else return[]}function v_(n,e,t,r){const i=Qo(n,r);if(i){const s=Jo(i),o=s.path,a=s.queryId,l=st(o,e),c=ke.fromObject(t),h=new qr(Lo(a),l,c);return Xo(n,o,h)}else return[]}function ch(n,e,t,r=!1){const i=e._path;let s=null,o=!1;n.syncPointTree_.foreachOnPath(i,(d,f)=>{const g=st(d,i);s=s||er(f,g),o=o||cn(f)});let a=n.syncPointTree_.get(i);a?(o=o||cn(a),s=s||er(a,pe())):(a=new o_,n.syncPointTree_=n.syncPointTree_.set(i,a));let l;s!=null?l=!0:(l=!1,s=M.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((d,f)=>{const g=er(f,pe());g&&(s=s.updateImmediateChild(d,g))}));const c=oh(a,e);if(!c&&!e._queryParams.loadsAllData()){const d=Ui(e);S(!n.queryToTagMap.has(d),"View does not exist, but we have a tag");const f=S_();n.queryToTagMap.set(d,f),n.tagToQueryMap.set(f,d)}const h=Uo(n.pendingWriteTree_,i);let u=u_(a,e,t,h,s,l);if(!c&&!o&&!r){const d=sh(a,e);u=u.concat(k_(n,e,d))}return u}function Ko(n,e,t){const r=n.pendingWriteTree_,i=n.syncPointTree_.findOnPath(e,(s,o)=>{const a=st(s,e),l=er(o,a);if(l)return l});return $c(r,e,i,t,!0)}function Wr(n,e){return hh(e,n.syncPointTree_,null,Uo(n.pendingWriteTree_,pe()))}function hh(n,e,t,r){if($(n.path))return uh(n,e,t,r);{const i=e.get(pe());t==null&&i!=null&&(t=er(i,pe()));let s=[];const o=H(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){const c=t?t.getImmediateChild(o):null,h=Yc(r,o);s=s.concat(hh(a,l,c,h))}return i&&(s=s.concat(Go(i,n,r,t))),s}}function uh(n,e,t,r){const i=e.get(pe());t==null&&i!=null&&(t=er(i,pe()));let s=[];return e.children.inorderTraversal((o,a)=>{const l=t?t.getImmediateChild(o):null,c=Yc(r,o),h=n.operationForChild(o);h&&(s=s.concat(uh(h,a,l,c)))}),i&&(s=s.concat(Go(i,n,r,t))),s}function dh(n,e){const t=e.query,r=zi(n,t);return{hashFn:()=>(n_(e)||M.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?y_(n,t._path,r):g_(n,t._path);{const s=yf(i,t);return Yo(n,t,null,s)}}}}function zi(n,e){const t=Ui(e);return n.queryToTagMap.get(t)}function Ui(n){return n._path.toString()+"$"+n._queryIdentifier}function Qo(n,e){return n.tagToQueryMap.get(e)}function Jo(n){const e=n.indexOf("$");return S(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new me(n.substr(0,e))}}function Xo(n,e,t){const r=n.syncPointTree_.get(e);S(r,"Missing sync point for query tag that we're tracking");const i=Uo(n.pendingWriteTree_,e);return Go(r,t,i,null)}function w_(n){return n.fold((e,t,r)=>{if(t&&cn(t))return[Fi(t)];{let i=[];return t&&(i=ih(t)),Ze(r,(s,o)=>{i=i.concat(o)}),i}})}function Hr(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(f_())(n._repo,n._path):n}function C_(n,e){for(let t=0;t<e.length;++t){const r=e[t];if(!r._queryParams.loadsAllData()){const i=Ui(r),s=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(s)}}}function S_(){return m_++}function k_(n,e,t){const r=e._path,i=zi(n,e),s=dh(n,t),o=n.listenProvider_.startListening(Hr(e),i,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(r);if(i)S(!cn(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((c,h,u)=>{if(!$(c)&&h&&cn(h))return[Fi(h).query];{let d=[];return h&&(d=d.concat(ih(h).map(f=>f.query))),Ze(u,(f,g)=>{d=d.concat(g)}),d}});for(let c=0;c<l.length;++c){const h=l[c];n.listenProvider_.stopListening(Hr(h),zi(n,h))}}return o}class Zo{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Zo(t)}node(){return this.node_}}class ea{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Fe(this.path_,e);return new ea(this.syncTree_,t)}node(){return Ko(this.syncTree_,this.path_)}}const T_=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},ph=function(n,e,t){if(!n||typeof n!="object")return n;if(S(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return E_(n[".sv"],e,t);if(typeof n[".sv"]=="object")return I_(n[".sv"],e);S(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},E_=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:S(!1,"Unexpected server value: "+n)}},I_=function(n,e,t){n.hasOwnProperty("increment")||S(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const r=n.increment;typeof r!="number"&&S(!1,"Unexpected increment value: "+r);const i=e.node();if(S(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const s=i.getValue();return typeof s!="number"?r:s+r},N_=function(n,e,t,r){return ta(e,new ea(t,n),r)},fh=function(n,e,t){return ta(n,new Zo(e),t)};function ta(n,e,t){const r=n.getPriority().val(),i=ph(r,e.getImmediateChild(".priority"),t);let s;if(n.isLeafNode()){const o=n,a=ph(o.getValue(),e,t);return a!==o.getValue()||i!==o.getPriority().val()?new Ve(a,Be(i)):n}else{const o=n;return s=o,i!==o.getPriority().val()&&(s=s.updatePriority(new Ve(i))),o.forEachChild(Ae,(a,l)=>{const c=ta(l,e.getImmediateChild(a),t);c!==l&&(s=s.updateImmediateChild(a,c))}),s}}class na{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function ra(n,e){let t=e instanceof me?e:new me(e),r=n,i=H(t);for(;i!==null;){const s=Un(r.node.children,i)||{children:{},childCount:0};r=new na(i,r,s),t=be(t),i=H(t)}return r}function tr(n){return n.node.value}function mh(n,e){n.node.value=e,ia(n)}function _h(n){return n.node.childCount>0}function x_(n){return tr(n)===void 0&&!_h(n)}function ji(n,e){Ze(n.node.children,(t,r)=>{e(new na(t,n,r))})}function gh(n,e,t,r){t&&!r&&e(n),ji(n,i=>{gh(i,e,!0,r)}),t&&r&&e(n)}function P_(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function Vr(n){return new me(n.parent===null?n.name:Vr(n.parent)+"/"+n.name)}function ia(n){n.parent!==null&&A_(n.parent,n.name,n)}function A_(n,e,t){const r=x_(t),i=xt(n.node.children,e);r&&i?(delete n.node.children[e],n.node.childCount--,ia(n)):!r&&!i&&(n.node.children[e]=t.node,n.node.childCount++,ia(n))}const R_=/[\[\].#$\/\u0000-\u001F\u007F]/,O_=/[\[\].#$\u0000-\u001F\u007F]/,sa=10*1024*1024,oa=function(n){return typeof n=="string"&&n.length!==0&&!R_.test(n)},yh=function(n){return typeof n=="string"&&n.length!==0&&!O_.test(n)},D_=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),yh(n)},bh=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Ci(n)||n&&typeof n=="object"&&xt(n,".sv")},Wi=function(n,e,t,r){r&&e===void 0||Hi(jn(n,"value"),e,t)},Hi=function(n,e,t){const r=t instanceof me?new Xf(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+kn(r));if(typeof e=="function")throw new Error(n+"contains a function "+kn(r)+" with contents = "+e.toString());if(Ci(e))throw new Error(n+"contains "+e.toString()+" "+kn(r));if(typeof e=="string"&&e.length>sa/3&&bi(e)>sa)throw new Error(n+"contains a string greater than "+sa+" utf8 bytes "+kn(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,s=!1;if(Ze(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!oa(o)))throw new Error(n+" contains an invalid key ("+o+") "+kn(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Zf(r,o),Hi(n,a,r),em(r)}),i&&s)throw new Error(n+' contains ".value" child '+kn(r)+" in addition to actual children.")}},M_=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];const s=Ar(r);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)&&!oa(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}e.sort(Jf);let i=null;for(t=0;t<e.length;t++){if(r=e[t],i!==null&&dt(i,r))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},L_=function(n,e,t,r){if(r&&e===void 0)return;const i=jn(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");const s=[];Ze(e,(o,a)=>{const l=new me(o);if(Hi(i,a,Fe(t,l)),To(l)===".priority"&&!bh(a))throw new Error(i+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(l)}),M_(i,s)},F_=function(n,e,t){if(!(t&&e===void 0)){if(Ci(e))throw new Error(jn(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!bh(e))throw new Error(jn(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},vh=function(n,e,t,r){if(!(r&&t===void 0)&&!yh(t))throw new Error(jn(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},B_=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),vh(n,e,t,r)},Pn=function(n,e){if(H(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},q_=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!oa(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!D_(t))throw new Error(jn(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class z_{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function aa(n,e){let t=null;for(let r=0;r<e.length;r++){const i=e[r],s=i.getPath();t!==null&&!Eo(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(i)}t&&n.eventLists_.push(t)}function wh(n,e,t){aa(n,t),Ch(n,r=>Eo(r,e))}function $t(n,e,t){aa(n,t),Ch(n,r=>dt(r,e)||dt(e,r))}function Ch(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){const i=n.eventLists_[r];if(i){const s=i.path;e(s)?(U_(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function U_(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const r=t.getEventRunner();wn&&Ke("event: "+t.toString()),$n(r)}}}const j_="repo_interrupt",W_=25;class H_{constructor(e,t,r,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new z_,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Pi(),this.transactionQueueTree_=new na,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function V_(n,e,t){if(n.stats_=Co(n.repoInfo_),n.forceRestClient_||Cf())n.server_=new xi(n.repoInfo_,(r,i,s,o)=>{kh(n,r,i,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Th(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{We(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new Ht(n.repoInfo_,e,(r,i,s,o)=>{kh(n,r,i,s,o)},r=>{Th(n,r)},r=>{$_(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=If(n.repoInfo_,()=>new Em(n.stats_,n.server_)),n.infoData_=new wm,n.infoSyncTree_=new ah({startListening:(r,i,s,o)=>{let a=[];const l=n.infoData_.getNode(r._path);return l.isEmpty()||(a=qi(n.infoSyncTree_,r._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),ca(n,"connected",!1),n.serverSyncTree_=new ah({startListening:(r,i,s,o)=>(n.server_.listen(r,s,i,(a,l)=>{const c=o(a,l);$t(n.eventQueue_,r._path,c)}),[]),stopListening:(r,i)=>{n.server_.unlisten(r,i)}})}function Sh(n){const e=n.infoData_.getNode(new me(".info/serverTimeOffset")).val()||0;return new Date().getTime()+e}function la(n){return T_({timestamp:Sh(n)})}function kh(n,e,t,r,i){n.dataUpdateCount++;const s=new me(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(r){const l=yi(t,c=>Be(c));o=v_(n.serverSyncTree_,s,l,i)}else{const l=Be(t);o=b_(n.serverSyncTree_,s,l,i)}else if(r){const l=yi(t,c=>Be(c));o=__(n.serverSyncTree_,s,l)}else{const l=Be(t);o=qi(n.serverSyncTree_,s,l)}let a=s;o.length>0&&(a=Vi(n,s)),$t(n.eventQueue_,a,o)}function Th(n,e){ca(n,"connected",e),e===!1&&Y_(n)}function $_(n,e){Ze(e,(t,r)=>{ca(n,t,r)})}function ca(n,e,t){const r=new me("/.info/"+e),i=Be(t);n.infoData_.updateSnapshot(r,i);const s=qi(n.infoSyncTree_,r,i);$t(n.eventQueue_,r,s)}function Eh(n){return n.nextWriteId_++}function G_(n,e,t,r,i){ua(n,"set",{path:e.toString(),value:t,priority:r});const s=la(n),o=Be(t,r),a=Ko(n.serverSyncTree_,e),l=fh(o,a,s),c=Eh(n),h=lh(n.serverSyncTree_,e,l,c,!0);aa(n.eventQueue_,h),n.server_.put(e.toString(),o.val(!0),(d,f)=>{const g=d==="ok";g||it("set at "+e+" failed: "+d);const y=xn(n.serverSyncTree_,c,!g);$t(n.eventQueue_,e,y),nr(n,i,d,f)});const u=Rh(n,e);Vi(n,u),$t(n.eventQueue_,u,[])}function Y_(n){ua(n,"onDisconnectEvents");const e=la(n),t=Pi();Do(n.onDisconnect_,pe(),(i,s)=>{const o=N_(i,s,n.serverSyncTree_,e);Xn(t,i,o)});let r=[];Do(t,pe(),(i,s)=>{r=r.concat(qi(n.serverSyncTree_,i,s));const o=Rh(n,i);Vi(n,o)}),n.onDisconnect_=Pi(),$t(n.eventQueue_,pe(),r)}function K_(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,i)=>{r==="ok"&&Oo(n.onDisconnect_,e),nr(n,t,r,i)})}function Ih(n,e,t,r){const i=Be(t);n.server_.onDisconnectPut(e.toString(),i.val(!0),(s,o)=>{s==="ok"&&Xn(n.onDisconnect_,e,i),nr(n,r,s,o)})}function Q_(n,e,t,r,i){const s=Be(t,r);n.server_.onDisconnectPut(e.toString(),s.val(!0),(o,a)=>{o==="ok"&&Xn(n.onDisconnect_,e,s),nr(n,i,o,a)})}function J_(n,e,t,r){if(no(t)){Ke("onDisconnect().update() called with empty data.  Don't do anything."),nr(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(i,s)=>{i==="ok"&&Ze(t,(o,a)=>{const l=Be(a);Xn(n.onDisconnect_,Fe(e,o),l)}),nr(n,r,i,s)})}function X_(n,e,t){let r;H(e._path)===".info"?r=ch(n.infoSyncTree_,e,t):r=ch(n.serverSyncTree_,e,t),wh(n.eventQueue_,e._path,r)}function ha(n,e,t){let r;H(e._path)===".info"?r=Yo(n.infoSyncTree_,e,t):r=Yo(n.serverSyncTree_,e,t),wh(n.eventQueue_,e._path,r)}function Z_(n){n.persistentConnection_&&n.persistentConnection_.interrupt(j_)}function ua(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Ke(t,...e)}function nr(n,e,t,r){e&&$n(()=>{if(t==="ok")e(null);else{const i=(t||"error").toUpperCase();let s=i;r&&(s+=": "+r);const o=new Error(s);o.code=i,e(o)}})}function Nh(n,e,t){return Ko(n.serverSyncTree_,e,t)||M.EMPTY_NODE}function da(n,e=n.transactionQueueTree_){if(e||$i(n,e),tr(e)){const t=Ph(n,e);S(t.length>0,"Sending zero length transaction queue"),t.every(r=>r.status===0)&&eg(n,Vr(e),t)}else _h(e)&&ji(e,t=>{da(n,t)})}function eg(n,e,t){const r=t.map(c=>c.currentWriteId),i=Nh(n,e,r);let s=i;const o=i.hash();for(let c=0;c<t.length;c++){const h=t[c];S(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const u=st(e,h.path);s=s.updateChild(u,h.currentOutputSnapshotRaw)}const a=s.val(!0),l=e;n.server_.put(l.toString(),a,c=>{ua(n,"transaction put response",{path:l.toString(),status:c});let h=[];if(c==="ok"){const u=[];for(let d=0;d<t.length;d++)t[d].status=2,h=h.concat(xn(n.serverSyncTree_,t[d].currentWriteId)),t[d].onComplete&&u.push(()=>t[d].onComplete(null,!0,t[d].currentOutputSnapshotResolved)),t[d].unwatcher();$i(n,ra(n.transactionQueueTree_,e)),da(n,n.transactionQueueTree_),$t(n.eventQueue_,e,h);for(let d=0;d<u.length;d++)$n(u[d])}else{if(c==="datastale")for(let u=0;u<t.length;u++)t[u].status===3?t[u].status=4:t[u].status=0;else{it("transaction at "+l.toString()+" failed: "+c);for(let u=0;u<t.length;u++)t[u].status=4,t[u].abortReason=c}Vi(n,e)}},o)}function Vi(n,e){const t=xh(n,e),r=Vr(t),i=Ph(n,t);return tg(n,i,r),r}function tg(n,e,t){if(e.length===0)return;const r=[];let i=[];const s=e.filter(o=>o.status===0).map(o=>o.currentWriteId);for(let o=0;o<e.length;o++){const a=e[o],l=st(t,a.path);let c=!1,h;if(S(l!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),a.status===4)c=!0,h=a.abortReason,i=i.concat(xn(n.serverSyncTree_,a.currentWriteId,!0));else if(a.status===0)if(a.retryCount>=W_)c=!0,h="maxretry",i=i.concat(xn(n.serverSyncTree_,a.currentWriteId,!0));else{const u=Nh(n,a.path,s);a.currentInputSnapshot=u;const d=e[o].update(u.val());if(d!==void 0){Hi("transaction failed: Data returned ",d,a.path);let f=Be(d);typeof d=="object"&&d!=null&&xt(d,".priority")||(f=f.updatePriority(u.getPriority()));const g=a.currentWriteId,y=la(n),v=fh(f,u,y);a.currentOutputSnapshotRaw=f,a.currentOutputSnapshotResolved=v,a.currentWriteId=Eh(n),s.splice(s.indexOf(g),1),i=i.concat(lh(n.serverSyncTree_,a.path,v,a.currentWriteId,a.applyLocally)),i=i.concat(xn(n.serverSyncTree_,g,!0))}else c=!0,h="nodata",i=i.concat(xn(n.serverSyncTree_,a.currentWriteId,!0))}$t(n.eventQueue_,t,i),i=[],c&&(e[o].status=2,function(u){setTimeout(u,Math.floor(0))}(e[o].unwatcher),e[o].onComplete&&(h==="nodata"?r.push(()=>e[o].onComplete(null,!1,e[o].currentInputSnapshot)):r.push(()=>e[o].onComplete(new Error(h),!1,null))))}$i(n,n.transactionQueueTree_);for(let o=0;o<r.length;o++)$n(r[o]);da(n,n.transactionQueueTree_)}function xh(n,e){let t,r=n.transactionQueueTree_;for(t=H(e);t!==null&&tr(r)===void 0;)r=ra(r,t),e=be(e),t=H(e);return r}function Ph(n,e){const t=[];return Ah(n,e,t),t.sort((r,i)=>r.order-i.order),t}function Ah(n,e,t){const r=tr(e);if(r)for(let i=0;i<r.length;i++)t.push(r[i]);ji(e,i=>{Ah(n,i,t)})}function $i(n,e){const t=tr(e);if(t){let r=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[r]=t[i],r++);t.length=r,mh(e,t.length>0?t:void 0)}ji(e,r=>{$i(n,r)})}function Rh(n,e){const t=Vr(xh(n,e)),r=ra(n.transactionQueueTree_,e);return P_(r,i=>{pa(n,i)}),pa(n,r),gh(r,i=>{pa(n,i)}),t}function pa(n,e){const t=tr(e);if(t){const r=[];let i=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(S(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(S(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(xn(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?mh(e,void 0):t.length=s+1,$t(n.eventQueue_,Vr(e),i);for(let o=0;o<r.length;o++)$n(r[o])}}function ng(n){let e="";const t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let i=t[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function rg(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):it(`Invalid query segment '${t}' in query '${n}'`)}return e}const Oh=function(n,e){const t=ig(n),r=t.namespace;t.domain==="firebase.com"&&Wt(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&Wt("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||pf();const i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new ac(t.host,t.secure,r,i,e,"",r!==t.subdomain),path:new me(t.pathString)}},ig=function(n){let e="",t="",r="",i="",s="",o=!0,a="https",l=443;if(typeof n=="string"){let c=n.indexOf("//");c>=0&&(a=n.substring(0,c-1),n=n.substring(c+2));let h=n.indexOf("/");h===-1&&(h=n.length);let u=n.indexOf("?");u===-1&&(u=n.length),e=n.substring(0,Math.min(h,u)),h<u&&(i=ng(n.substring(h,u)));const d=rg(n.substring(Math.min(n.length,u)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;const f=e.slice(0,c);if(f.toLowerCase()==="localhost")t="localhost";else if(f.split(".").length<=2)t=f;else{const g=e.indexOf(".");r=e.substring(0,g).toLowerCase(),t=e.substring(g+1),s=r}"ns"in d&&(s=d.ns)}return{host:e,port:l,domain:t,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}},Dh="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",sg=function(){let n=0;const e=[];return function(t){const r=t===n;n=t;let i;const s=new Array(8);for(i=7;i>=0;i--)s[i]=Dh.charAt(t%64),t=Math.floor(t/64);S(t===0,"Cannot push at time == 0");let o=s.join("");if(r){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=Dh.charAt(e[i]);return S(o.length===20,"nextPushId: Length should be 20."),o}}();class Mh{constructor(e,t,r,i){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=i}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+We(this.snapshot.exportVal())}}class Lh{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Fh{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return S(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class og{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new jt;return K_(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Pn("OnDisconnect.remove",this._path);const e=new jt;return Ih(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Pn("OnDisconnect.set",this._path),Wi("OnDisconnect.set",e,this._path,!1);const t=new jt;return Ih(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Pn("OnDisconnect.setWithPriority",this._path),Wi("OnDisconnect.setWithPriority",e,this._path,!1),F_("OnDisconnect.setWithPriority",t,!1);const r=new jt;return Q_(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){Pn("OnDisconnect.update",this._path),L_("OnDisconnect.update",e,this._path,!1);const t=new jt;return J_(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class fa{constructor(e,t,r,i){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=i}get key(){return $(this._path)?null:To(this._path)}get ref(){return new Gt(this._repo,this._path)}get _queryIdentifier(){const e=Fc(this._queryParams),t=go(e);return t==="{}"?"default":t}get _queryObject(){return Fc(this._queryParams)}isEqual(e){if(e=gn(e),!(e instanceof fa))return!1;const t=this._repo===e._repo,r=Eo(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+Qf(this._path)}}class Gt extends fa{constructor(e,t){super(e,t,new Ro,!1)}get parent(){const e=Tc(this._path);return e===null?null:new Gt(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class $r{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new me(e),r=An(this.ref,e);return new $r(this._node.getChild(t),r,Ae)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(t,r)=>e(new $r(r,An(this.ref,t),Ae)))}hasChild(e){const t=new me(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Bh(n,e){return n=gn(n),n._checkNotDeleted("ref"),e!==void 0?An(n._root,e):n._root}function An(n,e){return n=gn(n),H(n._path)===null?B_("child","path",e,!1):vh("child","path",e,!1),new Gt(n._repo,Fe(n._path,e))}function qh(n){return n=gn(n),new og(n._repo,n._path)}function ag(n,e){n=gn(n),Pn("push",n._path),Wi("push",e,n._path,!0);const t=Sh(n._repo),r=sg(t),i=An(n,r),s=An(n,r);let o;return e!=null?o=Gi(s,e).then(()=>s):o=Promise.resolve(s),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function zh(n){return Pn("remove",n._path),Gi(n,null)}function Gi(n,e){n=gn(n),Pn("set",n._path),Wi("set",e,n._path,!1);const t=new jt;return G_(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}class Yi{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const r=t._queryParams.getIndex();return new Mh("value",this,new $r(e.snapshotNode,new Gt(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Lh(this,e,t):null}matches(e){return e instanceof Yi?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class Ki{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Lh(this,e,t):null}createEvent(e,t){S(e.childName!=null,"Child events should have a childName.");const r=An(new Gt(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new Mh(e.type,this,new $r(e.snapshotNode,r,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Ki?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function Uh(n,e,t,r,i){let s;if(typeof r=="object"&&(s=void 0,i=r),typeof r=="function"&&(s=r),i&&i.onlyOnce){const l=t,c=(h,u)=>{ha(n._repo,n,a),l(h,u)};c.userCallback=t.userCallback,c.context=t.context,t=c}const o=new Fh(t,s||void 0),a=e==="value"?new Yi(o):new Ki(e,o);return X_(n._repo,n,a),()=>ha(n._repo,n,a)}function lg(n,e,t,r){return Uh(n,"value",e,t,r)}function ma(n,e,t,r){return Uh(n,"child_added",e,t,r)}function jh(n,e,t){let r=null;const i=t?new Fh(t):null;e==="value"?r=new Yi(i):e&&(r=new Ki(e,i)),ha(n._repo,n,r)}a_(Gt),p_(Gt);const cg="FIREBASE_DATABASE_EMULATOR_HOST",_a={};let hg=!1;function ug(n,e,t,r){n.repoInfo_=new ac(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),r&&(n.authTokenProvider_=r)}function dg(n,e,t,r,i){let s=r||n.options.databaseURL;s===void 0&&(n.options.projectId||Wt("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Ke("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=Oh(s,i),a=o.repoInfo,l,c;typeof process<"u"&&process.env&&(c=process.env[cg]),c?(l=!0,s=`http://${c}?ns=${a.namespace}`,o=Oh(s,i),a=o.repoInfo):l=!o.repoInfo.secure;const h=i&&l?new Gn(Gn.OWNER):new kf(n.name,n.options,e);q_("Invalid Firebase Database URL",o),$(o.path)||Wt("Database URL must point to the root of a Firebase Database (not including a child path).");const u=fg(a,n,h,new Sf(n.name,t));return new mg(u,n)}function pg(n,e){const t=_a[e];(!t||t[n.key]!==n)&&Wt(`Database ${e}(${n.repoInfo_}) has already been deleted.`),Z_(n),delete t[n.key]}function fg(n,e,t,r){let i=_a[e.name];i||(i={},_a[e.name]=i);let s=i[n.toURLString()];return s&&Wt("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new H_(n,hg,t,r),i[n.toURLString()]=s,s}class mg{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(V_(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Gt(this._repo,pe())),this._rootInternal}_delete(){return this._rootInternal!==null&&(pg(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Wt("Cannot call "+e+" on a deleted database.")}}function Wh(n=Kp(),e){const t=Vp(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const r=Fd("database");r&&_g(t,...r)}return t}function _g(n,e,t,r={}){n=gn(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&Wt("Cannot call useEmulator() after instance has already been initialized.");const i=n._repoInternal;let s;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&Wt('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new Gn(Gn.OWNER);else if(r.mockUserToken){const o=typeof r.mockUserToken=="string"?r.mockUserToken:Bd(r.mockUserToken,n.app.options.projectId);s=new Gn(o)}ug(i,e,t,s)}function gg(n){lf(Yp),wi(new kr("database",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return dg(r,i,s,t)},"PUBLIC").setMultipleInstances(!0)),Wn(Wl,Hl,n),Wn(Wl,Hl,"esm2017")}Ht.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)},Ht.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)},gg();const yg=new TextEncoder,bg=new TextDecoder,Rn=n=>yg.encode(n),On=n=>bg.decode(n),ga="AES-GCM",vg=16,wg=n=>btoa(String.fromCodePoint(...new Uint8Array(n))),Cg=n=>{const e=window.atob(n);return new Uint8Array(e.length).map((t,r)=>e.codePointAt(r)).buffer},Sg=async n=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},n),{name:ga},!1,["encrypt","decrypt"]),Hh=async(n,e)=>Sg(Rn(`${n}:${e}`)),ya=async(n,e)=>{const t=crypto.getRandomValues(new Uint8Array(vg));return crypto.subtle.encrypt({name:ga,iv:t},await n,Rn(e)).then(r=>JSON.stringify({c:wg(r),iv:[...t]}))},ba=async(n,e)=>{const{c:t,iv:r}=e,i=await n;return crypto.subtle.decrypt({name:ga,iv:new Uint8Array(r)},i,Cg(t)).then(s=>On(s))},kg="/projects/paracord/assets/pqc_kyber_bg-3b9c9656.wasm",Tg=async(n={},e)=>{let t;if(e.startsWith("data:")){const r=e.replace(/^data:.*?base64,/,"");let i;if(typeof Buffer=="function"&&typeof Buffer.from=="function")i=Buffer.from(r,"base64");else if(typeof atob=="function"){const s=atob(r);i=new Uint8Array(s.length);for(let o=0;o<s.length;o++)i[o]=s.charCodeAt(o)}else throw new Error("Cannot decode base64-encoded data URL");t=await WebAssembly.instantiate(i,n)}else{const r=await fetch(e),i=r.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&i.startsWith("application/wasm"))t=await WebAssembly.instantiateStreaming(r,n);else{const s=await r.arrayBuffer();t=await WebAssembly.instantiate(s,n)}}return t.instance.exports};let F;function Eg(n){F=n}const Yt=new Array(128).fill(void 0);Yt.push(void 0,null,!0,!1);function Ce(n){return Yt[n]}let Gr=Yt.length;function Ig(n){n<132||(Yt[n]=Gr,Gr=n)}function rr(n){const e=Ce(n);return Ig(n),e}const Ng=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder;let Vh=new Ng("utf-8",{ignoreBOM:!0,fatal:!0});Vh.decode();let Qi=null;function ir(){return(Qi===null||Qi.byteLength===0)&&(Qi=new Uint8Array(F.memory.buffer)),Qi}function Ji(n,e){return n=n>>>0,Vh.decode(ir().subarray(n,n+e))}function Re(n){Gr===Yt.length&&Yt.push(Yt.length+1);const e=Gr;return Gr=Yt[e],Yt[e]=n,e}function va(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const i=n.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=n.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(n)){const i=n.length;let s="[";i>0&&(s+=va(n[0]));for(let o=1;o<i;o++)s+=", "+va(n[o]);return s+="]",s}const t=/\[object ([^\]]+)\]/.exec(toString.call(n));let r;if(t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}let Pt=0;const xg=typeof TextEncoder>"u"?(0,module.require)("util").TextEncoder:TextEncoder;let Xi=new xg("utf-8");const Pg=typeof Xi.encodeInto=="function"?function(n,e){return Xi.encodeInto(n,e)}:function(n,e){const t=Xi.encode(n);return e.set(t),{read:n.length,written:t.length}};function Ag(n,e,t){if(t===void 0){const a=Xi.encode(n),l=e(a.length,1)>>>0;return ir().subarray(l,l+a.length).set(a),Pt=a.length,l}let r=n.length,i=e(r,1)>>>0;const s=ir();let o=0;for(;o<r;o++){const a=n.charCodeAt(o);if(a>127)break;s[i+o]=a}if(o!==r){o!==0&&(n=n.slice(o)),i=t(i,r,r=o+n.length*3,1)>>>0;const a=ir().subarray(i+o,i+r),l=Pg(n,a);o+=l.written}return Pt=o,i}let Zi=null;function Oe(){return(Zi===null||Zi.byteLength===0)&&(Zi=new Int32Array(F.memory.buffer)),Zi}function Rg(){try{const r=F.__wbindgen_add_to_stack_pointer(-16);F.keypair(r);var n=Oe()[r/4+0],e=Oe()[r/4+1],t=Oe()[r/4+2];if(t)throw rr(e);return ts.__wrap(n)}finally{F.__wbindgen_add_to_stack_pointer(16)}}function sr(n,e){const t=e(n.length*1,1)>>>0;return ir().set(n,t/1),Pt=n.length,t}function Og(n){try{const i=F.__wbindgen_add_to_stack_pointer(-16),s=sr(n,F.__wbindgen_malloc),o=Pt;F.encapsulate(i,s,o);var e=Oe()[i/4+0],t=Oe()[i/4+1],r=Oe()[i/4+2];if(r)throw rr(t);return es.__wrap(e)}finally{F.__wbindgen_add_to_stack_pointer(16)}}function Yr(n,e){return n=n>>>0,ir().subarray(n/1,n/1+e)}function Dg(n,e){try{const a=F.__wbindgen_add_to_stack_pointer(-16),l=sr(n,F.__wbindgen_malloc),c=Pt,h=sr(e,F.__wbindgen_malloc),u=Pt;F.decapsulate(a,l,c,h,u);var t=Oe()[a/4+0],r=Oe()[a/4+1],i=Oe()[a/4+2],s=Oe()[a/4+3];if(s)throw rr(i);var o=Yr(t,r).slice();return F.__wbindgen_free(t,r*1),o}finally{F.__wbindgen_add_to_stack_pointer(16)}}function Kt(n,e){try{return n.apply(this,e)}catch(t){F.__wbindgen_exn_store(Re(t))}}class es{static __wrap(e){e=e>>>0;const t=Object.create(es.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();F.__wbg_kex_free(e)}constructor(e){const t=sr(e,F.__wbindgen_malloc),r=Pt,i=F.kex_new(t,r);return es.__wrap(i)}get ciphertext(){try{const i=F.__wbindgen_add_to_stack_pointer(-16);F.kex_ciphertext(i,this.__wbg_ptr);var e=Oe()[i/4+0],t=Oe()[i/4+1],r=Yr(e,t).slice();return F.__wbindgen_free(e,t*1),r}finally{F.__wbindgen_add_to_stack_pointer(16)}}get sharedSecret(){try{const i=F.__wbindgen_add_to_stack_pointer(-16);F.kex_sharedSecret(i,this.__wbg_ptr);var e=Oe()[i/4+0],t=Oe()[i/4+1],r=Yr(e,t).slice();return F.__wbindgen_free(e,t*1),r}finally{F.__wbindgen_add_to_stack_pointer(16)}}set ciphertext(e){const t=sr(e,F.__wbindgen_malloc),r=Pt;F.kex_set_ciphertext(this.__wbg_ptr,t,r)}set sharedSecret(e){const t=sr(e,F.__wbindgen_malloc),r=Pt;F.kex_set_sharedSecret(this.__wbg_ptr,t,r)}}class ts{static __wrap(e){e=e>>>0;const t=Object.create(ts.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();F.__wbg_keys_free(e)}constructor(){try{const i=F.__wbindgen_add_to_stack_pointer(-16);F.keypair(i);var e=Oe()[i/4+0],t=Oe()[i/4+1],r=Oe()[i/4+2];if(r)throw rr(t);return ts.__wrap(e)}finally{F.__wbindgen_add_to_stack_pointer(16)}}get pubkey(){try{const i=F.__wbindgen_add_to_stack_pointer(-16);F.kex_ciphertext(i,this.__wbg_ptr);var e=Oe()[i/4+0],t=Oe()[i/4+1],r=Yr(e,t).slice();return F.__wbindgen_free(e,t*1),r}finally{F.__wbindgen_add_to_stack_pointer(16)}}get secret(){try{const i=F.__wbindgen_add_to_stack_pointer(-16);F.kex_sharedSecret(i,this.__wbg_ptr);var e=Oe()[i/4+0],t=Oe()[i/4+1],r=Yr(e,t).slice();return F.__wbindgen_free(e,t*1),r}finally{F.__wbindgen_add_to_stack_pointer(16)}}}function Mg(n){rr(n)}function Lg(n,e){const t=new Error(Ji(n,e));return Re(t)}function Fg(n){const e=Ce(n).crypto;return Re(e)}function Bg(n){const e=Ce(n);return typeof e=="object"&&e!==null}function qg(n){const e=Ce(n).process;return Re(e)}function zg(n){const e=Ce(n).versions;return Re(e)}function Ug(n){const e=Ce(n).node;return Re(e)}function jg(n){return typeof Ce(n)=="string"}function Wg(n){const e=Ce(n).msCrypto;return Re(e)}function Hg(){return Kt(function(){const n=module.require;return Re(n)},arguments)}function Vg(n){return typeof Ce(n)=="function"}function $g(n,e){const t=Ji(n,e);return Re(t)}function Gg(){return Kt(function(n,e){Ce(n).getRandomValues(Ce(e))},arguments)}function Yg(){return Kt(function(n,e){Ce(n).randomFillSync(rr(e))},arguments)}function Kg(n,e){const t=new Function(Ji(n,e));return Re(t)}function Qg(){return Kt(function(n,e){const t=Ce(n).call(Ce(e));return Re(t)},arguments)}function Jg(n){const e=Ce(n);return Re(e)}function Xg(){return Kt(function(){const n=self.self;return Re(n)},arguments)}function Zg(){return Kt(function(){const n=window.window;return Re(n)},arguments)}function ey(){return Kt(function(){const n=globalThis.globalThis;return Re(n)},arguments)}function ty(){return Kt(function(){const n=global.global;return Re(n)},arguments)}function ny(n){return Ce(n)===void 0}function ry(){return Kt(function(n,e,t){const r=Ce(n).call(Ce(e),Ce(t));return Re(r)},arguments)}function iy(n){const e=Ce(n).buffer;return Re(e)}function sy(n,e,t){const r=new Uint8Array(Ce(n),e>>>0,t>>>0);return Re(r)}function oy(n){const e=new Uint8Array(Ce(n));return Re(e)}function ay(n,e,t){Ce(n).set(Ce(e),t>>>0)}function ly(n){const e=new Uint8Array(n>>>0);return Re(e)}function cy(n,e,t){const r=Ce(n).subarray(e>>>0,t>>>0);return Re(r)}function hy(n,e){const t=va(Ce(e)),r=Ag(t,F.__wbindgen_malloc,F.__wbindgen_realloc),i=Pt;Oe()[n/4+1]=i,Oe()[n/4+0]=r}function uy(n,e){throw new Error(Ji(n,e))}function dy(){const n=F.memory;return Re(n)}URL=globalThis.URL;const _e=await Tg({"./pqc_kyber_bg.js":{__wbindgen_object_drop_ref:Mg,__wbindgen_error_new:Lg,__wbg_crypto_c48a774b022d20ac:Fg,__wbindgen_is_object:Bg,__wbg_process_298734cf255a885d:qg,__wbg_versions_e2e78e134e3e5d01:zg,__wbg_node_1cd7a5d853dbea79:Ug,__wbindgen_is_string:jg,__wbg_msCrypto_bcb970640f50a1e8:Wg,__wbg_require_8f08ceecec0f4fee:Hg,__wbindgen_is_function:Vg,__wbindgen_string_new:$g,__wbg_getRandomValues_37fa2ca9e4e07fab:Gg,__wbg_randomFillSync_dc1e9a60c158336d:Yg,__wbg_newnoargs_2b8b6bd7753c76ba:Kg,__wbg_call_95d1ea488d03e4e8:Qg,__wbindgen_object_clone_ref:Jg,__wbg_self_e7c1f827057f6584:Xg,__wbg_window_a09ec664e14b1b81:Zg,__wbg_globalThis_87cbb8506fecf3a9:ey,__wbg_global_c85a9259e621f3db:ty,__wbindgen_is_undefined:ny,__wbg_call_9495de66fdbe016b:ry,__wbg_buffer_cf65c07de34b9a08:iy,__wbg_newwithbyteoffsetandlength_9fb2f11355ecadf5:sy,__wbg_new_537b7341ce90bb31:oy,__wbg_set_17499e8aa4003ebd:ay,__wbg_newwithlength_b56c882b57805732:ly,__wbg_subarray_7526649b91a252a6:cy,__wbindgen_debug_string:hy,__wbindgen_throw:uy,__wbindgen_memory:dy}},kg),py=_e.memory,fy=_e.keypair,my=_e.encapsulate,_y=_e.decapsulate,gy=_e.__wbg_kex_free,yy=_e.kex_new,by=_e.kex_ciphertext,vy=_e.kex_sharedSecret,wy=_e.kex_set_ciphertext,Cy=_e.kex_set_sharedSecret,Sy=_e.__wbg_params_free,ky=_e.__wbg_get_params_publicKeyBytes,Ty=_e.__wbg_get_params_secretKeyBytes,Ey=_e.__wbg_get_params_ciphertextBytes,Iy=_e.__wbg_get_params_sharedSecretBytes,Ny=_e.__wbg_keys_free,xy=_e.keys_pubkey,Py=_e.keys_secret,Ay=_e.keys_new,Ry=_e.params_publicKeyBytes,Oy=_e.params_secretKeyBytes,Dy=_e.params_ciphertextBytes,My=_e.params_sharedSecretBytes,Ly=_e.__wbindgen_malloc,Fy=_e.__wbindgen_realloc,By=_e.__wbindgen_add_to_stack_pointer,qy=_e.__wbindgen_free,zy=_e.__wbindgen_exn_store,Uy=Object.freeze(Object.defineProperty({__proto__:null,__wbg_get_params_ciphertextBytes:Ey,__wbg_get_params_publicKeyBytes:ky,__wbg_get_params_secretKeyBytes:Ty,__wbg_get_params_sharedSecretBytes:Iy,__wbg_kex_free:gy,__wbg_keys_free:Ny,__wbg_params_free:Sy,__wbindgen_add_to_stack_pointer:By,__wbindgen_exn_store:zy,__wbindgen_free:qy,__wbindgen_malloc:Ly,__wbindgen_realloc:Fy,decapsulate:_y,encapsulate:my,kex_ciphertext:by,kex_new:yy,kex_set_ciphertext:wy,kex_set_sharedSecret:Cy,kex_sharedSecret:vy,keypair:fy,keys_new:Ay,keys_pubkey:xy,keys_secret:Py,memory:py,params_ciphertextBytes:Dy,params_publicKeyBytes:Ry,params_secretKeyBytes:Oy,params_sharedSecretBytes:My},Symbol.toStringTag,{value:"Module"}));Eg(Uy);const $h=()=>{const n=Rg();return{publicKey:n.pubkey,privateKey:n.secret}},wa="AES-GCM",Ca=12,Kr=16,Gh=n=>window.crypto.subtle.importKey("raw",n,"PBKDF2",!1,["deriveKey"]),Yh=(n,e,t)=>window.crypto.subtle.deriveKey({name:"PBKDF2",salt:e,iterations:25e4,hash:"SHA-256"},n,{name:wa,length:256},!1,t);function Kh(n,e){const t=On(n),r=window.crypto.getRandomValues(new Uint8Array(Kr));return Gh(e).then(i=>{const s=window.crypto.getRandomValues(new Uint8Array(Ca));return Yh(i,r,["encrypt"]).then(o=>window.crypto.subtle.encrypt({name:wa,iv:s},o,Rn(t))).then(o=>{const a=new Uint8Array(o),l=new Uint8Array(r.byteLength+s.byteLength+a.byteLength);return l.set(r,0),l.set(s,r.byteLength),l.set(a,r.byteLength+s.byteLength),l})}).catch(i=>{throw console.error(i),i})}function Qh(n,e){const t=n.slice(0,Kr),r=new Uint8Array(n.slice(Kr,Kr+Ca)),i=n.slice(Kr+Ca);return Gh(e).then(s=>Yh(s,t,["decrypt"])).then(s=>window.crypto.subtle.decrypt({name:wa,iv:r},s,i)).then(s=>new Uint8Array(s)).catch(s=>{throw console.error(s),s})}const At=[..."ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"],ns=Array.from({length:256},()=>255);At.forEach((n,e)=>{ns[n.codePointAt(0)]=e}),ns["=".codePointAt(0)]=0;function rs(n){if(n>=ns.length)throw new Error("Unable to parse base64 string.");const e=ns[n];if(e===255)throw new Error("Unable to parse base64 string.");return e}function jy(n){let e="",t;const r=n.length;for(t=2;t<r;t+=3)e+=At[n[t-2]>>2],e+=At[(n[t-2]&3)<<4|n[t-1]>>4],e+=At[(n[t-1]&15)<<2|n[t]>>6],e+=At[n[t]&63];return t===r+1&&(e+=At[n[t-2]>>2],e+=At[(n[t-2]&3)<<4],e+="=="),t===r&&(e+=At[n[t-2]>>2],e+=At[(n[t-2]&3)<<4|n[t-1]>>4],e+=At[(n[t-1]&15)<<2],e+="="),e}function Wy(n){if(n.length%4!==0)throw new Error("Unable to parse base64 string.");const e=n.indexOf("=");if(e!==-1&&e<n.length-2)throw new Error("Unable to parse base64 string.");const t=n.endsWith("==")?2:n.endsWith("=")?1:0,r=n.length,i=new Uint8Array(3*(r/4));let s;for(let o=0,a=0;o<r;o+=4,a+=3)s=rs(n.codePointAt(o))<<18|rs(n.codePointAt(o+1))<<12|rs(n.codePointAt(o+2))<<6|rs(n.codePointAt(o+3)),i[a]=s>>16,i[a+1]=s>>8&255,i[a+2]=s&255;return i.subarray(0,i.length-t)}const $e=Ut(n=>({users:[],keyedUsers:new Set,addUser:e=>n(t=>({users:[...t.users,e]})),updateUser:(e,t)=>n(r=>({users:r.users.map(i=>i.id===e?{...i,...t}:i),keyedUsers:t.quantumRecv?r.keyedUsers.add(e):r.keyedUsers})),deleteUser:e=>n(t=>(t.keyedUsers.has(e)&&t.keyedUsers.delete(e),{users:t.users.filter(r=>r.id!==e),keyedUsers:t.keyedUsers}))})),Rt=Ut(n=>({onPeerJoin:nn,setOnPeerJoin:e=>n(t=>(t.onPeerJoin=e,t)),onPeerLeave:nn,setOnPeerLeave:e=>n(t=>(t.onPeerLeave=e,t)),onPeerStream:nn,setOnPeerStream:e=>n(t=>(t.onPeerStream=e,t)),onPeerTrack:nn,setOnPeerTrack:e=>n(t=>(t.onPeerTrack=e,t)),onPeerError:nn,setOnPeerError:e=>n(t=>(t.onPeerError=e,t))})),Ot=Ut(n=>({pendingPongs:{},addToPendingPongs:(e,t)=>n(r=>(r.pendingPongs[e]=t,r)),removeFromPendingPongs:e=>n(t=>(delete t.pendingPongs[e],t)),pendingStreamMetas:{},addToPendingStreamMetas:(e,t)=>n(r=>(r.pendingStreamMetas[e]=t,r)),removeFromPendingStreamMetas:e=>n(t=>(delete t.pendingStreamMetas[e],t)),pendingTrackMetas:{},addToPendingTrackMetas:(e,t)=>n(r=>(r.pendingTrackMetas[e]=t,r)),removeFromPendingTrackMetas:e=>n(t=>(delete t.pendingTrackMetas[e],t))})),Ie=Ut(n=>({peerMap:{},addToPeerMap:(e,t)=>n(r=>(r.peerMap[e]=t,r)),removeFromPeerMap:e=>n(t=>(delete t.peerMap[e],t)),actions:{},setActions:(e,t)=>n(r=>(r.actions[e]=t,r)),pendingTransmissions:{},addToPendingTransmissions:(e,t,r)=>n(i=>(i.pendingTransmissions[e]||(i.pendingTransmissions[e]={}),i.pendingTransmissions[e][t]=r,i)),removeFromPendingTransmissions:e=>n(t=>(delete t.pendingTransmissions[e],t))})),Jh=n=>{Ie.getState().peerMap[n]&&(Ie.getState().removeFromPeerMap(n),Ot.getState().removeFromPendingPongs(n),Ie.getState().removeFromPendingTransmissions(n),Rt.getState().onPeerLeave(n))},or=(n,e)=>{if(!n)throw qn("action type argument is required");if(Ie.getState().actions[n])throw qn(`action '${n}' already registered`);Ie.getState().setActions(n,{onComplete:nn,onProgress:nn});const t=()=>Object.keys(Ie.getState().peerMap);return[async(r,i,s,o)=>{if(s&&typeof s!="object")throw qn("action meta argument must be an object");i||(i=t());const a=oi(6),l=r instanceof Blob,c=l||r instanceof ArrayBuffer||r instanceof Uint8Array,h=typeof r!="string"&&!c&&!l;if(s&&!c)throw qn("action meta argument can only be used with binary data");const u=c?new Uint8Array(l?await r.arrayBuffer():r):Rn(h?JSON.stringify(r):r),d=Math.ceil(u.byteLength/br)+(s?1:0),f=(y,v,C)=>{const I=v===d-1,k=JSON.stringify({typeBytes:n,uuid:a,isLast:I,isMeta:C,isBinary:c,isJson:h,progress:Math.round((v+1)/d*$u),payload:jy(C?Rn(JSON.stringify(s)):y)});return Rn(k)},g=typeof i=="string"?[i]:i;await Promise.all(g.map(async y=>{var k;const v=typeof y=="string"?Ie.getState().peerMap[y]:Ie.getState().peerMap[y.id];if(!v)return;const C=v._channel;let I=0;for(;I<d;){const w=(()=>I===0&&s?f(s,I,!0):f(s?u.slice((I-1)*br,I*br):u.slice(I*br,(I+1)*br),I,!1))();if(C.bufferedAmount>C.bufferedAmountLowThreshold&&await new Promise(N=>{const A=()=>{C.removeEventListener("bufferedamountlow",A),N()};C.addEventListener("bufferedamountlow",A)}),e)if(typeof y=="string"){const N=(k=$e.getState().users.find(A=>A.id===y))==null?void 0:k.quantumSend;N&&Kh(w,N).then(A=>v.send(A))}else y.quantumSend&&Kh(w,y.quantumSend).then(N=>v.send(N));else v.send(w);I++,o&&o(I/d,typeof y=="string"?y:y.id,s)}}))},r=>Ie.getState().actions[n]={...Ie.getState().actions[n],onComplete:r},r=>Ie.getState().actions[n]={...Ie.getState().actions[n],onProgress:r}]},Xh=async(n,e)=>{const[t,r]=or("__91n6__",!0),[i,s]=or("__90n6__",!0),[o,a]=or("__516n4L__",!0),[l,c]=or("__57r34m__",!0),[h,u]=or("__7r4ck__",!0);return n((d,f)=>{if(Ie.getState().peerMap[f])return;Ie.getState().addToPeerMap(f,d);const g={},y={},v=(C,I)=>{const{typeBytes:k,uuid:w,isLast:N,isMeta:A,isBinary:T,isJson:Y,progress:B,payload:O}=I,_=Wy(O),le=Ie.getState().actions[k];if(!le)throw qn(`received message with unregistered type (${k})`);const xe=y[w]||(y[w]={chunks:new Uint8Array,meta:void 0});if(A?xe.meta=JSON.parse(On(_)):xe.chunks=new Uint8Array([...xe.chunks,..._]),le.onProgress(B/$u,C,xe.meta),N){if(T)le.onComplete(xe.chunks,C,xe.meta);else{const ce=On(xe.chunks);le.onComplete(Y?JSON.parse(ce):ce,C)}delete y[w]}};d.on(rt.signal,C=>o(C,[f])),d.on(rt.close,()=>Jh(f)),d.on(rt.data,C=>{var k;const I=new Uint8Array(C);try{const w=g[f];if(!w)throw qn("");return Qh(I,w).then(N=>{const A=JSON.parse(On(N));v(f,A)}).catch(N=>console.error(N))}catch{const w=(k=$e.getState().users.find(N=>N.id===f))==null?void 0:k.quantumRecv;w?(g[f]=w,Qh(I,w).then(N=>{const A=JSON.parse(On(N));v(f,A)}).catch(N=>console.error(N))):v(f,JSON.parse(On(I)))}}),d.on(rt.stream,C=>{Rt.getState().onPeerStream(C,f,Ot.getState().pendingStreamMetas[f]),Ot.getState().removeFromPendingStreamMetas(f)}),d.on(rt.track,(C,I)=>{Rt.getState().onPeerTrack(C,I,f,Ot.getState().pendingTrackMetas[f]),Ot.getState().removeFromPendingTrackMetas(f)}),d.on(rt.error,C=>{Rt.getState().onPeerError(f,C),Jh(f),C.code!=="ERR_DATA_CHANNEL"&&console.error(C)}),Rt.getState().onPeerJoin(f)}),r((d,f)=>i(null,[f])),s((d,f)=>{const g=Ot.getState().pendingPongs[f];g&&(g(),Ot.getState().removeFromPendingPongs(f))}),a((d,f)=>{const g=Ie.getState().peerMap[f];g&&g.signal(d)}),c((d,f)=>Ot.getState().addToPendingStreamMetas(f,d)),u((d,f)=>Ot.getState().addToPendingTrackMetas(f,d)),{makeAction:or,ping:async d=>{if(!d)throw qn("ping() must be called with target peer ID");const f=Date.now();return t(null,[d]),await new Promise(g=>Ot.getState().addToPendingPongs(d,g)),Date.now()-f},leave:()=>{for(const[d,f]of Object.entries(Ie.getState().peerMap))f.destroy(),Ie.getState().removeFromPeerMap(d);e()},getPeers:()=>Object.fromEntries(Object.entries(Ie.getState().peerMap).map(([d,f])=>[d,f._pc])),addStream:(d,f,g)=>{const y=Ie.getState().peerMap,v=f||Object.keys(y),C=[];for(const I of v){const k=y[I];g&&C.push(l(g,[I])),C.push(k.addStream(d))}return Promise.all(C)},removeStream:(d,f)=>{const g=Ie.getState().peerMap,y=f||Object.keys(g);for(const v of y){const C=g[v];C.streams.some(I=>I.id===d.id)&&C.removeStream(d)}},addTrack:(d,f,g,y)=>{if(g)return Promise.all(Object.entries(Ie.getState().peerMap).filter(([v])=>g.includes(v)).map(async([v,C])=>{y&&await h(y,[v]),C.addTrack(d,f)}))},removeTrack:(d,f,g)=>{if(g)return(typeof g=="string"?[g]:g).forEach(y=>{const v=Ie.getState().peerMap[y];v&&v.removeTrack(d,f)})},replaceTrack:(d,f,g,y,v)=>{if(y)return Promise.all(Object.entries(Ie.getState().peerMap).filter(([C])=>y.includes(C)).map(async([C,I])=>{v&&await h(v,[C]),I.replaceTrack(d,f,g)}))},onPeerJoin:d=>Rt.getState().setOnPeerJoin(d),onPeerLeave:d=>Rt.getState().setOnPeerLeave(d),onPeerError:d=>Rt.getState().setOnPeerError(d),onPeerStream:d=>Rt.getState().setOnPeerStream(d),onPeerTrack:d=>Rt.getState().setOnPeerTrack(d)}},Zh="_",Sa={},ar={},Hy=(...n)=>n.join("/"),Vy=n=>n.startsWith("https://")?n:`https://${n}.firebaseio.com`,$y=n=>{if(n.firebaseApp){const t=n.firebaseApp.options.databaseURL;if(t){if(ar[t])return ar[t];{const r=Wh(n.firebaseApp);return ar[t]=r,r}}}const e=Vy(n.appId);if(ar[e])return ar[e];{const t=Wh(Fl({databaseURL:e}));return ar[e]=t,t}},eu=Gu(Sa,async(n,e)=>{const t=$y(n);if(!t)throw new Error("No database!");const r={},i={},s={},o=Bh(t,`${e}`),a=An(o,Ye),l=n.password&&await Hh(n.password,e),c=[],h=(f,g)=>{if(r[f]&&!r[f].destroyed)return r[f];const y=Wa(g,!0,n.rtcConfig);return y.once(rt.connect,()=>{d(y,f),s[f]=Math.floor(Date.now()/1e3)}),y.on(rt.signal,async v=>{if(s[f])return;const C=JSON.stringify(v),I=ag(Bh(t,Hy(`${e}`,f,Ye)));qh(I).remove(),Gi(I,l?await ya(l,C):C)}),y.once(rt.close,()=>{delete r[f],delete i[f],delete s[f]}),r[f]=y,y};let u=!1,d=nn;return Sa[e]=!0,Gi(a,{[Zh]:!0}),qh(a).remove(),ma(a,f=>{const g=f.key;!g||g===Zh||s[g]||c.push(ma(f.ref,async y=>{if(g in i||(i[g]={}),y.key){if(y.key in i[g])return;i[g][y.key]=!0;let v;try{const C=JSON.parse(y.val());if(C.iv){if(!l)throw new Error("No crypto key!");const I=await ba(l,C).catch(console.error);if(!I)throw new Error("No decrypted value!");v=JSON.parse(I)}else n.password||(v=C)}catch(C){console.error(`${vs}: received malformed SDP JSON`),console.error(C);return}h(g,!1).signal(v),zh(y.ref)}}))}),lg(o,()=>u=!0,{onlyOnce:!0}),ma(o,({key:f})=>{!u||f===Ye||!f||h(f,!0)}),await Xh(f=>d=f,()=>{jh(a),zh(a),jh(o);for(const f of c)f();delete Sa[e]})}),ka={},Ta={},Qr={},tu=20,nu=10,Gy=2,Yy=33,Ky=120,ru="announce",Qy=Gu(ka,async(n,e)=>{const t={},r=n.password&&await Hh(n.password,e),i=n.trackerUrls.slice(0,n.trackerUrls?n.trackerUrls.length:n.trackerRedundancy||Gy);if(i.length===0)throw new Error("trackerUrls is empty");const s=crypto.subtle.digest("SHA-1",Rn(`${vs}:${n.appId}:${e}`)).then(w=>[...new Uint8Array(w)].map(N=>N.toString(36)).join("").slice(0,tu)),o=w=>Object.fromEntries(Array.from({length:w}).fill("").map(()=>{const N=Wa(!0,!1,n.rtcConfig);return[oi(tu),{peer:N,offerP:new Promise(A=>N.once(rt.signal,A))}]})),a=()=>o(nu),l=async(w,N)=>{const A=await s;let T;try{T=JSON.parse(N.data)}catch{console.error(`${vs}: received malformed SDP JSON`);return}if(T.info_hash!==A||T.peer_id&&T.peer_id===Ye)return;const Y=T["failure reason"];if(Y){console.warn(`${vs}: torrent tracker failure (${Y})`);return}if(T.interval&&T.interval>y&&T.interval<=Ky&&(clearInterval(v),y=T.interval,v=setInterval(u,y*1e3)),T.offer&&T.offer_id){if(t[T.peer_id]||I[T.offer_id])return;I[T.offer_id]=!0;const B=Wa(!1,!1,n.rtcConfig);B.once(rt.signal,async O=>w.send(JSON.stringify({answer:r?{...O,sdp:await ya(r,O.sdp)}:O,action:ru,info_hash:A,peer_id:Ye,to_peer_id:T.peer_id,offer_id:T.offer_id}))),B.on(rt.connect,()=>f(B,T.peer_id,`${T.offer_id}`)),B.on(rt.close,()=>g(B,T.peer_id,`${T.offer_id}`)),B.signal(r?{...T.offer,sdp:await ba(r,JSON.parse(T.offer.sdp)),type:"offer"}:{...T.offer,type:"offer"});return}if(T.answer){if(t[T.peer_id]||I[T.offer_id])return;const B=k[T.offer_id];if(B){const{peer:O}=B;if(O.destroyed)return;I[T.offer_id]=!0,O.on(rt.connect,()=>f(O,T.peer_id,`${T.offer_id}`)),O.on(rt.close,()=>g(O,T.peer_id,`${T.offer_id}`)),O.signal(r?{...T.answer,sdp:await ba(r,JSON.parse(T.answer.sdp)),type:"answer"}:{...T.answer,type:"answer"})}}},c=async(w,N)=>w.send(JSON.stringify({action:ru,info_hash:N,numwant:nu,peer_id:Ye,offers:await Promise.all(Object.entries(k).map(async([A,{offerP:T}])=>{const Y=await T;return{offer_id:A,offer:r?{...Y,sdp:await ya(r,Y.sdp)}:Y}}))})),h=(w,N,A=!1)=>(A||!Ta[w]?(Qr[w]={...Qr[w],[N]:l},Ta[w]=new Promise(T=>{const Y=new WebSocket(w);Y.addEventListener("open",T.bind(null,Y)),Y.addEventListener("error",console.error),Y.addEventListener("message",B=>{for(const O of Object.values(Qr[w]))O(Y,B)})})):Qr[w][N]=l,Ta[w]),u=async()=>{const w=await s;k&&d(),k=a(),i.forEach(async N=>{const A=await h(N,w);A.readyState===WebSocket.OPEN?c(A,w):A.readyState!==WebSocket.CONNECTING&&c(await h(N,w,!0),w)})},d=()=>{for(const[w,{peer:N}]of Object.entries(k))!I[w]&&!t[w]&&N.destroy();I={}},f=(w,N,A)=>{C(w,N),t[N]=!0,A&&(t[A]=!0)},g=(w,N,A)=>{delete t[N],w.destroy(),A in k&&(delete k[A],k={...k,...o(1)})};let y=Yy,v=setInterval(u,y*1e3),C=nn,I={},k;return ka[e]=!0,u(),await Xh(w=>{C=w},async()=>{const w=await s;for(const N of i)delete Qr[N][w];delete ka[e],clearInterval(v),d()})}),Le=Ut((n,e)=>({myStream:void 0,setMyStream:t=>n({myStream:t}),isSharing:!1,setIsSharing:t=>n({isSharing:t}),videoBubbles:[],addVideoBubble:t=>n({videoBubbles:[...e().videoBubbles,t]}),removeBubbleWithId:t=>n({videoBubbles:e().videoBubbles.filter(r=>r.id!==t)}),clearVideoBubbles:()=>n({videoBubbles:[]}),callConsent:!1,setCallConsent:t=>n({callConsent:t})})),Ne=Ut((n,e)=>({activeTab:"chat",setActiveTab:t=>n({activeTab:t}),notifyTabs:new Set,addtoNotifyTabs:t=>n(r=>({notifyTabs:new Set([...r.notifyTabs,t])})),removeFromNotifyTabs:t=>n(r=>(r.notifyTabs.delete(t),{notifyTabs:r.notifyTabs})),roomPassword:void 0,setPassword:t=>n({roomPassword:t}),disappearingMessagesLength:1e3,setDisappearingMessagesLength:t=>n({disappearingMessagesLength:t}),mutedUsers:{},toggleMute:t=>n(r=>({mutedUsers:{...r.mutedUsers,[t]:!r.mutedUsers[t]}})),addUser:t=>n(r=>({mutedUsers:{...r.mutedUsers,[t]:!1}})),removeUser:t=>n(r=>{const{[t]:i,...s}=r.mutedUsers;return{mutedUsers:s}}),typingUsers:[],addTypingUser:t=>{e().typingUsers.includes(t)||n(r=>({typingUsers:[...r.typingUsers,t]}))},removeTypingUser:t=>n(r=>({typingUsers:r.typingUsers.filter(i=>i!==t)}))}));class Jy{constructor({room:e}){de(this,"joinRoom");de(this,"removeStream");de(this,"addStream");de(this,"shareMedia",async(e,t)=>{if(e==="cutStream"){const r=Le.getState().videoBubbles;t&&[...r.map(i=>i.stream),t].forEach(i=>i&&this.removeStream(i)),Le.getState().clearVideoBubbles(),this.joinRoom("cutStream"),Le.getState().setCallConsent(!1),Le.getState().setIsSharing(!1)}else if(e==="view")Le.getState().setCallConsent(!0),Le.getState().setIsSharing(!0),t&&(t.getTracks().forEach(r=>{r.stop()}),this.removeStream(t)),this.joinRoom("view");else{Le.getState().setCallConsent(!0);const r=await(async()=>{switch(e){case"phone":return await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});case"video":return await navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case"screen":{const i=await navigator.mediaDevices.getDisplayMedia({audio:!0,video:!0}),s=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),o=[...i.getVideoTracks(),...s.getAudioTracks()];return new MediaStream(o)}default:throw new Error("Invalid media type")}})();if(r)return t&&this.removeStream(t),this.addStream(r),this.joinRoom(e).then(()=>Le.getState().setIsSharing(!0)),r}});const[t,r]=e.makeAction("joinRTCRoom",!0),{addStream:i,removeStream:s}=e;this.addStream=i,this.removeStream=s,this.joinRoom=t,e.onPeerStream((o,a)=>{const l=Le.getState().videoBubbles.find(h=>h.id===a);l&&l.stream&&(e.removeStream(l.stream),Le.getState().removeBubbleWithId(a)),o.addEventListener("removetrack",()=>{Le.getState().removeBubbleWithId(a),e.removeStream(o)});const c=o.getVideoTracks().length===0;Le.getState().addVideoBubble({id:a,stream:o,isAudioOnly:c}),Ne.getState().activeTab!=="call"&&Ne.getState().addtoNotifyTabs("call")}),r((o,a)=>{if(o==="view"){const l=Le.getState().videoBubbles.find(c=>c.id===a);l&&l.stream&&(e.removeStream(l.stream),Le.getState().removeBubbleWithId(a)),Le.getState().addVideoBubble({id:a,stream:void 0,isAudioOnly:!1})}else o==="cutStream"&&Le.getState().removeBubbleWithId(a)})}}class Xy{constructor({room:e,roomId:t}){de(this,"sendChatAction");de(this,"sendTyping");de(this,"roomId");de(this,"sendChat",async e=>{if(e.trim()===""||this.roomId.trim()==="")return;const t={sentBy:Ye,id:oi(6),text:e,sentAt:Date.now(),recievedAt:Date.now(),roomId:this.roomId},r=$e.getState().users.filter(s=>s.roomId===this.roomId&&s.active).map(s=>s.id);this.sendTypingIndicator(!1),this.sendChatAction(t,r);const i=Ne.getState().disappearingMessagesLength;Ha.getState().addMessage(t,i)});de(this,"sendTypingIndicator",e=>{this.sendTyping(e)});const[r,i]=e.makeAction("chat",!0),[s,o]=e.makeAction("isTyping",!0);this.sendChatAction=r,this.sendTyping=s,this.roomId=t,i(async(a,l)=>{if(Ne.getState().mutedUsers[l]!==!0){const c={id:a.id,text:a.text,sentAt:a.sentAt,sentBy:l,recievedAt:Date.now(),roomId:a.roomId},h=Ne.getState().disappearingMessagesLength;Ha.getState().addMessage(c,h),Ne.getState().activeTab!=="chat"&&Ne.getState().addtoNotifyTabs("chat")}}),o((a,l)=>{a===!0?Ne.getState().addTypingUser(l):Ne.getState().removeTypingUser(l)})}}const iu=globalThis.showSaveFilePicker;async function Zy(n={}){if(iu&&!n._preferPolyfill)return iu(n);n._name&&(console.warn("deprecated _name, spec now have `suggestedName`"),n.suggestedName=n._name);const{FileSystemFileHandle:e}=await mn(()=>Promise.resolve().then(()=>Xr),void 0),{FileHandle:t}=await mn(()=>import("./downloader-2790525b.js").then(async r=>(await r.__tla,r)),["assets/downloader-2790525b.js","assets/util-10c81017.js","assets/index-8e29a41c.js","assets/index-b05acfd9.css","assets/GenericHeader-b6f3410d.js","assets/roomConfig-0e0bf8eb.js","assets/InfiniteScroll-8d0fe7e7.js","assets/Collapsible-beba5fc1.js"]);return new e(new t(n.suggestedName))}globalThis.DataTransferItem&&!DataTransferItem.prototype.getAsFileSystemHandle&&(DataTransferItem.prototype.getAsFileSystemHandle=async function(){const n=this.webkitGetAsEntry(),[{FileHandle:e,FolderHandle:t},{FileSystemDirectoryHandle:r},{FileSystemFileHandle:i}]=await Promise.all([mn(()=>import("./sandbox-70eac9fd.js"),["assets/sandbox-70eac9fd.js","assets/util-10c81017.js"]),mn(()=>Promise.resolve().then(()=>su),void 0),mn(()=>Promise.resolve().then(()=>Xr),void 0)]);return n.isFile?new i(new e(n,!1)):new r(new t(n,!1))});const hn=Symbol("adapter");class Ea{constructor(e){de(this,iv);de(this,"name");de(this,"kind");this.kind=e.kind,this.name=e.name,this[hn]=e}async queryPermission({mode:e="read"}={}){const t=this[hn];if(t.queryPermission)return t.queryPermission({mode:e});if(e==="read")return"granted";if(e==="readwrite")return t.writable?"granted":"denied";throw new TypeError(`Mode ${e} must be 'read' or 'readwrite'`)}async requestPermission({mode:e="read"}={}){const t=this[hn];if(t.requestPermission)return t.requestPermission({mode:e});if(e==="read")return"granted";if(e==="readwrite")return t.writable?"granted":"denied";throw new TypeError(`Mode ${e} must be 'read' or 'readwrite'`)}async remove(e={}){await this[hn].remove(e)}async isSameEntry(e){return this===e?!0:!e||typeof e!="object"||this.kind!==e.kind||!e[hn]?!1:this[hn].isSameEntry(e[hn])}}iv=hn,Object.defineProperty(Ea.prototype,Symbol.toStringTag,{value:"FileSystemHandle",writable:!1,enumerable:!1,configurable:!0});const un=Symbol("adapter");class dn extends Ea{constructor(t){super(t);de(this,sv);this[un]=t}async getDirectoryHandle(t,r={}){if(t==="")throw new TypeError("Name can't be an empty string.");if(t==="."||t===".."||t.includes("/"))throw new TypeError("Name contains invalid characters.");r.create=!!r.create;const i=await this[un].getDirectoryHandle(t,r);return new dn(i)}async*entries(){const{FileSystemFileHandle:t}=await mn(()=>Promise.resolve().then(()=>Xr),void 0);for await(const[r,i]of this[un].entries())yield[i.name,i.kind==="file"?new t(i):new dn(i)]}async*getEntries(){const{FileSystemFileHandle:t}=await mn(()=>Promise.resolve().then(()=>Xr),void 0);console.warn("deprecated, use .entries() instead");for await(let r of this[un].entries())yield r.kind==="file"?new t(r):new dn(r)}async getFileHandle(t,r={}){const{FileSystemFileHandle:i}=await mn(()=>Promise.resolve().then(()=>Xr),void 0);if(t==="")throw new TypeError("Name can't be an empty string.");if(t==="."||t===".."||t.includes("/"))throw new TypeError("Name contains invalid characters.");r.create=!!r.create;const s=await this[un].getFileHandle(t,r);return new i(s)}async removeEntry(t,r={}){if(t==="")throw new TypeError("Name can't be an empty string.");if(t==="."||t===".."||t.includes("/"))throw new TypeError("Name contains invalid characters.");return r.recursive=!!r.recursive,this[un].removeEntry(t,r)}async resolve(t){if(await t.isSameEntry(this))return[];const r=[{handle:this,path:[]}];for(;r.length;){let{handle:i,path:s}=r.pop();for await(const o of i.values()){if(await o.isSameEntry(t))return[...s,o.name];o.kind==="directory"&&r.push({handle:o,path:[...s,o.name]})}}return null}async*keys(){for await(const[t]of this[un].entries())yield t}async*values(){for await(const[t,r]of this)yield r}[(sv=un,Symbol.asyncIterator)](){return this.entries()}}Object.defineProperty(dn.prototype,Symbol.toStringTag,{value:"FileSystemDirectoryHandle",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(dn.prototype,{getDirectoryHandle:{enumerable:!0},entries:{enumerable:!0},getFileHandle:{enumerable:!0},removeEntry:{enumerable:!0}});let su,ou;su=Object.freeze(Object.defineProperty({__proto__:null,FileSystemDirectoryHandle:dn,default:dn},Symbol.toStringTag,{value:"Module"})),Ka={ReadableStream:globalThis.ReadableStream,WritableStream:globalThis.WritableStream,TransformStream:globalThis.TransformStream,DOMException:globalThis.DOMException,Blob:globalThis.Blob,File:globalThis.File},{WritableStream:ou}=Ka;class Jr extends ou{constructor(...e){super(...e),Object.setPrototypeOf(this,Jr.prototype),this._closed=!1}close(){this._closed=!0;const e=this.getWriter(),t=e.close();return e.releaseLock(),t}seek(e){return this.write({type:"seek",position:e})}truncate(e){return this.write({type:"truncate",size:e})}write(e){if(this._closed)return Promise.reject(new TypeError("Cannot write to a CLOSED writable stream"));const t=this.getWriter(),r=t.write(e);return t.releaseLock(),r}}Object.defineProperty(Jr.prototype,Symbol.toStringTag,{value:"FileSystemWritableFileStream",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(Jr.prototype,{close:{enumerable:!0},seek:{enumerable:!0},truncate:{enumerable:!0},write:{enumerable:!0}});const is=Symbol("adapter");class ss extends Ea{constructor(t){super(t);de(this,ov);this[is]=t}async createWritable(t={}){return new Jr(await this[is].createWritable(t))}async getFile(){return this[is].getFile()}}ov=is,Object.defineProperty(ss.prototype,Symbol.toStringTag,{value:"FileSystemFileHandle",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(ss.prototype,{createWritable:{enumerable:!0},getFile:{enumerable:!0}});const Xr=Object.freeze(Object.defineProperty({__proto__:null,FileSystemFileHandle:ss,default:ss},Symbol.toStringTag,{value:"Module"})),et=Ut(n=>({progressQueue:[],addProgress:e=>n(t=>({progressQueue:[...t.progressQueue,e]})),deleteProgress:e=>n(t=>({progressQueue:t.progressQueue.filter(r=>r.uuid!==e)})),deleteFid:e=>n(t=>({progressQueue:t.progressQueue.filter(r=>r.id!==e)})),updateOrAddProgress:(e,t)=>n(r=>r.progressQueue.filter(i=>i.uuid===e).length===0?{progressQueue:[...r.progressQueue,{...t}]}:{progressQueue:r.progressQueue.map(i=>e===i.uuid?{...i,...t}:i)}),writablesQueue:[],addWritable:e=>n(t=>(t.writablesQueue.push(e),{writablesQueue:t.writablesQueue})),removeWritable:e=>{n(t=>(t.writablesQueue=t.writablesQueue.filter(r=>r.uuid===e?(r.writable.close(),!1):!0),{writablesQueue:t.writablesQueue}))},removeFile:e=>n(t=>({progressQueue:t.progressQueue.filter(r=>r.id!==e),writablesQueue:t.writablesQueue.filter(r=>r.fileId===e?(r.writable.close(),!1):!0)}))})),Zr=Ut(n=>({realFiles:{},addRealFiles:e=>n(t=>({realFiles:{...t.realFiles,...(()=>{const r={};for(const i of e)r[oi(6)]=i;return r})()}})),deleteRealFile:e=>n(t=>{const{[e]:r,...i}=t.realFiles;return{realFiles:i}})})),ei=Ut(n=>({requestableDownloads:{},updateOrAddRequestable:(e,t)=>n(r=>({requestableDownloads:{...r.requestableDownloads,[e]:t}})),removeRequestablesForId:e=>n(t=>({requestableDownloads:(()=>{const r=t.requestableDownloads;return e in r&&delete r[e],r})()}))})),os=br*40,eb=(n,e)=>n.slice(e*os,(e+1)*os).arrayBuffer().then(t=>new Uint8Array(t)),au=({chunkN:n,rawProg:e,fullSize:t,uuid:r,id:i,name:s,toUser:o})=>{const a=Number(((n+e)/(Math.ceil(t/os)+1)).toFixed(4));a>=1?et.getState().deleteProgress(r):et.getState().updateOrAddProgress(r,{id:i,uuid:r,name:s,chunkN:n,progress:a,toUser:o})};class tb{constructor({room:e,roomId:t}){de(this,"sendFileOffer");de(this,"sendFileAck");de(this,"terminateClient");de(this,"requestFile",async(e,t)=>{const r=ei.getState().requestableDownloads[e],i=r&&r.find(s=>s.id===t);if(i){const s=oi(6);await Zy({suggestedName:i.name,excludeAcceptAllOption:!1}).then(async o=>(et.getState().addProgress({id:i.id,uuid:s,name:i.name,chunkN:0,progress:0,toUser:Ye}),o)).then(o=>o.createWritable()).then(o=>et.getState().addWritable({fileId:i.id,uuid:s,writable:o})).then(()=>this.sendFileAck({uuid:s,id:i.id,chunkN:0},[e]))}else alert("file not found!")});de(this,"offerRequestableFiles",async e=>{const t=Zr.getState().realFiles;if(!t||Object.keys(t).length===0){this.sendFileOffer([],e).catch(i=>console.error(i));return}const r=Object.entries(t).map(([i,s])=>({id:i,ownerId:Ye,name:s.name,size:s.size}));this.sendFileOffer(r,e).catch(i=>console.error(i))});de(this,"removeRealFile",e=>{et.getState().deleteFid(e),Zr.getState().deleteRealFile(e),this.offerRequestableFiles()});de(this,"addRealFiles",e=>{Zr.getState().addRealFiles(e),this.offerRequestableFiles()});de(this,"attemptResume",async e=>{const t=et.getState().progressQueue.find(r=>r.uuid===e);t&&this.sendFileAck({uuid:e,id:t.id,chunkN:t.chunkN})});de(this,"cancelFile",e=>{const t=et.getState().progressQueue.find(r=>r.uuid===e);t&&(t.toUser===Ye?(et.getState().removeWritable(e),this.sendFileAck({uuid:e,id:t.id,chunkN:-1})):this.terminateClient(t.toUser,e),et.getState().deleteProgress(e))});de(this,"peerJoinHook",e=>setTimeout(()=>this.offerRequestableFiles([e]),5e3));const[r,i,s]=e.makeAction("transfer",!0),[o,a]=e.makeAction("fileOffer",!0),[l,c]=e.makeAction("fileAck",!0);this.sendFileOffer=o,this.sendFileAck=l,this.terminateClient=(h,u)=>r(new Uint8Array,[h],{uuid:u,chunkN:-1}),$e.subscribe((h,u)=>{h.keyedUsers.size>u.keyedUsers.size&&this.offerRequestableFiles()}),c(async(h,u)=>{if(Ne.getState().mutedUsers[u])return;const d=Zr.getState().realFiles[h.id];if(!d)return;const f=Math.ceil(d.size/os);if(h.chunkN===-1){et.getState().deleteProgress(h.uuid);return}await eb(d,h.chunkN).then(g=>r(g,[u],{id:h.id,uuid:h.uuid,chunkN:h.chunkN,name:d.name,size:d.size,last:h.chunkN===f},(y,v)=>au({chunkN:h.chunkN,rawProg:y,fullSize:d.size,uuid:h.uuid,id:h.id,name:d.name,toUser:u}))).catch(g=>console.error(g))}),s((h,u,d)=>{if(d===void 0)return;const f=d;au({chunkN:f.chunkN,rawProg:h,fullSize:f.size,uuid:f.uuid,id:f.id,name:f.name,toUser:Ye})}),i(async(h,u,d)=>{var y;const f=d;if(f.chunkN&&f.chunkN===-1){et.getState().removeWritable(f.uuid),et.getState().deleteProgress(f.uuid);return}const g=(y=et.getState().writablesQueue.find(v=>v.uuid===f.uuid))==null?void 0:y.writable;g&&await g.write(h).then(()=>{if(f.last)et.getState().removeWritable(f.uuid);else return l({uuid:f.uuid,id:f.id,chunkN:f.chunkN+1})})}),a(async(h,u)=>{Ne.getState().mutedUsers[u]!==!0&&(ei.getState().updateOrAddRequestable(u,h),h.length>0&&(Va(t,`${_n(u)} offered you files`),Ne.getState().activeTab!=="downloads"&&Ne.getState().addtoNotifyTabs("downloads")))})}}const lr=Ut(n=>({persona:{name:Yu(),keyPair:void 0},createPersona:()=>n(e=>({persona:{name:_n(Ye),keyPair:$h()}})),updatePersona:e=>n(t=>({persona:{...t.persona,...e}})),resetPersona:()=>n(e=>({persona:{name:Yu(),keyPair:$h()}}))}));class nb{constructor({room:e,roomId:t}){de(this,"sendName");de(this,"sendEncryptionInfo");de(this,"roomId");de(this,"peerJoinHook",async e=>{$e.getState().addUser({id:e,roomId:this.roomId,active:!0,name:_n(e)}),Ne.getState().addUser(e),await this.syncInfo(e),Va(this.roomId,`${_n(e)} joined the room`)});de(this,"syncInfo",async e=>{const t=lr.getState().persona;t&&(e?(t.keyPair&&await this.sendEncryptionInfo(t.keyPair.publicKey,[e]),$e.getState().keyedUsers.has(e)&&this.sendName(t.name,[e])):Ne.getState().roomPassword?t.keyPair&&(await this.sendEncryptionInfo(t.keyPair.publicKey),this.sendName(t.name)):this.sendName(t.name))});de(this,"setMyName",e=>{lr.getState().updatePersona({name:e}),this.syncInfo()});de(this,"createPersona",async()=>{await lr.getState().createPersona(),this.syncInfo()});const[r,i]=e.makeAction("name",!0),[s,o]=e.makeAction("encReq"),[a,l]=e.makeAction("encProc");this.sendName=r,this.sendEncryptionInfo=s,this.roomId=t,$e.subscribe((c,h)=>{c.keyedUsers.size>h.keyedUsers.size&&this.syncInfo()}),e.onPeerError((c,h)=>{console.error(c,"_",h)}),e.onPeerLeave(c=>{var h;$e.getState().updateUser(c,{active:!1}),(h=ei.getState().requestableDownloads[c])==null||h.forEach(u=>et.getState().removeFile(u.id)),ei.getState().removeRequestablesForId(c),Ne.getState().removeUser(c),Va(t,`${_n(c)} left the room`)}),i((c,h)=>{$e.getState().updateUser(h,{name:c})}),o(async(c,h)=>{if(c)try{const{ciphertext:u,sharedSecret:d}=await Og(c);$e.getState().updateUser(h,{quantumSend:d}),a(u,[h])}catch(u){console.error(u)}}),l(async(c,h)=>{if(!c)return;const u=lr.getState().persona;if(u&&u.keyPair){const d=await Dg(c,u.keyPair.privateKey);try{$e.getState().updateUser(h,{quantumRecv:d})}catch(f){console.error(f)}}})}}const rb=({tabs:n})=>{const e=Ne(r=>r.activeTab),t=Ne(r=>r.notifyTabs);return m("div",{children:m("div",{className:"tab-list",children:n.map((r,i)=>m(je,{className:r.label===e?"active":"",primary:r.label===e,icon:m("div",{style:{borderBottom:t.has(r.label)?"2px solid red":void 0},children:r.icon}),tip:r.label,onClick:()=>{Ne.getState().setActiveTab(r.label),Ne.getState().removeFromNotifyTabs(r.label)}},i))})})},ib=({tabs:n})=>{const e=Ne(t=>t.activeTab);return m(ne,{style:{height:"84vh",overflow:"hidden"},children:n[e]})};function sb(n){const{roomId:e,children:t}=n;return m(fv,{background:"brand",pad:"medium",children:[m("div",{className:"mobileHide",children:m(ne,{direction:"row",align:"center",gap:"small",style:{paddingTop:"0",height:"8vh"},children:[m(je,{label:"home",onClick:()=>{$a("/"),location.reload()},icon:m(xs,{}),tip:"Go back to home"}),m(Ku,{alt:"paracord logo",style:{height:"10vh"},src:Qu}),m(ne,{style:{borderBottom:"1px solid #eaeaea",width:"100%"},children:[m(ze,{size:"xxlarge",children:"Paracord"}),m(ze,{size:"medium",children:["Room ID ",decodeURI(e)]})]})]})}),m("div",{className:"mobileShow",children:m(Ku,{alt:"paracord logo",style:{height:"10vh"},src:Qu,onClick:()=>{$a("/"),location.reload()}})}),t,m("div",{className:"mobileHide",children:m(je,{style:{marginLeft:"auto"},onClick:()=>{navigator.clipboard.writeText(window.location.href)},label:"Copy room link",icon:m(nl,{})})})]})}function ob({isMuted:n,toggleMuted:e}){const t=n?m(dl,{tip:"unblock transmission"}):m(ul,{tip:"block transmission"});return m(je,{icon:t,color:"brand",tip:n?"unblock transmission":"block transmission",pad:"0",onClick:e})}function ab(n){const{roomId:e,userManagerInstance:t}=n,r=lr(l=>l.persona),i=$e(l=>l.users),s=Ne(),[o,a]=tn(!0);return ai(()=>{window.addEventListener("resize",()=>a(window.innerWidth>660))}),o?m(Ss,{border:{color:"brand",size:"small"},round:"small",style:{height:"84vh"},header:m(Et,{children:m(ne,{round:"small",pad:"small",background:"dark-1",children:[m(ne,{direction:"row",gap:"medium",children:[m(ze,{size:"large",style:{color:li(Ye)},children:"You"}),m(je,{icon:m(il,{}),color:"theme",style:{marginLeft:"auto"},onClick:()=>a(!o)})]}),m(Ga,{type:"text",value:r==null?void 0:r.name,autocapitalize:"off",autoComplete:"off",style:{width:"100%"},onBlur:l=>l.currentTarget.value.trim()!==""&&t.setMyName(l.currentTarget.value)}),m(ze,{size:"small",style:{color:"grey"},children:_n(Ye)})]})}),children:m(od,{gap:"small",children:[m(ze,{size:"large",children:"Peers"}),m(ne,{pad:"small",border:{color:"brand",size:"small"},round:"small",background:"dark-1",style:{whiteSpace:"pre-line",overflowX:"auto",overflowY:"scroll",height:"30vh"},children:i.length>0?m(ed,{items:i.filter(l=>l.roomId===e&&l.active),pad:"small",style:{scrollbars:"hidden"},children:({name:l,id:c})=>{const h=Ne.getState().typingUsers.includes(c);return m("div",{children:[m(ne,{direction:"row",gap:"small",children:[m(ob,{toggleMuted:()=>s.toggleMute(c),isMuted:s.mutedUsers[c]||!1}),m(ze,{style:{color:li(c)},className:h&&"bouncing-letters",children:l})]},c),m(ze,{size:"small",style:{color:"grey"},children:_n(c)})]})}}):m(Et,{children:[m(ze,{size:"medium",children:"Waiting..."}),m(ze,{color:"red",size:"small",children:"[invite another person to unlock the UI]"})]})})]})}):m(je,{primary:!0,icon:m(sl,{}),onClick:()=>a(!o)})}const lb="4.3.0",Ia=Math.PI,cr=2*Ia,Na=Ia/2,lu=8.17579892,cu="dual-combined",as="dual-horizontal",Qt="single",Jt="dual-vertical",hu="bar-index",uu="bar-level",ls="gradient",du=60,pu="click",cb="fullscreenchange",fu="resize",hb="#111",mu="",_u="A",gu="B",yu="C",bu="D",vu="468",cs="sans-serif",ub="#0f0",db="#7f7f7f22",hr=10,pb="create",wu="fschange",fb="lores",mb=fu,xa="user",_b="#000c",Cu="#fff",gb="#4f4",Su="#888",yb="#555",Pa="bark",ti="linear",ur="log",Aa="mel",ku=["#a35","#c66","#e94","#ed0","#9d5","#4d8","#2cb","#0bc","#09c","#36b"],Tu=[["classic",{colorStops:["red",{color:"yellow",level:.85,pos:.6},{color:"lime",level:.475}]}],["prism",{colorStops:ku}],["rainbow",{dir:"h",colorStops:["#817",...ku,"#639"]}],["orangered",{bgColor:"#3e2f29",colorStops:["OrangeRed"]}],["steelblue",{bgColor:"#222c35",colorStops:["SteelBlue"]}]],bb=["ERR_AUDIO_CONTEXT_FAIL","Could not create audio context. Web Audio API not supported?"],vb=["ERR_INVALID_AUDIO_CONTEXT","Provided audio context is not valid"],wb=["ERR_UNKNOWN_GRADIENT","Unknown gradient"],Ra=["ERR_FREQUENCY_TOO_LOW","Frequency values must be >= 1"],Cb=["ERR_INVALID_MODE","Invalid mode"],Sb=["ERR_REFLEX_OUT_OF_RANGE","Reflex ratio must be >= 0 and < 1"],kb=["ERR_INVALID_AUDIO_SOURCE","Audio source must be an instance of HTMLMediaElement or AudioNode"],Tb=["ERR_GRADIENT_INVALID_NAME","Gradient name must be a non-empty string"],Eb=["ERR_GRADIENT_NOT_AN_OBJECT","Gradient options must be an object"],Ib=["ERR_GRADIENT_MISSING_COLOR","Gradient colorStops must be a non-empty array"];class pt extends Error{constructor(e,t){const[r,i]=e;super(i+(t!==void 0?`: ${t}`:"")),this.name="AudioMotionError",this.code=r}}const Eu=(n,e)=>console.warn(`${n} is deprecated. Use ${e} instead.`),hs=(n,e,t="toLowerCase")=>e[Math.max(0,e.indexOf((""+n)[t]()))],Nb=(n,e,t,r,i)=>e+(r-e)*(i-n)/(t-n);Array.prototype.findLastIndex||(Array.prototype.findLastIndex=function(n){let e=this.length;for(;e-- >0;)if(n(this[e]))return e;return-1});class xb{constructor(e,t={}){this._ready=!1,this._aux={},this._canvasGradients=[],this._destroyed=!1,this._energy={val:0,peak:0,hold:0},this._flg={},this._fps=0,this._gradients={},this._last=0,this._outNodes=[],this._ownContext=!1,this._selectedGrads=[],this._sources=[];for(const[u,d]of Tu)this.registerGradient(u,d);this._container=e||document.body,this._defaultWidth=this._container.clientWidth||640,this._defaultHeight=this._container.clientHeight||270;let r;if(!(t.source&&(r=t.source.context))&&!(r=t.audioCtx))try{r=new(window.AudioContext||window.webkitAudioContext),this._ownContext=!0}catch{throw new pt(bb)}if(!r.createGain)throw new pt(vb);const i=this._analyzer=[r.createAnalyser(),r.createAnalyser()],s=this._splitter=r.createChannelSplitter(2),o=this._merger=r.createChannelMerger(2);this._input=r.createGain(),this._output=r.createGain(),t.source&&this.connectInput(t.source);for(const u of[0,1])s.connect(i[u],u);o.connect(this._output),t.connectSpeakers!==!1&&this.connectOutput();const a=document.createElement("canvas");a.style="max-width: 100%;",this._ctx=a.getContext("2d");for(const u of["_scaleX","_scaleR"])this[u]=document.createElement("canvas").getContext("2d");this._fsEl=t.fsElement||a;const l=()=>{this._fsTimeout||(this._fsTimeout=window.setTimeout(()=>{this._fsChanging||(this._setCanvas(mb),this._fsTimeout=0)},du))};window.ResizeObserver&&(this._observer=new ResizeObserver(l),this._observer.observe(this._container)),this._controller=new AbortController;const c=this._controller.signal;window.addEventListener(fu,l,{signal:c}),a.addEventListener(cb,()=>{this._fsChanging=!0,this._fsTimeout&&window.clearTimeout(this._fsTimeout),this._setCanvas(wu),this._fsTimeout=window.setTimeout(()=>{this._fsChanging=!1,this._fsTimeout=0},du)},{signal:c});const h=()=>{r.state=="suspended"&&r.resume(),window.removeEventListener(pu,h)};window.addEventListener(pu,h),document.addEventListener("visibilitychange",()=>{document.visibilityState!="hidden"&&(this._frames=0,this._time=performance.now())},{signal:c}),this._setProps(t,!0),this.useCanvas&&this._container.appendChild(a),this._ready=!0,this._setCanvas(pb)}get alphaBars(){return this._alphaBars}set alphaBars(e){this._alphaBars=!!e,this._calcBars()}get ansiBands(){return this._ansiBands}set ansiBands(e){this._ansiBands=!!e,this._calcBars()}get barSpace(){return this._barSpace}set barSpace(e){this._barSpace=+e||0,this._calcBars()}get channelLayout(){return this._chLayout}set channelLayout(e){this._chLayout=hs(e,[Qt,as,Jt,cu]),this._input.disconnect(),this._input.connect(this._chLayout!=Qt?this._splitter:this._analyzer[0]),this._analyzer[0].disconnect(),this._outNodes.length&&this._analyzer[0].connect(this._chLayout!=Qt?this._merger:this._output),this._calcBars(),this._makeGrad()}get colorMode(){return this._colorMode}set colorMode(e){this._colorMode=hs(e,[ls,hu,uu])}get fftSize(){return this._analyzer[0].fftSize}set fftSize(e){for(const r of[0,1])this._analyzer[r].fftSize=e;const t=this._analyzer[0].frequencyBinCount;this._fftData=[new Float32Array(t),new Float32Array(t)],this._calcBars()}get frequencyScale(){return this._frequencyScale}set frequencyScale(e){this._frequencyScale=hs(e,[ur,Pa,Aa,ti]),this._calcBars()}get gradient(){return this._selectedGrads[0]}set gradient(e){this._setGradient(e)}get gradientLeft(){return this._selectedGrads[0]}set gradientLeft(e){this._setGradient(e,0)}get gradientRight(){return this._selectedGrads[1]}set gradientRight(e){this._setGradient(e,1)}get height(){return this._height}set height(e){this._height=e,this._setCanvas(xa)}get ledBars(){return this._showLeds}set ledBars(e){this._showLeds=!!e,this._calcBars()}get linearAmplitude(){return this._linearAmplitude}set linearAmplitude(e){this._linearAmplitude=!!e}get linearBoost(){return this._linearBoost}set linearBoost(e){this._linearBoost=e>=1?+e:1}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=+e||0}get loRes(){return this._loRes}set loRes(e){this._loRes=!!e,this._setCanvas(fb)}get lumiBars(){return this._lumiBars}set lumiBars(e){this._lumiBars=!!e,this._calcBars(),this._makeGrad()}get maxDecibels(){return this._analyzer[0].maxDecibels}set maxDecibels(e){for(const t of[0,1])this._analyzer[t].maxDecibels=e}get maxFPS(){return this._maxFPS}set maxFPS(e){this._maxFPS=e<0?0:+e||0}get maxFreq(){return this._maxFreq}set maxFreq(e){if(e<1)throw new pt(Ra);this._maxFreq=Math.min(e,this.audioCtx.sampleRate/2),this._calcBars()}get minDecibels(){return this._analyzer[0].minDecibels}set minDecibels(e){for(const t of[0,1])this._analyzer[t].minDecibels=e}get minFreq(){return this._minFreq}set minFreq(e){if(e<1)throw new pt(Ra);this._minFreq=+e,this._calcBars()}get mirror(){return this._mirror}set mirror(e){this._mirror=Math.sign(e)|0,this._calcBars(),this._makeGrad()}get mode(){return this._mode}set mode(e){const t=e|0;if(t>=0&&t<=10&&t!=9)this._mode=t,this._calcBars(),this._makeGrad();else throw new pt(Cb,e)}get noteLabels(){return this._noteLabels}set noteLabels(e){this._noteLabels=!!e,this._createScales()}get outlineBars(){return this._outlineBars}set outlineBars(e){this._outlineBars=!!e,this._calcBars()}get peakLine(){return this._peakLine}set peakLine(e){this._peakLine=!!e}get radial(){return this._radial}set radial(e){this._radial=!!e,this._calcBars(),this._makeGrad()}get reflexRatio(){return this._reflexRatio}set reflexRatio(e){if(e=+e||0,e<0||e>=1)throw new pt(Sb);this._reflexRatio=e,this._calcBars(),this._makeGrad()}get roundBars(){return this._roundBars}set roundBars(e){this._roundBars=!!e,this._calcBars()}get smoothing(){return this._analyzer[0].smoothingTimeConstant}set smoothing(e){for(const t of[0,1])this._analyzer[t].smoothingTimeConstant=e}get spinSpeed(){return this._spinSpeed}set spinSpeed(e){e=+e||0,(this._spinSpeed===void 0||e==0)&&(this._spinAngle=-Na),this._spinSpeed=e}get splitGradient(){return this._splitGradient}set splitGradient(e){this._splitGradient=!!e,this._makeGrad()}get stereo(){return Eu("stereo","channelLayout"),this._chLayout!=Qt}set stereo(e){Eu("stereo","channelLayout"),this.channelLayout=e?Jt:Qt}get trueLeds(){return this._trueLeds}set trueLeds(e){this._trueLeds=!!e}get volume(){return this._output.gain.value}set volume(e){this._output.gain.value=e}get weightingFilter(){return this._weightingFilter}set weightingFilter(e){this._weightingFilter=hs(e,[mu,_u,gu,yu,bu,vu],"toUpperCase")}get width(){return this._width}set width(e){this._width=e,this._setCanvas(xa)}get audioCtx(){return this._input.context}get canvas(){return this._ctx.canvas}get canvasCtx(){return this._ctx}get connectedSources(){return this._sources}get connectedTo(){return this._outNodes}get fps(){return this._fps}get fsHeight(){return this._fsHeight}get fsWidth(){return this._fsWidth}get isAlphaBars(){return this._flg.isAlpha}get isBandsMode(){return this._flg.isBands}get isDestroyed(){return this._destroyed}get isFullscreen(){return this._fsEl&&(document.fullscreenElement||document.webkitFullscreenElement)===this._fsEl}get isLedBars(){return this._flg.isLeds}get isLumiBars(){return this._flg.isLumi}get isOctaveBands(){return this._flg.isOctaves}get isOn(){return!!this._runId}get isOutlineBars(){return this._flg.isOutline}get pixelRatio(){return this._pixelRatio}get isRoundBars(){return this._flg.isRound}static get version(){return lb}connectInput(e){const t=e instanceof HTMLMediaElement;if(!(t||e.connect))throw new pt(kb);const r=t?this.audioCtx.createMediaElementSource(e):e;return this._sources.includes(r)||(r.connect(this._input),this._sources.push(r)),r}connectOutput(e=this.audioCtx.destination){if(!this._outNodes.includes(e)&&(this._output.connect(e),this._outNodes.push(e),this._outNodes.length==1))for(const t of[0,1])this._analyzer[t].connect(this._chLayout==Qt&&!t?this._output:this._merger,0,t)}destroy(){if(!this._ready)return;const{audioCtx:e,canvas:t,_controller:r,_input:i,_merger:s,_observer:o,_ownContext:a,_splitter:l}=this;this._destroyed=!0,this._ready=!1,this.stop(),r.abort(),o&&o.disconnect(),this.onCanvasResize=null,this.onCanvasDraw=null,this._fsEl=null,this.disconnectInput(),this.disconnectOutput(),i.disconnect(),l.disconnect(),s.disconnect(),a&&e.close(),t.remove(),this._calcBars()}disconnectInput(e,t){e?Array.isArray(e)||(e=[e]):e=Array.from(this._sources);for(const r of e){const i=this._sources.indexOf(r);if(t&&r.mediaStream)for(const s of r.mediaStream.getAudioTracks())s.stop();i>=0&&(r.disconnect(this._input),this._sources.splice(i,1))}}disconnectOutput(e){if(!(e&&!this._outNodes.includes(e))&&(this._output.disconnect(e),this._outNodes=e?this._outNodes.filter(t=>t!==e):[],this._outNodes.length==0))for(const t of[0,1])this._analyzer[t].disconnect()}getBars(){return Array.from(this._bars,({posX:e,freq:t,freqLo:r,freqHi:i,hold:s,peak:o,value:a})=>({posX:e,freq:t,freqLo:r,freqHi:i,hold:s,peak:o,value:a}))}getEnergy(e,t){if(e===void 0)return this._energy.val;if(e!=+e){if(e=="peak")return this._energy.peak;const a={bass:[20,250],lowMid:[250,500],mid:[500,2e3],highMid:[2e3,4e3],treble:[4e3,16e3]};if(!a[e])return null;[e,t]=a[e]}const r=this._freqToBin(e),i=t?this._freqToBin(t):r,s=this._chLayout==Qt?1:2;let o=0;for(let a=0;a<s;a++)for(let l=r;l<=i;l++)o+=this._normalizedB(this._fftData[a][l]);return o/(i-r+1)/s}registerGradient(e,t){if(typeof e!="string"||e.trim().length==0)throw new pt(Tb);if(typeof t!="object")throw new pt(Eb);const{colorStops:r}=t;if(!Array.isArray(r)||!r.length)throw new pt(Ib);const i=r.length,s=o=>+o!=o||o<0||o>1;r.forEach((o,a)=>{const l=a/Math.max(1,i-1);typeof o!="object"?r[a]={pos:l,color:o}:s(o.pos)&&(o.pos=l),s(o.level)&&(r[a].level=1-a/i)}),r.sort((o,a)=>o.level<a.level?1:o.level>a.level?-1:0),r[0].level=1,this._gradients[e]={bgColor:t.bgColor||hb,dir:t.dir,colorStops:r},this._selectedGrads.includes(e)&&this._makeGrad()}setCanvasSize(e,t){this._width=e,this._height=t,this._setCanvas(xa)}setFreqRange(e,t){if(e<1||t<1)throw new pt(Ra);this._minFreq=Math.min(e,t),this.maxFreq=Math.max(e,t)}setLedParams(e){let t,r,i;e&&(t=e.maxLeds|0,r=+e.spaceV,i=+e.spaceH),this._ledParams=t>0&&r>0&&i>=0?[t,r,i]:void 0,this._calcBars()}setOptions(e){this._setProps(e)}setSensitivity(e,t){for(const r of[0,1])this._analyzer[r].minDecibels=Math.min(e,t),this._analyzer[r].maxDecibels=Math.max(e,t)}start(){this.toggleAnalyzer(!0)}stop(){this.toggleAnalyzer(!1)}toggleAnalyzer(e){const t=this.isOn;return e===void 0&&(e=!t),t&&!e?(cancelAnimationFrame(this._runId),this._runId=0):!t&&e&&!this._destroyed&&(this._frames=0,this._time=performance.now(),this._runId=requestAnimationFrame(r=>this._draw(r))),this.isOn}toggleFullscreen(){if(this.isFullscreen)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen();else{const e=this._fsEl;if(!e)return;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}}_binToFreq(e){return e*this.audioCtx.sampleRate/this.fftSize||1}_calcBars(){const e=this._bars=[];if(!this._ready){this._flg={isAlpha:!1,isBands:!1,isLeds:!1,isLumi:!1,isOctaves:!1,isOutline:!1,isRound:!1,noLedGap:!1};return}const{_ansiBands:t,_barSpace:r,canvas:i,_chLayout:s,_maxFreq:o,_minFreq:a,_mirror:l,_mode:c,_radial:h,_reflexRatio:u}=this,d=i.width>>1,f=i.height>>1,g=s==Jt&&!h,y=s==as,v=c%10!=0,C=v&&this._frequencyScale==ur,I=this._showLeds&&v&&!h,k=this._lumiBars&&v&&!h,w=this._alphaBars&&!k&&c!=hr,N=this._outlineBars&&v&&!k&&!I,A=this._roundBars&&v&&!k&&!I,T=s!=Jt||u>0&&!k,Y=i.height-(g&&!I?.5:0)>>g,B=Y*(k||h?1:1-u)|0,O=i.width-d*(y||l!=0),_=g?i.height-Y*2:0,le=d*(l==-1&&!y&&!h),xe=Math.min(i.width,i.height)*(s==Jt?.375:.125)|0,ce=Math.min(d,f),se=Z=>e.push({...Z,peak:[0,0],hold:[0],value:[0]}),X=Z=>{const he=this._freqToBin(Z,"floor"),K=this._binToFreq(he),ee=this._binToFreq(he+1),ve=Math.log2(Z/K)/Math.log2(ee/K);return[he,ve]};let D,fe,L;if(C){const Z=(ae,Te,qe)=>+ae.toPrecision(qe?Math.max(Te,1+Math.log10(ae)|0):Te),he=ae=>{const Te=[1,1.12,1.25,1.4,1.6,1.8,2,2.24,2.5,2.8,3.15,3.55,4,4.5,5,5.6,6.3,7.1,8,9,10],qe=Math.log10(ae)|0,Ue=ae/10**qe;let Ge=1;for(;Ge<Te.length&&Ue>Te[Ge];)Ge++;return Ue-Te[Ge-1]<Te[Ge]-Ue&&Ge--,(Te[Ge]*10**(qe+5)|0)/1e5},K=[0,24,12,8,6,4,3,2,1][c],ee=t?10**(3/(K*10)):2**(1/K),ve=ee**.5;let De=t?7.94328235/(K%2?1:ve):lu;do{let ae=De;const Te=Z(ae/ve,4,!0),qe=Z(ae*ve,4,!0),[Ue,Ge]=X(Te),[Xt,mt]=X(qe);t?ae=K<4?he(ae):Z(ae,ae.toString()[0]<5?3:2):ae=Z(ae,4,!0),ae>=a&&se({posX:0,freq:ae,freqLo:Te,freqHi:qe,binLo:Ue,binHi:Xt,ratioLo:Ge,ratioHi:mt}),De*=ee}while(De<=o);D=O/e.length,e.forEach((ae,Te)=>ae.posX=le+Te*D);const oe=e[0],U=e[e.length-1];fe=this._freqScaling(oe.freqLo),L=O/(this._freqScaling(U.freqHi)-fe),oe.freqLo<a&&(oe.freqLo=a,[oe.binLo,oe.ratioLo]=X(a)),U.freqHi>o&&(U.freqHi=o,[U.binHi,U.ratioHi]=X(o))}else if(v){const Z=[0,24,12,8,6,4,3,2,1][c]*10,he=K=>{switch(this._frequencyScale){case Pa:return 1960/(26.81/(K+.53)-1);case Aa:return 700*(2**K-1);case ti:return K}};D=O/Z,fe=this._freqScaling(a),L=O/(this._freqScaling(o)-fe);for(let K=0,ee=0;K<Z;K++,ee+=D){const ve=he(fe+ee/L),De=he(fe+(ee+D/2)/L),oe=he(fe+(ee+D)/L),[U,ae]=X(ve),[Te,qe]=X(oe);se({posX:le+ee,freq:De,freqLo:ve,freqHi:oe,binLo:U,binHi:Te,ratioLo:ae,ratioHi:qe})}}else{D=1,fe=this._freqScaling(a),L=O/(this._freqScaling(o)-fe);const Z=this._freqToBin(a,"floor"),he=this._freqToBin(o);let K=-999;for(let ee=Z;ee<=he;ee++){const ve=this._binToFreq(ee),De=le+Math.round(L*(this._freqScaling(ve)-fe));if(De>K)se({posX:De,freq:ve,freqLo:ve,freqHi:ve,binLo:ee,binHi:ee,ratioLo:0,ratioHi:0}),K=De;else if(e.length){const oe=e[e.length-1];oe.binHi=ee,oe.freqHi=ve,oe.freq=(oe.freqLo*ve)**.5}}}let Se=0,z=0;if(I){const Z=this._pixelRatio/(window.devicePixelRatio>1&&window.screen.height<=540?2:1),he=[[],[128,3,.45],[128,4,.225],[96,6,.225],[80,6,.225],[80,6,.125],[64,6,.125],[48,8,.125],[24,16,.125]],K=this._ledParams,[ee,ve,De]=K||he[c];let oe,U=B;if(K){const ae=2*Z;let Te;oe=ee+1;do oe--,Te=U/oe/(1+ve),z=Te*ve;while((Te<ae||z<ae)&&oe>1)}else{const ae=540/ve;z=Math.min(ve*Z,Math.max(2,U/ae+.1|0))}T&&(U+=z),K||(oe=Math.min(ee,U/(z*2)|0)),Se=De>=1?De:D*De,this._leds=[oe,Se,z,U/oe-z]}const Q=Math.min(D-1,r*(r>0&&r<1?D:1));v&&(D-=Math.max(I?Se:0,Q)),e.forEach((Z,he)=>{let K=Z.posX,ee=D;v&&(r==0&&!I?(K|=0,ee|=0,he>0&&K>e[he-1].posX+e[he-1].width&&(K--,ee++)):K+=Math.max(I?Se:0,Q)/2,Z.posX=K),Z.barCenter=K+(D==1?0:ee/2),Z.width=ee});const re=[];for(const Z of[0,1]){const he=s==Jt?(Y+_)*Z:0,K=he+Y,ee=he+B-(!I||T?0:z);re.push({channelTop:he,channelBottom:K,analyzerBottom:ee})}this._aux={analyzerHeight:B,analyzerWidth:O,centerX:d,centerY:f,channelCoords:re,channelHeight:Y,channelGap:_,initialX:le,innerRadius:xe,outerRadius:ce,scaleMin:fe,unitWidth:L},this._flg={isAlpha:w,isBands:v,isLeds:I,isLumi:k,isOctaves:C,isOutline:N,isRound:A,noLedGap:T},this._createScales()}_createScales(){if(!this._ready)return;const{analyzerWidth:e,initialX:t,innerRadius:r,scaleMin:i,unitWidth:s}=this._aux,{canvas:o,_frequencyScale:a,_mirror:l,_noteLabels:c,_radial:h,_scaleX:u,_scaleR:d}=this,f=u.canvas,g=d.canvas,y=[],v=this._chLayout==as,C=this._chLayout==Jt,I=["C",,"D",,"E","F",,"G",,"A",,"B"],k=Math.min(o.width,o.height)/34|0,w=f.height>>1,N=k>>1,A=w*(c?.7:1.5),T=N*(c?1:2),Y=2**(1/12);if(!c&&(this._ansiBands||a!=ur))y.push(16,31.5,63,125,250,500,1e3,2e3,4e3),a==ti?y.push(6e3,8e3,1e4,12e3,14e3,16e3,18e3,2e4,22e3):y.push(8e3,16e3);else{let ce=lu;for(let se=-1;se<11;se++)for(let X=0;X<12;X++){if(ce>=this._minFreq&&ce<=this._maxFreq){const D=I[X],fe=D=="C";(D&&c&&!l&&!v||fe)&&y.push(c?[ce,D+(fe?se:"")]:ce)}ce*=Y}}g.width=g.height=(r<<1)+C*k;const B=g.width>>1,O=B-k*.7,_=(ce,se)=>{const X=cr*(ce/o.width),D=X-Na,fe=O*Math.cos(D),L=O*Math.sin(D);d.save(),d.translate(B+fe,B+L),d.rotate(X),d.fillText(se,0,0),d.restore()};f.width|=0,u.fillStyle=d.strokeStyle=_b,u.fillRect(0,0,f.width,f.height),d.arc(B,B,B-k/2,0,cr),d.lineWidth=k,d.stroke(),u.fillStyle=d.fillStyle=Cu,u.font=`${w}px ${cs}`,d.font=`${N}px ${cs}`,u.textAlign=d.textAlign="center";let le=-A/4,xe=-T;for(const ce of y){const[se,X]=Array.isArray(ce)?ce:[ce,ce<1e3?ce|0:`${(ce/100|0)/10}k`],D=s*(this._freqScaling(se)-i),fe=f.height*.75,L=X[0]=="C",Se=w*(c&&!l&&!v?L?1.2:.6:3);if(u.fillStyle=d.fillStyle=L&&!l&&!v?gb:Cu,c){const z=a==ur,Q=a==ti;let re=["C"];if((z||se>2e3||!Q&&se>250||(!h||C)&&(!Q&&se>125||se>1e3))&&re.push("G"),(z||se>4e3||!Q&&se>500||(!h||C)&&(!Q&&se>250||se>2e3))&&re.push("E"),(Q&&se>4e3||(!h||C)&&(z||se>2e3||!Q&&se>500))&&re.push("D","F","A","B"),!re.includes(X[0]))continue}D>=le+A/2&&D<=e&&(u.fillText(X,v&&l==-1?e-D:t+D,fe,Se),(v||l&&(D>A||l==1))&&u.fillText(X,v&&l!=1?e+D:(t||o.width)-D,fe,Se),le=D+Math.min(Se,u.measureText(X).width)/2),D>=xe+T&&D<e-T&&(_(v&&l==1?e-D:D,X),(v||l&&(D>T||l==1))&&_(v&&l!=-1?e+D:-D,X),xe=D)}}_draw(e){this._runId=requestAnimationFrame(x=>this._draw(x));const t=e-this._time,r=e-this._last,i=this._maxFPS?975/this._maxFPS:0;if(r<i)return;this._last=e-(i?r%i:0),this._frames++,t>=1e3&&(this._fps=this._frames/t*1e3,this._frames=0,this._time=e);const{isAlpha:s,isBands:o,isLeds:a,isLumi:l,isOctaves:c,isOutline:h,isRound:u,noLedGap:d}=this._flg,{analyzerHeight:f,centerX:g,centerY:y,channelCoords:v,channelHeight:C,channelGap:I,initialX:k,innerRadius:w,outerRadius:N}=this._aux,{_bars:A,canvas:T,_canvasGradients:Y,_chLayout:B,_colorMode:O,_ctx:_,_energy:le,fillAlpha:xe,_fps:ce,_linearAmplitude:se,_lineWidth:X,maxDecibels:D,minDecibels:fe,_mirror:L,_mode:Se,overlay:z,_radial:Q,showBgColor:re,showPeaks:Z,useCanvas:he,_weightingFilter:K}=this,ee=this._scaleX.canvas,ve=this._scaleR.canvas,De=ce>>1,oe=B==cu,U=B==as,ae=B==Jt,Te=B==Qt,qe=a&&this._trueLeds&&O==ls,Ue=Q?T.width:this._aux.analyzerWidth,Ge=k+Ue,Xt=Z&&this._peakLine&&Se==hr,mt=Q?N-w:f,[za,ms,kt,Dt]=this._leds||[];le.val>0&&(this._spinAngle+=this._spinSpeed*cr/(60*ce));const pn=x=>{if(this._reflexRatio>0&&!l&&!Q){let J,gt;this.reflexFit||ae?(J=ae&&x==0?C+I:0,gt=C-f):(J=T.height-f*2,gt=f),_.save(),_.globalAlpha=this.reflexAlpha,this.reflexBright!=1&&(_.filter=`brightness(${this.reflexBright})`),_.setTransform(1,0,0,-1,0,T.height),_.drawImage(T,0,v[x].channelTop,T.width,f,0,J,T.width,gt),_.restore()}},_s=()=>{this.showScaleX&&(Q?(_.save(),_.translate(g,y),this._spinSpeed&&_.rotate(this._spinAngle+Na),_.drawImage(ve,-ve.width>>1,-ve.width>>1),_.restore()):_.drawImage(ee,0,T.height-ee.height))},gs=x=>{const J=x**2,gt=424.36,Ee=11599.29,mr=25122.25,Lt=544496.41,ge=148693636,at=en=>20*Math.log10(en);switch(K){case _u:const en=ge*J**2/((J+gt)*Math.sqrt((J+Ee)*(J+Lt))*(J+ge));return 2+at(en);case gu:const Ft=ge*J*x/((J+gt)*Math.sqrt(J+mr)*(J+ge));return .17+at(Ft);case yu:const Ln=ge*J/((J+gt)*(J+ge));return .06+at(Ln);case bu:const Fn=((103791848e-2-J)**2+108076816e-2*J)/((9837328-J)**2+11723776*J),_r=x/68966888496476e-18*Math.sqrt(Fn/((J+79919.29)*(J+1345600)));return at(_r);case vu:const gr=-4737338981378384e-39*x**6+2043828333606125e-30*x**4-1363894795463638e-22*J+1,yt=13066122574128241e-35*x**5-2118150887518656e-26*x**3+.0005559488023498642*x,Qe=.0001246332637532143*x/Math.hypot(gr,yt);return 18.2+at(Qe)}return 0},pr=(x,J,gt)=>{_.beginPath(),_.moveTo(x,J),_.lineTo(x,gt),_.stroke()},Dn=x=>{if(x&&X){const J=_.globalAlpha;_.globalAlpha=1,_.stroke(),_.globalAlpha=J}},Mt=x=>Math.max(0,(x*za|0)*(Dt+kt)-kt),fr=x=>{le.val=x,le.peak>0&&(le.hold--,le.hold<0&&(le.peak+=le.hold/(De*De/2))),x>=le.peak&&(le.peak=x,le.hold=De)};z&&_.clearRect(0,0,T.width,T.height);let Mn=0;const _t=A.length,Zt=Te?1:2;for(let x=0;x<Zt;x++){const{channelTop:J,channelBottom:gt,analyzerBottom:Ee}=v[x],mr=this._gradients[this._selectedGrads[x]],Lt=mr.colorStops,ge=Lt.length,at=!re||a&&!z?"#000":mr.bgColor,en=ae&&Q&&x?-1:1,Ft=!x&&L==-1||x&&L==1,Ln=!U||x&&L!=1?0:Ue>>(x||!Ft),Fn=U&&Ft?-1:1,_r=()=>{const R=ee.height,W=R>>1,q=se?100:D,ie=se?0:fe,Me=se?20:5,Je=f/(q-ie),ht=L!=-1&&(!U||x==0||L==1),Tt=L!=1&&(!U||x!=L);_.save(),_.fillStyle=Su,_.font=`${W}px ${cs}`,_.textAlign="right",_.lineWidth=1;for(let qt=q;qt>ie;qt-=Me){const p=J+(q-qt)*Je,E=qt%2==0|0;if(E){const b=p+W*(p==J?.8:.35);ht&&_.fillText(qt,R*.85,b),Tt&&_.fillText(qt,(U?Ue:T.width)-R*.1,b),_.strokeStyle=Su,_.setLineDash([2,4]),_.lineDashOffset=0}else _.strokeStyle=yb,_.setLineDash([2,8]),_.lineDashOffset=1;_.beginPath(),_.moveTo(k+R*E*ht,~~p+.5),_.lineTo(Ge-R*E*Tt,~~p+.5),_.stroke()}_.restore()},gr=(R,W)=>{const q=nt[R]+(R<nt.length-1?(nt[R+1]-nt[R])*W:0);return isNaN(q)?-1/0:q},yt=(R,W=Fn)=>W*cr*((R+Ln)/T.width)+this._spinAngle,Qe=(R,W,q)=>{const ie=w+W*en,Me=yt(R,q);return[g+ie*Math.cos(Me),y+ie*Math.sin(Me)]},si=(R,W,q,ie,Me)=>{_.beginPath();for(const Je of L&&!U?[1,-1]:[Fn]){const[ht,Tt]=u?[yt(R,Je),yt(R+q,Je)]:[];_.moveTo(...Qe(R,W,Je)),_.lineTo(...Qe(R,W+ie,Je)),u?_.arc(g,y,w+(W+ie)*en,ht,Tt,Je!=1):_.lineTo(...Qe(R+q,W+ie,Je)),_.lineTo(...Qe(R+q,W,Je)),u&&!Me&&_.arc(g,y,w+W*en,Tt,ht,Je==1)}Dn(Me),_.fill()},Bt=(R=0,W=0)=>{let q;if(O==ls&&!qe||Se==hr)q=Y[x];else{const ie=O==hu?W%ge:Lt.findLastIndex(Me=>a?Mt(R)<=Mt(Me.level):R<=Me.level);q=Lt[ie].color}_.fillStyle=_.strokeStyle=q};if(he){if(U&&!Q){const R=Ue*(x+Ft),W=Ft?-1:1;_.setTransform(W,0,0,1,R,0)}if((!z||re)&&(z&&(_.globalAlpha=this.bgAlpha),_.fillStyle=at,(x==0||!Q&&!oe)&&_.fillRect(k,J-I,Ue,(z&&this.reflexAlpha==1?f:C)+I),_.globalAlpha=1),this.showScaleY&&!l&&!Q&&(x==0||!oe)&&_r(),a?(_.setLineDash([Dt,kt]),_.lineWidth=A[0].width):_.lineWidth=h?Math.min(X,A[0].width/2):X,_.save(),!Q){const R=new Path2D;R.rect(0,J,T.width,f),_.clip(R)}}let nt=this._fftData[x];this._analyzer[x].getFloatFrequencyData(nt),K&&(nt=nt.map((R,W)=>R+gs(this._binToFreq(W)))),_.beginPath();let fn=[];for(let R=0;R<_t;R++){const W=A[R],{posX:q,barCenter:ie,width:Me,freq:Je,binLo:ht,binHi:Tt,ratioLo:qt,ratioHi:p}=W;let E=Math.max(gr(ht,qt),gr(Tt,p));for(let V=ht+1;V<Tt;V++)nt[V]>E&&(E=nt[V]);if(E=this._normalizedB(E),W.value[x]=E,Mn+=E,W.peak[x]>0&&(W.hold[x]--,W.hold[x]<0&&(W.peak[x]+=W.hold[x]/(De*De/2))),E>=W.peak[x]&&(W.peak[x]=E,W.hold[x]=De),!he)continue;l||s?_.globalAlpha=E:h&&(_.globalAlpha=xe),Bt(E,R);const b=l?mt:a?Mt(E):E*mt|0;if(Se==hr){const V=R?0:(this._normalizedB(nt[A[1].binLo])*mt+b)/2;if(Q){if(R==0&&(U&&_.moveTo(...Qe(0,0)),_.lineTo(...Qe(0,q<0?V:b))),q>=0){const ue=[q,b];_.lineTo(...Qe(...ue)),fn.push(ue)}}else{if(R==0)if(L==-1&&!U)_.moveTo(k,Ee-(q<k?V:b));else{const ue=ht?this._normalizedB(nt[ht-1])*mt:b;_.moveTo(k-X,Ee-ue)}(U||L!=-1||q>=k)&&_.lineTo(q,Ee-b)}}else if(a){if(re&&!z&&(x==0||!oe)){const V=_.globalAlpha;_.strokeStyle=db,_.globalAlpha=1,pr(ie,J,Ee),_.strokeStyle=_.fillStyle,_.globalAlpha=V}if(qe){const V=l?0:Lt.findLastIndex(Xe=>Mt(E)<=Mt(Xe.level));let ue=Ee;for(let Xe=ge-1;Xe>=V;Xe--){_.strokeStyle=Lt[Xe].color;let bt=Ee-(Xe==V?b:Mt(Lt[Xe].level));pr(ie,ue,bt),ue=bt-kt}}else pr(ie,Ee,Ee-b)}else if(q>=k)if(Q)si(q,0,Me,b,h);else if(u){const V=Me/2,ue=Ee+V;_.beginPath(),_.moveTo(q,ue),_.lineTo(q,ue-b),_.arc(ie,ue-b,V,Ia,cr),_.lineTo(q+Me,ue),Dn(h),_.fill()}else{const V=h?_.lineWidth:0;_.beginPath(),_.rect(q,Ee+V,Me,-b-V),Dn(h),_.fill()}const te=W.peak[x];if(te>0&&Z&&!Xt&&!l&&q>=k&&q<Ge)if(h&&X>0?_.globalAlpha=1:s&&(_.globalAlpha=te),(O==uu||qe)&&Bt(te),a){const V=Mt(te);V>=kt&&_.fillRect(q,Ee-V,Me,Dt)}else Q?Se!=hr&&si(q,te*mt,Me,-2):_.fillRect(q,Ee-te*mt,Me,2)}if(he){if(_.globalAlpha=1,Se==hr){if(Bt(),Q&&!U){if(L){let R;for(;R=fn.pop();)_.lineTo(...Qe(...R,-1))}_.closePath()}if(X>0&&_.stroke(),xe>0){if(Q){const R=U?yt(Ue>>1):0,W=U?yt(Ue):cr;_.moveTo(...Qe(U?Ue>>1:0,0)),_.arc(g,y,w,R,W,U?!Ft:!0)}else _.lineTo(Ge,Ee),_.lineTo(k,Ee);_.globalAlpha=xe,_.fill(),_.globalAlpha=1}if((Xt||Q&&Z)&&(fn=[],_.beginPath(),A.forEach((R,W)=>{let q=R.posX,ie=R.peak[x],Me=W?"lineTo":"moveTo";if(Q&&q<0){const Je=A[W+1];ie=Nb(q,ie,Je.posX,Je.peak[x],0),q=0}ie*=mt,Xt?(_[Me](...Q?Qe(q,ie):[q,Ee-ie]),Q&&L&&!U&&fn.push([q,ie])):ie>0&&si(q,ie,1,-2)}),Xt)){let R;for(;R=fn.pop();)_.lineTo(...Qe(...R,-1));_.lineWidth=1,_.stroke()}}_.restore(),U&&!Q&&_.setTransform(1,0,0,1,0,0),(!U&&!oe||x)&&pn(x)}}if(fr(Mn/(_t<<Zt-1)),he&&(L&&!Q&&!U&&(_.setTransform(-1,0,0,1,T.width-k,0),_.drawImage(T,k,0,g,T.height,0,0,g,T.height),_.setTransform(1,0,0,1,0,0)),_.setLineDash([]),_s()),this.showFPS){const x=ee.height;_.font=`bold ${x}px ${cs}`,_.fillStyle=ub,_.textAlign="right",_.fillText(Math.round(ce),T.width-x,x*2)}this.onCanvasDraw&&(_.save(),_.fillStyle=_.strokeStyle=Y[0],this.onCanvasDraw(this,{timestamp:e,_canvasGradients:Y}),_.restore())}_freqScaling(e){switch(this._frequencyScale){case ur:return Math.log2(e);case Pa:return 26.81*e/(1960+e)-.53;case Aa:return Math.log2(1+e/700);case ti:return e}}_freqToBin(e,t="round"){const r=this._analyzer[0].frequencyBinCount-1,i=Math[t](e*this.fftSize/this.audioCtx.sampleRate);return i<r?i:r}_makeGrad(){if(!this._ready)return;const{canvas:e,_ctx:t,_radial:r,_reflexRatio:i}=this,{analyzerWidth:s,centerX:o,centerY:a,initialX:l,innerRadius:c,outerRadius:h}=this._aux,{isLumi:u}=this._flg,d=this._chLayout==Jt,f=1-i,g=u?e.height:e.height*(1-i*!d)|0;for(const y of[0,1]){const v=this._gradients[this._selectedGrads[y]],C=v.colorStops,I=v.dir=="h";let k;if(r?k=t.createRadialGradient(o,a,h,o,a,c-(h-c)*d):k=t.createLinearGradient(...I?[l,0,l+s,0]:[0,0,0,g]),C){const w=d&&!this._splitGradient&&(!I||r);for(let N=0;N<1+w;N++){const A=C.length-1;C.forEach((T,Y)=>{let B=T.pos;if(w&&(B/=2),d&&!u&&!r&&!I&&(B*=f,!w&&B>.5*f&&(B+=.5*i)),N==1)if(r||u){const O=A-Y;T=C[O],B=1-T.pos/2}else Y==0&&B>0&&k.addColorStop(.5,T.color),B+=.5;k.addColorStop(B,T.color),d&&Y==A&&B<.5&&k.addColorStop(.5,T.color)})}}this._canvasGradients[y]=k}}_normalizedB(e){const t=this._linearAmplitude,r=t?1/this._linearBoost:1,i=(l,c,h)=>l<=c?c:l>=h?h:l,s=l=>10**(l/20);let o=this.maxDecibels,a=this.minDecibels;return t&&(o=s(o),a=s(a),e=s(e)**r),i((e-a)/(o-a)**r,0,1)}_setCanvas(e){if(!this._ready)return;const{canvas:t,_ctx:r}=this,i=this._scaleX.canvas,s=window.devicePixelRatio/(this._loRes+1);let o=window.screen.width*s,a=window.screen.height*s;Math.abs(window.orientation)==90&&o<a&&([o,a]=[a,o]);const l=this.isFullscreen,c=l&&this._fsEl==t,h=c?o:(this._width||this._container.clientWidth||this._defaultWidth)*s|0,u=c?a:(this._height||this._container.clientHeight||this._defaultHeight)*s|0;this._pixelRatio=s,this._fsWidth=o,this._fsHeight=a,!(t.width==h&&t.height==u)&&(t.width=h,t.height=u,this.overlay||(r.fillStyle="#000",r.fillRect(0,0,h,u)),r.lineJoin="bevel",i.width=h,i.height=Math.max(20*s,Math.min(h,u)/32|0),this._calcBars(),this._makeGrad(),this._fsStatus!==void 0&&this._fsStatus!==l&&(e=wu),this._fsStatus=l,this.onCanvasResize&&this.onCanvasResize(e,this))}_setGradient(e,t){if(!this._gradients.hasOwnProperty(e))throw new pt(wb,e);[0,1].includes(t)||(this._selectedGrads[1]=e,t=0),this._selectedGrads[t]=e,this._makeGrad()}_setProps(e,t){const r={alphaBars:!1,ansiBands:!1,barSpace:.1,bgAlpha:.7,channelLayout:Qt,colorMode:ls,fftSize:8192,fillAlpha:1,frequencyScale:ur,gradient:Tu[0][0],ledBars:!1,linearAmplitude:!1,linearBoost:1,lineWidth:0,loRes:!1,lumiBars:!1,maxDecibels:-25,maxFPS:0,maxFreq:22e3,minDecibels:-85,minFreq:20,mirror:0,mode:0,noteLabels:!1,outlineBars:!1,overlay:!1,peakLine:!1,radial:!1,reflexAlpha:.15,reflexBright:1,reflexFit:!0,reflexRatio:0,roundBars:!1,showBgColor:!0,showFPS:!1,showPeaks:!0,showScaleX:!0,showScaleY:!1,smoothing:.5,spinSpeed:0,splitGradient:!1,start:!0,trueLeds:!1,useCanvas:!0,volume:1,weightingFilter:mu},i=["onCanvasDraw","onCanvasResize"],s=["gradientLeft","gradientRight","height","width","stereo"],o=Object.keys(r).filter(a=>a!="start").concat(i,s);(t||e===void 0)&&(e={...r,...e});for(const a of Object.keys(e))i.includes(a)&&typeof e[a]!="function"?this[a]=void 0:o.includes(a)&&(this[a]=e[a]);e.start!==void 0&&this.toggleAnalyzer(e.start)}}function Pb({stream:n,username:e,id:t}){var c;const r=ci(null),i=ci(null),[s,o]=tn(!1),a=Bn(()=>t===Ye,[t]),l=mv(h=>{if(!i.current)return;const u=document.createElement("div");u.style.width="100%",u.style.height="100%";const d=new xb(u,{mode:3,barSpace:.6,showScaleX:!1,ledBars:!0}),f=d.audioCtx.createMediaStreamSource(h);d.connectInput(f),d.volume=0,i.current.innerHTML="",i.current.append(u)},[]);return ai(()=>{var h,u;n&&(r.current&&(r.current.srcObject=n),((h=n.getVideoTracks())==null?void 0:h.length)===0&&((u=n.getAudioTracks())==null?void 0:u.length)>0&&l(n))},[r,n,t,l]),m(ne,{round:"small",border:{color:li(t),size:"medium"},className:"handle",style:{height:"40vh",width:"60vh",resize:"both",overflow:"hidden"},children:[m(ze,{color:li(t),children:[e,!a||!n&&m(je,{onClick:()=>o(h=>!h),icon:s?m(gl,{color:"red",size:"small"}):m(yl,{color:"green",size:"small"})})]}),n?((c=n.getVideoTracks())==null?void 0:c.length)===0?m(Et,{children:[m("video",{autoPlay:!0,muted:s||a,hidden:!0,ref:r}),m(ne,{ref:i})]}):m("video",{autoPlay:!0,muted:s||a,ref:r}):m(ne,{align:"center",children:m(Js,{size:"xlarge"})})]})}const Ab=[{label:"phone",icon:m(Ws,{})},{label:"video",icon:m(Za,{})},{label:"screen",icon:m(hl,{})},{label:"view",icon:m(Js,{})}];function Rb(n){const{callManagerInstance:e}=n,[t,r]=tn(null),i=$e(h=>h.users),s=$e(h=>h.users.some(u=>u.active)),o=Le(h=>h.callConsent),a=Le(h=>h.isSharing),l=Le(h=>h.videoBubbles),c=Le(h=>h.myStream);return m(Et,{children:m("div",{style:{height:"75vh",overflow:"scroll"},children:m(ne,{children:[o&&m(ne,{fill:"vertical",children:m(ne,{children:[{id:Ye,stream:c,username:"You"},...l].map(h=>{var u;return m(Pb,{stream:h.stream,username:((u=i.find(d=>d.id===h.id))==null?void 0:u.name)||_n(h.id),id:h.id},h.id)})})}),m(id,{style:{position:"fixed",bottom:"0",width:"100%",height:"10vh"},direction:"row",round:"small",background:"brand",pad:"medium",children:[a&&m(je,{onClick:()=>e.shareMedia("cutStream",c).then(()=>{Le.getState().setMyStream(void 0),r("cutStream")}),hoverIndicator:!0,icon:m(tl,{}),tip:"Leave Call"}),m("div",{children:Ab.map((h,u)=>m(je,{disabled:!s,className:h.label===t?"active":"",primary:h.label===t,icon:h.icon,tip:h.label,onClick:()=>e.shareMedia(h.label,c).then(d=>{Le.getState().setMyStream(d),r(h.label)})},u))})]})]})})})}const{entries:Iu,setPrototypeOf:Nu,isFrozen:Ob,getPrototypeOf:Db,getOwnPropertyDescriptor:xu}=Object;let{freeze:tt,seal:St,create:Pu}=Object,{apply:Oa,construct:Da}=typeof Reflect<"u"&&Reflect;tt||(tt=function(n){return n}),St||(St=function(n){return n}),Oa||(Oa=function(n,e,t){return n.apply(e,t)}),Da||(Da=function(n,e){return new n(...e)});const us=ft(Array.prototype.forEach),Au=ft(Array.prototype.pop),ni=ft(Array.prototype.push),ds=ft(String.prototype.toLowerCase),Ma=ft(String.prototype.toString),Mb=ft(String.prototype.match),ri=ft(String.prototype.replace),Lb=ft(String.prototype.indexOf),Fb=ft(String.prototype.trim),ct=ft(RegExp.prototype.test),ii=Bb(TypeError);function ft(n){return function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return Oa(n,e,r)}}function Bb(n){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Da(n,t)}}function j(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ds;Nu&&Nu(n,null);let r=e.length;for(;r--;){let i=e[r];if(typeof i=="string"){const s=t(i);s!==i&&(Ob(e)||(e[r]=s),i=s)}n[i]=!0}return n}function dr(n){const e=Pu(null);for(const[t,r]of Iu(n))xu(n,t)!==void 0&&(e[t]=r);return e}function ps(n,e){for(;n!==null;){const r=xu(n,e);if(r){if(r.get)return ft(r.get);if(typeof r.value=="function")return ft(r.value)}n=Db(n)}function t(r){return console.warn("fallback value for",r),null}return t}const Ru=tt(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),La=tt(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Fa=tt(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),qb=tt(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Ba=tt(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),zb=tt(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Ou=tt(["#text"]),Du=tt(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),qa=tt(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Mu=tt(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),fs=tt(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Ub=St(/\{\{[\w\W]*|[\w\W]*\}\}/gm),jb=St(/<%[\w\W]*|[\w\W]*%>/gm),Wb=St(/\${[\w\W]*}/gm),Hb=St(/^data-[\-\w.\u00B7-\uFFFF]/),Vb=St(/^aria-[\-\w]+$/),Lu=St(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),$b=St(/^(?:\w+script|data):/i),Gb=St(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Fu=St(/^html$/i);var Bu=Object.freeze({__proto__:null,MUSTACHE_EXPR:Ub,ERB_EXPR:jb,TMPLIT_EXPR:Wb,DATA_ATTR:Hb,ARIA_ATTR:Vb,IS_ALLOWED_URI:Lu,IS_SCRIPT_OR_DATA:$b,ATTR_WHITESPACE:Gb,DOCTYPE_NAME:Fu});const Yb=function(){return typeof window>"u"?null:window},Kb=function(n,e){if(typeof n!="object"||typeof n.createPolicy!="function")return null;let t=null;const r="data-tt-policy-suffix";e&&e.hasAttribute(r)&&(t=e.getAttribute(r));const i="dompurify"+(t?"#"+t:"");try{return n.createPolicy(i,{createHTML(s){return s},createScriptURL(s){return s}})}catch{return console.warn("TrustedTypes policy "+i+" could not be created."),null}};function qu(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Yb();const e=p=>qu(p);if(e.version="3.0.6",e.removed=[],!n||!n.document||n.document.nodeType!==9)return e.isSupported=!1,e;let{document:t}=n;const r=t,i=r.currentScript,{DocumentFragment:s,HTMLTemplateElement:o,Node:a,Element:l,NodeFilter:c,NamedNodeMap:h=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:u,DOMParser:d,trustedTypes:f}=n,g=l.prototype,y=ps(g,"cloneNode"),v=ps(g,"nextSibling"),C=ps(g,"childNodes"),I=ps(g,"parentNode");if(typeof o=="function"){const p=t.createElement("template");p.content&&p.content.ownerDocument&&(t=p.content.ownerDocument)}let k,w="";const{implementation:N,createNodeIterator:A,createDocumentFragment:T,getElementsByTagName:Y}=t,{importNode:B}=r;let O={};e.isSupported=typeof Iu=="function"&&typeof I=="function"&&N&&N.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:_,ERB_EXPR:le,TMPLIT_EXPR:xe,DATA_ATTR:ce,ARIA_ATTR:se,IS_SCRIPT_OR_DATA:X,ATTR_WHITESPACE:D}=Bu;let{IS_ALLOWED_URI:fe}=Bu,L=null;const Se=j({},[...Ru,...La,...Fa,...Ba,...Ou]);let z=null;const Q=j({},[...Du,...qa,...Mu,...fs]);let re=Object.seal(Pu(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Z=null,he=null,K=!0,ee=!0,ve=!1,De=!0,oe=!1,U=!1,ae=!1,Te=!1,qe=!1,Ue=!1,Ge=!1,Xt=!0,mt=!1;const za="user-content-";let ms=!0,kt=!1,Dt={},pn=null;const _s=j({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let gs=null;const pr=j({},["audio","video","img","source","image","track"]);let Dn=null;const Mt=j({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),fr="http://www.w3.org/1998/Math/MathML",Mn="http://www.w3.org/2000/svg",_t="http://www.w3.org/1999/xhtml";let Zt=_t,x=!1,J=null;const gt=j({},[fr,Mn,_t],Ma);let Ee=null;const mr=["application/xhtml+xml","text/html"],Lt="text/html";let ge=null,at=null;const en=t.createElement("form"),Ft=function(p){return p instanceof RegExp||p instanceof Function},Ln=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(at&&at===p)){if((!p||typeof p!="object")&&(p={}),p=dr(p),Ee=mr.indexOf(p.PARSER_MEDIA_TYPE)===-1?Ee=Lt:Ee=p.PARSER_MEDIA_TYPE,ge=Ee==="application/xhtml+xml"?Ma:ds,L="ALLOWED_TAGS"in p?j({},p.ALLOWED_TAGS,ge):Se,z="ALLOWED_ATTR"in p?j({},p.ALLOWED_ATTR,ge):Q,J="ALLOWED_NAMESPACES"in p?j({},p.ALLOWED_NAMESPACES,Ma):gt,Dn="ADD_URI_SAFE_ATTR"in p?j(dr(Mt),p.ADD_URI_SAFE_ATTR,ge):Mt,gs="ADD_DATA_URI_TAGS"in p?j(dr(pr),p.ADD_DATA_URI_TAGS,ge):pr,pn="FORBID_CONTENTS"in p?j({},p.FORBID_CONTENTS,ge):_s,Z="FORBID_TAGS"in p?j({},p.FORBID_TAGS,ge):{},he="FORBID_ATTR"in p?j({},p.FORBID_ATTR,ge):{},Dt="USE_PROFILES"in p?p.USE_PROFILES:!1,K=p.ALLOW_ARIA_ATTR!==!1,ee=p.ALLOW_DATA_ATTR!==!1,ve=p.ALLOW_UNKNOWN_PROTOCOLS||!1,De=p.ALLOW_SELF_CLOSE_IN_ATTR!==!1,oe=p.SAFE_FOR_TEMPLATES||!1,U=p.WHOLE_DOCUMENT||!1,qe=p.RETURN_DOM||!1,Ue=p.RETURN_DOM_FRAGMENT||!1,Ge=p.RETURN_TRUSTED_TYPE||!1,Te=p.FORCE_BODY||!1,Xt=p.SANITIZE_DOM!==!1,mt=p.SANITIZE_NAMED_PROPS||!1,ms=p.KEEP_CONTENT!==!1,kt=p.IN_PLACE||!1,fe=p.ALLOWED_URI_REGEXP||Lu,Zt=p.NAMESPACE||_t,re=p.CUSTOM_ELEMENT_HANDLING||{},p.CUSTOM_ELEMENT_HANDLING&&Ft(p.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(re.tagNameCheck=p.CUSTOM_ELEMENT_HANDLING.tagNameCheck),p.CUSTOM_ELEMENT_HANDLING&&Ft(p.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(re.attributeNameCheck=p.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),p.CUSTOM_ELEMENT_HANDLING&&typeof p.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(re.allowCustomizedBuiltInElements=p.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),oe&&(ee=!1),Ue&&(qe=!0),Dt&&(L=j({},[...Ou]),z=[],Dt.html===!0&&(j(L,Ru),j(z,Du)),Dt.svg===!0&&(j(L,La),j(z,qa),j(z,fs)),Dt.svgFilters===!0&&(j(L,Fa),j(z,qa),j(z,fs)),Dt.mathMl===!0&&(j(L,Ba),j(z,Mu),j(z,fs))),p.ADD_TAGS&&(L===Se&&(L=dr(L)),j(L,p.ADD_TAGS,ge)),p.ADD_ATTR&&(z===Q&&(z=dr(z)),j(z,p.ADD_ATTR,ge)),p.ADD_URI_SAFE_ATTR&&j(Dn,p.ADD_URI_SAFE_ATTR,ge),p.FORBID_CONTENTS&&(pn===_s&&(pn=dr(pn)),j(pn,p.FORBID_CONTENTS,ge)),ms&&(L["#text"]=!0),U&&j(L,["html","head","body"]),L.table&&(j(L,["tbody"]),delete Z.tbody),p.TRUSTED_TYPES_POLICY){if(typeof p.TRUSTED_TYPES_POLICY.createHTML!="function")throw ii('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof p.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw ii('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');k=p.TRUSTED_TYPES_POLICY,w=k.createHTML("")}else k===void 0&&(k=Kb(f,i)),k!==null&&typeof w=="string"&&(w=k.createHTML(""));tt&&tt(p),at=p}},Fn=j({},["mi","mo","mn","ms","mtext"]),_r=j({},["foreignobject","desc","title","annotation-xml"]),gr=j({},["title","style","font","a","script"]),yt=j({},La);j(yt,Fa),j(yt,qb);const Qe=j({},Ba);j(Qe,zb);const si=function(p){let E=I(p);(!E||!E.tagName)&&(E={namespaceURI:Zt,tagName:"template"});const b=ds(p.tagName),te=ds(E.tagName);return J[p.namespaceURI]?p.namespaceURI===Mn?E.namespaceURI===_t?b==="svg":E.namespaceURI===fr?b==="svg"&&(te==="annotation-xml"||Fn[te]):!!yt[b]:p.namespaceURI===fr?E.namespaceURI===_t?b==="math":E.namespaceURI===Mn?b==="math"&&_r[te]:!!Qe[b]:p.namespaceURI===_t?E.namespaceURI===Mn&&!_r[te]||E.namespaceURI===fr&&!Fn[te]?!1:!Qe[b]&&(gr[b]||!yt[b]):!!(Ee==="application/xhtml+xml"&&J[p.namespaceURI]):!1},Bt=function(p){ni(e.removed,{element:p});try{p.parentNode.removeChild(p)}catch{p.remove()}},nt=function(p,E){try{ni(e.removed,{attribute:E.getAttributeNode(p),from:E})}catch{ni(e.removed,{attribute:null,from:E})}if(E.removeAttribute(p),p==="is"&&!z[p])if(qe||Ue)try{Bt(E)}catch{}else try{E.setAttribute(p,"")}catch{}},fn=function(p){let E=null,b=null;if(Te)p="<remove></remove>"+p;else{const ue=Mb(p,/^[\r\n\t ]+/);b=ue&&ue[0]}Ee==="application/xhtml+xml"&&Zt===_t&&(p='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+p+"</body></html>");const te=k?k.createHTML(p):p;if(Zt===_t)try{E=new d().parseFromString(te,Ee)}catch{}if(!E||!E.documentElement){E=N.createDocument(Zt,"template",null);try{E.documentElement.innerHTML=x?w:te}catch{}}const V=E.body||E.documentElement;return p&&b&&V.insertBefore(t.createTextNode(b),V.childNodes[0]||null),Zt===_t?Y.call(E,U?"html":"body")[0]:U?E.documentElement:V},R=function(p){return A.call(p.ownerDocument||p,p,c.SHOW_ELEMENT|c.SHOW_COMMENT|c.SHOW_TEXT,null)},W=function(p){return p instanceof u&&(typeof p.nodeName!="string"||typeof p.textContent!="string"||typeof p.removeChild!="function"||!(p.attributes instanceof h)||typeof p.removeAttribute!="function"||typeof p.setAttribute!="function"||typeof p.namespaceURI!="string"||typeof p.insertBefore!="function"||typeof p.hasChildNodes!="function")},q=function(p){return typeof a=="function"&&p instanceof a},ie=function(p,E,b){O[p]&&us(O[p],te=>{te.call(e,E,b,at)})},Me=function(p){let E=null;if(ie("beforeSanitizeElements",p,null),W(p))return Bt(p),!0;const b=ge(p.nodeName);if(ie("uponSanitizeElement",p,{tagName:b,allowedTags:L}),p.hasChildNodes()&&!q(p.firstElementChild)&&ct(/<[/\w]/g,p.innerHTML)&&ct(/<[/\w]/g,p.textContent))return Bt(p),!0;if(!L[b]||Z[b]){if(!Z[b]&&ht(b)&&(re.tagNameCheck instanceof RegExp&&ct(re.tagNameCheck,b)||re.tagNameCheck instanceof Function&&re.tagNameCheck(b)))return!1;if(ms&&!pn[b]){const te=I(p)||p.parentNode,V=C(p)||p.childNodes;if(V&&te){const ue=V.length;for(let Xe=ue-1;Xe>=0;--Xe)te.insertBefore(y(V[Xe],!0),v(p))}}return Bt(p),!0}return p instanceof l&&!si(p)||(b==="noscript"||b==="noembed"||b==="noframes")&&ct(/<\/no(script|embed|frames)/i,p.innerHTML)?(Bt(p),!0):(oe&&p.nodeType===3&&(E=p.textContent,us([_,le,xe],te=>{E=ri(E,te," ")}),p.textContent!==E&&(ni(e.removed,{element:p.cloneNode()}),p.textContent=E)),ie("afterSanitizeElements",p,null),!1)},Je=function(p,E,b){if(Xt&&(E==="id"||E==="name")&&(b in t||b in en))return!1;if(!(ee&&!he[E]&&ct(ce,E))&&!(K&&ct(se,E))){if(!z[E]||he[E]){if(!(ht(p)&&(re.tagNameCheck instanceof RegExp&&ct(re.tagNameCheck,p)||re.tagNameCheck instanceof Function&&re.tagNameCheck(p))&&(re.attributeNameCheck instanceof RegExp&&ct(re.attributeNameCheck,E)||re.attributeNameCheck instanceof Function&&re.attributeNameCheck(E))||E==="is"&&re.allowCustomizedBuiltInElements&&(re.tagNameCheck instanceof RegExp&&ct(re.tagNameCheck,b)||re.tagNameCheck instanceof Function&&re.tagNameCheck(b))))return!1}else if(!Dn[E]&&!ct(fe,ri(b,D,""))&&!((E==="src"||E==="xlink:href"||E==="href")&&p!=="script"&&Lb(b,"data:")===0&&gs[p])&&!(ve&&!ct(X,ri(b,D,"")))&&b)return!1}return!0},ht=function(p){return p.indexOf("-")>0},Tt=function(p){ie("beforeSanitizeAttributes",p,null);const{attributes:E}=p;if(!E)return;const b={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:z};let te=E.length;for(;te--;){const V=E[te],{name:ue,namespaceURI:Xe,value:bt}=V,zt=ge(ue);let lt=ue==="value"?bt:Fb(bt);if(b.attrName=zt,b.attrValue=lt,b.keepAttr=!0,b.forceKeepAttr=void 0,ie("uponSanitizeAttribute",p,b),lt=b.attrValue,b.forceKeepAttr||(nt(ue,p),!b.keepAttr))continue;if(!De&&ct(/\/>/i,lt)){nt(ue,p);continue}oe&&us([_,le,xe],av=>{lt=ri(lt,av," ")});const Wu=ge(p.nodeName);if(Je(Wu,zt,lt)){if(mt&&(zt==="id"||zt==="name")&&(nt(ue,p),lt=za+lt),k&&typeof f=="object"&&typeof f.getAttributeType=="function"&&!Xe)switch(f.getAttributeType(Wu,zt)){case"TrustedHTML":{lt=k.createHTML(lt);break}case"TrustedScriptURL":{lt=k.createScriptURL(lt);break}}try{Xe?p.setAttributeNS(Xe,ue,lt):p.setAttribute(ue,lt),Au(e.removed)}catch{}}}ie("afterSanitizeAttributes",p,null)},qt=function p(E){let b=null;const te=R(E);for(ie("beforeSanitizeShadowDOM",E,null);b=te.nextNode();)ie("uponSanitizeShadowNode",b,null),!Me(b)&&(b.content instanceof s&&p(b.content),Tt(b));ie("afterSanitizeShadowDOM",E,null)};return e.sanitize=function(p){let E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},b=null,te=null,V=null,ue=null;if(x=!p,x&&(p="<!-->"),typeof p!="string"&&!q(p))if(typeof p.toString=="function"){if(p=p.toString(),typeof p!="string")throw ii("dirty is not a string, aborting")}else throw ii("toString is not a function");if(!e.isSupported)return p;if(ae||Ln(E),e.removed=[],typeof p=="string"&&(kt=!1),kt){if(p.nodeName){const zt=ge(p.nodeName);if(!L[zt]||Z[zt])throw ii("root node is forbidden and cannot be sanitized in-place")}}else if(p instanceof a)b=fn("<!---->"),te=b.ownerDocument.importNode(p,!0),te.nodeType===1&&te.nodeName==="BODY"||te.nodeName==="HTML"?b=te:b.appendChild(te);else{if(!qe&&!oe&&!U&&p.indexOf("<")===-1)return k&&Ge?k.createHTML(p):p;if(b=fn(p),!b)return qe?null:Ge?w:""}b&&Te&&Bt(b.firstChild);const Xe=R(kt?p:b);for(;V=Xe.nextNode();)Me(V)||(V.content instanceof s&&qt(V.content),Tt(V));if(kt)return p;if(qe){if(Ue)for(ue=T.call(b.ownerDocument);b.firstChild;)ue.appendChild(b.firstChild);else ue=b;return(z.shadowroot||z.shadowrootmode)&&(ue=B.call(r,ue,!0)),ue}let bt=U?b.outerHTML:b.innerHTML;return U&&L["!doctype"]&&b.ownerDocument&&b.ownerDocument.doctype&&b.ownerDocument.doctype.name&&ct(Fu,b.ownerDocument.doctype.name)&&(bt="<!DOCTYPE "+b.ownerDocument.doctype.name+`>
`+bt),oe&&us([_,le,xe],zt=>{bt=ri(bt,zt," ")}),k&&Ge?k.createHTML(bt):bt},e.setConfig=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ln(p),ae=!0},e.clearConfig=function(){at=null,ae=!1},e.isValidAttribute=function(p,E,b){at||Ln({});const te=ge(p),V=ge(E);return Je(te,V,b)},e.addHook=function(p,E){typeof E=="function"&&(O[p]=O[p]||[],ni(O[p],E))},e.removeHook=function(p){if(O[p])return Au(O[p])},e.removeHooks=function(p){O[p]&&(O[p]=[])},e.removeAllHooks=function(){O={}},e}var Qb=qu();const Jb=n=>{const e=/>>(.{9})/gi,t=/(https?:\/\/(www\.)?[\w#%+.:=@~-]{1,256}\.[\d()a-z]{1,6}\b([\w#%&()+./:=?@~-]*))/gi;return n=n.replaceAll(t,'<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>'),n=n.replaceAll(e,'<a class="msgLink $1">&gt;&gt;$1</a>'),n},zu=n=>{const e=Date.now(),t=Math.floor((e-n)/1e3);if(t<60)return`${t} seconds ago`;if(t<3600){const r=Math.floor(t/60);return`${r} minute${r>1?"s":""} ago`}else if(t<86400){const r=Math.floor(t/3600);return`${r} hour${r>1?"s":""} ago`}else{const r=Math.floor(t/86400);return`${r} day${r>1?"s":""} ago`}};function Xb(n){const{message:e,index:t,isLast:r,sentByName:i}=n,s=ci(null);return ai(()=>{r&&s.current&&s.current.scrollIntoView({behavior:"smooth",block:"center"});for(const o of document.querySelectorAll(".msgLink"))o.setAttribute("cursor","pointer"),o.addEventListener("click",a=>{const l=a.target.className.split(" ")[1],c=document.querySelector(`#${l}`);c&&c.scrollIntoView({behavior:"smooth",block:"center"})})}),m(Et,{children:e.sentBy==="system"?m("div",{children:m(ne,{border:{color:"grey",size:"small"},pad:"medium",round:"small",children:[e.text,m(ze,{style:{color:"grey"},children:zu(e.recievedAt)})]},t)}):m(Et,{children:m("div",{id:e.id,ref:r?s:null,style:{textAlign:"left",backgroundColor:"dark-1"},children:[m(ne,{direction:"row",children:[m(ze,{size:"Medium",style:{fontWeight:"bold",color:li(e.sentBy)},children:i}),m(ze,{size:"small",style:{paddingLeft:"1vh",color:"grey"},children:zu(e.recievedAt)}),m(je,{style:{paddingLeft:"1vh",cursor:"pointer"},icon:m(fl,{}),onClick:()=>{const o=document.querySelector("#userTextBox");o&&(o.value+=`>>${e.id} `)}})]}),m(ze,{style:{width:"fit-content"},size:"medium",dangerouslySetInnerHTML:{__html:Qb.sanitize(Jb(e.text))}})]},e.id)})})}function Zb(){const n=Ha(t=>t.messages),e=lr(t=>t.persona.name);return m(yv,{direction:"column",border:{color:"brand",size:"small"},pad:"small",round:"small",background:"dark-1",style:{whiteSpace:"pre-line",overflowX:"auto",overflowY:"scroll",height:"90%"},children:[m("div",{style:{height:"100%"}}),m(ed,{items:n.sort((t,r)=>t.recievedAt-r.recievedAt),children:(t,r)=>{var i;return m(Xb,{message:t,index:r,sentByName:t.sentBy===Ye?e:((i=$e(s=>s.users.find(o=>o.id===t.sentBy)))==null?void 0:i.name)||t.sentBy,isLast:r===n.length-1})}})]})}function ev(n){const{chatManagerInstance:e}=n,t=ci(null),[r,i]=tn(!1),[s,o]=tn(""),a=$e(c=>c.users.some(h=>h.active)),l=()=>{t.current!==null&&e&&(e.sendChat(s),o(""),t.current.value="")};return m(Et,{children:[m(Zb,{}),m(ne,{direction:"row",children:[m(je,{icon:r?m(rl,{}):m(ol,{}),onClick:()=>i(!r),disabled:!a,tip:"Toggle multiline input"}),m(Es,{ref:t,id:"userTextBox",style:{resize:"none"},rows:r?5:1,name:"userInput",autoComplete:"off",placeholder:"Type your message",disabled:!a,value:s,onChange:c=>o(c.target.value),onKeyUp:c=>{c.key==="Enter"&&c.shiftKey===!1&&!r?l():e.sendTypingIndicator(!0)},onBlur:()=>e.sendTypingIndicator(!1)}),m(je,{onClick:l,disabled:!a,primary:!0,hoverIndicator:!0,tip:"Send message",icon:m(ml,{})})]})]})}function tv(n){const{addFiles:e,uiInteractive:t}=n,[r,i]=tn(0),s=o=>{const a=o.target;if(a.files){const l=[...a.files];e(l),i(c=>c+1)}};return m("label",{className:"fileLabel",htmlFor:"fileInput",children:[m("div",{className:"fileDiv",children:"Click or drop something here to upload"}),m("input",{type:"file",id:"fileInput",accept:"*",multiple:!0,required:!0,disabled:!t,onChange:s},r)]})}function nv(n){const{downloadManagerInstance:e}=n,t=Zr(o=>o.realFiles),r=ei(o=>o.requestableDownloads),i=et(o=>o.progressQueue),s=$e(o=>o.users.some(a=>a.active));return m(Et,{children:e&&m("div",{style:{height:"100%",overflow:"scroll"},children:[m(Ya,{open:!0,style:{padding:"1rem 1.2rem"},title:"Send File",children:[m(tv,{uiInteractive:s,addFiles:o=>{e.addRealFiles(o)}}),m(ne,{background:"dark-3",round:"small",pad:"medium",border:{color:"brand",size:"medium"},children:t&&Object.entries(t).map(([o,a])=>m(ne,{background:"dark-3",round:"small",pad:"medium",direction:"row",border:{color:"accent-1",size:"medium"},children:[m(ze,{size:"medium",children:[a.name," ",Ju(a.size)," "]}),m(je,{type:"button",style:{marginLeft:"auto"},primary:!0,onClick:()=>e.removeRealFile(o),icon:m(Os,{}),tip:"Stop offering file"})]},o))})]}),m(Ya,{style:{padding:"1rem 1.2rem"},title:"Send Request",open:!0,children:m(ne,{background:"dark-3",round:"small",pad:"medium",border:{color:"brand",size:"medium"},children:r&&Object.entries(r).map(([o,a])=>{var c;const l=(c=$e(h=>h.users.find(u=>u.id===o)))==null?void 0:c.name;return a.map(({id:h,name:u,size:d,ownerId:f})=>m(ne,{round:"small",background:"dark-3",pad:"medium",border:{color:"brand",size:"medium"},children:m(ne,{direction:"row",children:[m(ze,{size:"medium",children:u}),m(ne,{style:{paddingLeft:"1em",paddingRight:"1em"},children:[m(ze,{size:"small",children:["sent by ",l]}),m(ze,{size:"xsmall",children:Ju(d)})]}),m(je,{onClick:()=>e.requestFile(f,h),primary:!0,icon:m(Xu,{}),tip:"Request"})]})},h))})})}),m(Ya,{style:{padding:"1rem 1.2rem"},title:"Active Transfers",open:!0,children:m(ne,{background:"dark-3",round:"small",pad:"medium",border:{color:"brand",size:"medium"},children:i.map((o,a)=>m(ne,{className:o.id,background:"dark-3",round:"small",pad:"medium",border:{color:"accent-1",size:"medium"},children:[m(ze,{size:"medium",color:"brand",children:o.toUser===Ye?` \u2190 ${o.name} (${(o.progress*100).toFixed(2)}%)`:`(${(o.progress*100).toFixed(2)}%) ${o.name} \u2192`}),m(ne,{direction:"row",children:[m(ws,{values:[{value:o.progress*100,label:o.name,onClick:()=>{}}],"aria-label":"meter"}),m(je,{style:{padding:"0.3em"},onClick:()=>e.attemptResume(o.uuid),icon:m(pl,{}),tip:"Attempt Resume"}),m(je,{style:{padding:"0.3em"},primary:!0,onClick:()=>e.cancelFile(o.uuid),icon:m(Os,{}),tip:"Cancel Transfer"})]})]},`${o.id}-${a}`))})})]})})}function rv(){const[n,e]=Ne(t=>[t.disappearingMessagesLength,t.setDisappearingMessagesLength]);return m(Et,{children:m(ne,{direction:"column",children:m(ne,{direction:"row",gap:"small",align:"center",children:[m(wv,{pad:"small",label:"Use Disappearing Messages?",color:"brand",checked:n!==0,onChange:t=>e(t.target.checked?1e3:0)}),m(Ga,{border:{color:"brand",size:"small"},name:"userInput",autoComplete:"off",label:"Message length",disabled:n===0,value:n,onChange:t=>e(Number(t.target.value))})]})})})}let Uu,ju;Uu=({roomId:n,room:e})=>{const t=Bn(()=>new nb({room:e,roomId:n}),[e,n]),r=Bn(()=>new Xy({room:e,roomId:n}),[e,n]),i=Bn(()=>new tb({room:e,roomId:n}),[e,n]),s=Bn(()=>new Jy({room:e,roomId:n}),[e,n]);return ai(()=>{t.createPersona(),e.onPeerJoin(async o=>t.peerJoinHook(o).then(()=>i.peerJoinHook(o)))},[i,e,t]),m(Et,{children:[m(sb,{roomId:n,children:m(rb,{tabs:[{label:"chat",icon:m(el,{})},{label:"downloads",icon:m(Xu,{})},{label:"call",icon:m(Ws,{})},{label:"settings",icon:m(_l,{})}]})}),m(ne,{direction:"row",children:[m(ne,{fill:!0,children:m(ib,{tabs:{chat:m(ev,{chatManagerInstance:r}),downloads:m(nv,{downloadManagerInstance:i}),call:m(Rb,{callManagerInstance:s}),settings:m(rv,{})}})}),m(ab,{roomId:n,userManagerInstance:t})]})]})},ju=(n,e,t)=>()=>{const[r,i]=tn(!1),[s,o]=tn(null),a=ci(null),l=async(c="")=>{if(!s){const h=await fetch(Cv).then(u=>u.json()).then(u=>{switch(e){case"t":return Qy({...Sv,rtcConfig:{iceServers:u},password:c===""?void 0:c},n);case"f":return eu({...Zu,rtcConfig:{iceServers:u},password:c===""?void 0:c},n);default:return eu({...Zu,rtcConfig:{iceServers:u},password:c===""?void 0:c},n)}});o(h)}};return ai(()=>{t||l()}),m(Et,{children:s?m(Uu,{roomId:n,room:s}):m(bv,{children:m(ne,{border:{color:"brand",size:"large"},pad:"medium",children:[m(ze,{color:"red",children:"Enter room password:"}),m(ne,{direction:"row",children:[m(Ga,{icon:m(cl,{}),ref:a,name:"userInput",type:r?"text":"password",autoComplete:"off",placeholder:"Please enter a password",onKeyUp:c=>{var h;c.key==="Enter"&&l((h=a.current)==null?void 0:h.value)}}),m(je,{icon:r?m(ll,{}):m(al,{}),onClick:()=>i(c=>!c),tip:"Toggle password visibility"})]}),m(ne,{direction:"row",children:[m(je,{label:"home",onClick:()=>{$a("/"),location.reload()},icon:m(xs,{})}),m(je,{onClick:()=>{var c,h;((c=a.current)==null?void 0:c.value.trim())!==""&&l((h=a.current)==null?void 0:h.value)},style:{marginLeft:"auto",width:"100%"},label:"Go",primary:!0})]})]})})})},td=Object.freeze(Object.defineProperty({__proto__:null,default:ju},Symbol.toStringTag,{value:"Module"}))});export{td as P,kv as __tla,Ka as c};
