import{e as W}from"./util-10c81017.js";import{c as O,__tla as S}from"./PasswordModal-050a6a96.js";import{__tla as z}from"./index-8e29a41c.js";import"./GenericHeader-b6f3410d.js";import"./roomConfig-0e0bf8eb.js";import"./InfiniteScroll-8d0fe7e7.js";import"./Collapsible-beba5fc1.js";let u,C=Promise.all([(()=>{try{return S}catch{}})(),(()=>{try{return z}catch{}})()]).then(async()=>{const{WritableStream:l,TransformStream:h,DOMException:w,Blob:p}=O,{GONE:g}=W,R=/constructor/i.test(window.HTMLElement)||window.safari||window.WebKitPoint;u=class{constructor(r="unkown"){this.name=r,this.kind="file"}async getFile(){throw new w(...g)}async isSameEntry(r){return this===r}async createWritable(r={}){var d;const e=await((d=navigator.serviceWorker)==null?void 0:d.getRegistration()),t=document.createElement("a"),o=new h,U=o.writable;if(t.download=this.name,R||!e){let a=[];o.readable.pipeTo(new l({write(s){a.push(new p([s]))},close(){const s=new p(a,{type:"application/octet-stream; charset=utf-8"});a=[],t.href=URL.createObjectURL(s),t.click(),setTimeout(()=>URL.revokeObjectURL(t.href),1e4)}}))}else{const{writable:a,readablePort:s}=new T(l),n=encodeURIComponent(this.name).replace(/['()]/g,escape).replace(/\*/g,"%2A"),k={"content-disposition":"attachment; filename*=UTF-8''"+n,"content-type":"application/octet-stream; charset=utf-8",...r.size?{"content-length":r.size}:{}},j=setTimeout(()=>e.active.postMessage(0),1e4);o.readable.pipeThrough(new h({transform(c,_){if(c instanceof Uint8Array)return _.enqueue(c);const L=new Response(c).body.getReader(),m=F=>L.read().then(y=>y.done?0:m(_.enqueue(y.value)));return m()}})).pipeTo(a).finally(()=>{clearInterval(j)}),e.active.postMessage({url:e.scope+n,headers:k,readablePort:s},[s]);const i=document.createElement("iframe");i.hidden=!0,i.src=e.scope+n,document.body.appendChild(i)}return U.getWriter()}};const f=0,b=0,P=1,v=1,M=2;class E{constructor(e){e.onmessage=t=>this._onMessage(t.data),this._port=e,this._resetReady()}start(e){return this._controller=e,this._readyPromise}write(e){const t={type:f,chunk:e};return this._port.postMessage(t,[e.buffer]),this._resetReady(),this._readyPromise}close(){this._port.postMessage({type:M}),this._port.close()}abort(e){this._port.postMessage({type:v,reason:e}),this._port.close()}_onMessage(e){e.type===b&&this._resolveReady(),e.type===P&&this._onError(e.reason)}_onError(e){this._controller.error(e),this._rejectReady(e),this._port.close()}_resetReady(){this._readyPromise=new Promise((e,t)=>{this._readyResolve=e,this._readyReject=t}),this._readyPending=!0}_resolveReady(){this._readyResolve(),this._readyPending=!1}_rejectReady(e){this._readyPending||this._resetReady(),this._readyPromise.catch(()=>{}),this._readyReject(e),this._readyPending=!1}}class T{constructor(e){const t=new MessageChannel;this.readablePort=t.port1,this.writable=new e(new E(t.port2))}}});export{u as FileHandle,C as __tla};
